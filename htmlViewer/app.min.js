/*! Seagull_HTML5_Player 
 version: 3.1.6
 author: Roman Saj 
 Release date: 22-10-2021*/"use strict";function dynamicSort(a){var b=1;return"-"===a[0]&&(b=-1,a=a.substr(1)),function(c,d){var e=c[a]<d[a]?-1:c[a]>d[a]?1:0;return e*b}}function renameSwf(a,b){return a.replace(".swf","."+b)}function nullifySwf(a){return a?a.match(".swf")?null:a:null}function defineQuestionPoints(a,b){if(a[0]&&a[0].points)return a[0].points;var c=0;if(a.length)for(var d=1;d<a.length;d++){var e=a[d];e.crct&&isNaN(e.crct)||c++}return c}function launchIntoFullscreen(){var a="firefox"==browserName()||"chrome"==browserName()?document.documentElement:document.getElementById("player");if(a.requestFullscreen)a.requestFullscreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else if(a.webkitRequestFullscreen)a.webkitRequestFullscreen();else{if(!a.msRequestFullscreen)return!1;a.msRequestFullscreen()}return!0}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function add(a,b){return a+b}function detectmob(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)||navigator.userAgent.match(/SeagullApp/i))}function toHHMMSS(a){a=parseInt(a);var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=a-3600*b-60*c;return c<10&&(c="0"+c),d<10&&(d="0"+d),(b>0?b+":":"")+c+":"+d}function setCharAt(a,b,c){return b>a.length-1?a:a.substr(0,b)+c+a.substr(b+1)}function glossaryFilter(){return function(a,b,c,d){function e(a){return function(c){return c[a].toLowerCase().match(b)}}function f(a){var b={boolean:{},number:{},string:{}},c=[];return a.filter(function(a){var d=typeof a;return d in b?!b[d].hasOwnProperty(a)&&(b[d][a]=!0):!(c.indexOf(a)>=0)&&c.push(a)})}if(!a)return[];if(!b||b.length<2)return a;b=b.toLowerCase();var g=a.filter(e("term"));return g=g.concat(a.filter(e("definition"))),g=f(g)}}function ALItem(a,b,c,d){this.id=a.id,this.toLearnAlternatives=a.alternatives?a.alternatives[b]:null,this.toLearnWord=this.toLearnAlternatives?this.toLearnAlternatives[0]:null,this.toLearnSounds=a.sounds?a.sounds[b]:null,this.toLearnSound=this.toLearnSounds?this.toLearnSounds[0]:null,this.toLearnUsages=a.usage?a.usage[b]:null,this.toLearnUsage=this.toLearnUsages?this.toLearnUsages[0]:null,this.usersLangAlternatives=a.alternatives?a.alternatives[c]:null,this.usersLangWord=this.usersLangAlternatives?this.usersLangAlternatives[0]:null,this.usersLangSounds=a.sounds?a.sounds[c]:null,this.usersLangSound=this.usersLangSounds?this.usersLangSounds[0]:null,this.usersLangUsages=a.usage?a.usage[c]:null,this.usersLangUsage=this.usersLangUsages?this.usersLangUsages[0]:null,this.img=a.img?d+a.img:null,this.phasePoints=[0,0,0,0,0,0,0],this.cooling=0,this.markCorrect=null,this.markIncorrect=null,this.markHidden=null,this.skipped=null,this.givenAnswers=[[],[],[],[],[],[],[]],this.resetMarkings=function(){this.markCorrect=null,this.markIncorrect=null,this.markHidden=null},this.checkCorrect=function(a,b){return b?a.toLowerCase().trim()===this.toLearnWord.toLowerCase().trim():a.toLowerCase().trim()===this.usersLangWord.toLowerCase().trim()},this.saveAnswer=function(a,b){this.givenAnswers[b].push(a)}}function calculateScale(a,b){return Math.min(window.innerWidth/a,window.innerHeight/b)}function calculateAutoScaleDown(a,b){return window.innerWidth<a||window.innerHeight<b?calculateScale(a,b):1}function lineBeaksCorrector(a){var b=new RegExp(String.fromCharCode(13)+"(?!"+String.fromCharCode(10)+")","g"),c=a.replace(b,String.fromCharCode(10));return c}function stringToObjectNames(a,b){var c=a.split(b),d={};return angular.forEach(c,function(a){d[a]="capable"}),d}var LOG_LEVELS={NONE:0,ERROR:1,WARN:2,DEBUG:3,INFO:4},app=angular.module("myApp",["ngRoute","ngSanitize","myApp.player","ui.event","ngAnimate","rzModule","hmTouchEvents","myApp.version"]).decorator("$xhrFactory",["$delegate","$injector",function(a,b){return function(c,d){var e=a(c,d),f=b.get("$http"),g=f.pendingRequests[f.pendingRequests.length-1];return angular.isFunction(g.onProgress)&&e.addEventListener("progress",g.onProgress),e}}]).constant("PREFIX",{MODULE:window.contentPath+"/",PIC:window.contentPath+"/pic/",SOUND:window.contentPath+"/snd/",ADAPTIVE:window.contentPath+"/adl/"}).constant("EVENTS",{CBT_LOADED:"cbtLoaded",PAGE_DATA_LOADED:"pageDataLoaded",PAGE_PRELOADED:"pagePreoaded",PAGE_FINISHED:"pageFinished",SUB_PAGE_FINISHED:"subpageFinished",VIDEO_PLAYING:"videoPlaying",VIDEO_HIDE_CONTROLS:"videoHideControls",VIDEO_TIME_CHANGE:"videoTimeChange",VIDEO_PAUSED:"videoPaused",VIDEO_BUFFER:"videoBuffer",VIDEO_CUE_PERCENTS:"videoCuePercents",PAUSE:"pause",SEEK:"seek",SEEK_END:"seekEnd",PLAY:"play",QUESTION_FULLY_DISPLAYED:"questionFullyDisplayed",CHECK:"check",ANSWER_GIVEN:"answerGiven",SUBPAGE:"subpage",REMOVE_SUBPAGE:"removeSubpage",SUBPAGE_REMOVED:"subpageRemoved",REPLAY:"replay",CONTEXT_REQUESTED:"contextRequested",CLICK_ON_PAGE:"clickOnPage",NEXT_STEP:"nextStep",PREV_STEP:"prevStep",STEP_CHANGE:"stepChange",STEP_FINISHED:"stepFinished",SUBPAGE_REQUESTED:"subpageRequested",PRELOADING:"preloading",PRELOADING_FINISHED:"preloading_finished",PRELOAD_PAGE:"preloadPage",PRELOAD_CHAPTER_PAGE:"preloadChapterPage",CUSTOM_PRELOAD:"customPreload",CANCEL_CUSTOM_PRELOAD:"cancelCustomPreload",START_PRELOAD_CHAPTER:"startPreloadChapter",CANCEL_PRELOAD:"cancelPreloadChapter",ALERT:"alert",QUITTING:"quitting",ALERT_DISMISSED:"alertDismissed",GLASS_LAYER:"glasLayer",GLASS_LAYER_DISMISSED:"glasLayerDismissed",GLOSSARY_ON:"glossaryOn",GLOSSARY_DISMISSED:"glossaryDismissed"}).constant("STRINGS",{CBT_FILENAME:"cbt.xml",GLASS_FOLDER:"glass"}).constant("TEMPLATES",{WELCOME:"welcome",OBJECTIVES:"objectives",MENU:"menu",CHAPTER_END:"chapterFinished",SELF_ASSESSMENT_INTRO:"selfAssessmentIntro",ASSESSMENT_INTRO:"assessmentIntro",ASSESSMENT_RESULT:"assessmentResult",TMP_01:"tmp01",VID:"vid",Q1:"q1",Q2:"q2",DOC:"doc",PPT:"ppt",ADAPTIVE:"adl",HTML:"html"}).constant("LOG_LEVEL",LOG_LEVELS.WARN).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["http://172.16.2.26:8000/**","**","self"])}]).controller("MyAppCtrl",["$scope","$rootScope","$location","$document","$timeout","mainDataReader","sessionData","TEMPLATES","EVENTS","SCORMService","manifestReader",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,c,d){b.lmsInitialized=j.isLMS_Initialized(),b.lmsInitialized?c():(y++,y<a?e(function(){l(a,c,d)},200):d())}function m(a,c,d){f.getMainData(function(f){f?(b.mainData=f,angular.element("link#customStyle").length||angular.element("head").append('<link id="customStyle" href="'+b.mainData.customCSS+'" rel="stylesheet">'),c()):(t++,t<a?e(function(){m(a,c,d)},200):d())},b.session.level)}function n(){c.path("/player")}function o(){b.lmsInitialized&&(b.mainData.strictMode=j.isStrict(b.mainData.strictMode),b.mainData.qqMode=j.isQQ(b.mainData.qqMode),k.getManifestData(function(a){a.levels.length>0&&angular.forEach(b.mainData.levels,function(c){a.levels[c.id]||delete b.mainData.levels[c.id]}),n()}))}function p(){t=0,b.translation=b.mainData.translations,!b.mainData.haveSessionLevel&&b.mainData.levels&&(b.session.level=b.mainData.levels[Object.keys(b.mainData.levels)[0]].id),b.session.subtitlesVisible=b.mainData.subtitlesVisible,b.lmsInitialized?o():n()}function q(){m(3,p,function(){alert("Error 0. Could not load module data")}),b.$watch("session.level",function(a,b){a!=b&&m(3,p,function(){alert("Error 0. Could not load module data")})})}function r(){!u&&b.hasLocalStorage&&(u=localStorage.prefferedLang),b.session.level=u?u:defaults.level}b.scorm=j.isScorm(),b.isSTA=window.isSTA===!0,b.basePath=window.basePath,b.hasLocalStorage="undefined"!=typeof Storage,b.session=g,b.nav={chapterNum:null,page:"welcome"},b.TEMPLATES=h,b.mainData=null,b.mobile=detectmob(),b.inProgress=!1,b.statusInfo=null,b.folderName=window.contentPath.substring(window.contentPath.lastIndexOf("/")+1),setS(b.folderName);var s,t=0,u=null;"undefined"!=typeof sco&&(s=sco);var v,w,x=null;"undefined"!=typeof ch_no&&(w=ch_no),"undefined"!=typeof p_no&&(v=p_no),"undefined"!=typeof lvl&&(u=lvl),"undefined"!=typeof quest&&(x=quest);var y=0;b.scorm?e(l(3,function(){b.nav.chapterNum=s,j.getCmiData(),j.getLang()&&(u=j.getLang(),b.langIsSet=!0),r(),q()},function(){q()}),1e3):(null!=w&&null!=v?(b.previewMode=!0,b.nav.chapterNum=w,b.nav.page=Number(v),b.previewQuestion="true"===x):null!=w&&null===v&&(b.nav.chapterNum=w,b.nav.page=0),r(),q()),d.on("click",function(){a.$apply(function(){b.$broadcast(i.CLICK_ON_PAGE)})}),a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)}}]);angular.element(document).ready(function(){angular.bootstrap(document,["myApp"])});var defaults={module:{build:null,defaultLang:"EN",moduleId:null,version:null,folder:null,displayName:"Module name placeholder",resolution:{width:800,height:600,allowFullScreen:!0,autoFullScale:!1},bcg:null,introPath:null,title:{visibility:"yes",x:20,y:10},subtitles:{enabled:!0,visible:!1},strictMode:!1,toolbar:{toolbarAutoHide:!0},qqMode:"on"},chapter:{chapterName:"Chapter ",background:null,glass:null,color:"#000000",setScore100:!1,qq:"off",assessment:!1,obligatory:0,ordered:!1,points:0,numSelQuest:0,attemptsNum:0,questionsFromChapterCount:0},controls:{height:40,stepMode:!1},fontStyle:{fontFamily:"Montserrat",fontSize:"12px",fontStyle:"normal",fontWeight:"normal",color:"#000000",embed:!1},printOrder:{text:{align:"left"}},feedback:{x:20,y:500,rghttext:"This is correct",wrngtext:"Sorry, this is incorrect",dd_rghttext:"This is the correct match!",dd_wrngtext:"Sorry, it was not the correct match. This one is."},level:"EN",soundEnabled:!0,subtitlesVisible:!1,fullScreen:!1,translations:{CREDITS:"These is default credits placeholder",DISCLAIMER:"The manufacturer's documentation and applicable company procedures must always be considered paramount\nin matters relating to the maintenance and operation of equipment featured in this program. The material\ncontained herein is to be considered supplementary to those sources and utilised for training purposes only.",LEAVE_PAGE_IN_PROGRESS:"If you leave page now your progress may be not saved.\nTo make sure it is saved always quit player through it's controls",ASSESSMENT_INTRO_PANEL_SCORE_EXISTS:'You have already completed the assessment with a score of #SCORE#%. The assessment can only be performed once. For a new attempt, please exit the e-learning module and run it again. Select "New" when asked to continue from previous session.',ASSESSMENT_INTRO_PANEL_SCORE_EXISTS_MULTIPLE_TRIES:'You have already completed the assessment with a score of #SCORE#%. For a new attempt, please exit the e-learning module and run it again. Select "New" when asked to continue from previous session.',ASSESSMENT_INTRO_PANEL_SCORE_EXISTS_3P:"You have already completed the assessment with a score of #SCORE#%. The assessment can only be performed once.",ASSESSMENT_INTRO_PANEL_SCORE_EXISTS_MULTIPLE_TRIES_3P:"You have already completed the assessment with a score of #SCORE#%.",CONFIRM:"Confirm",QUIT_CONFIRMATION:"Do you want to leave this session?",LOGIN_DIALOG_ENTER_BUTTON:"Enter",LOGIN_DIALOG_TEXT:"Please type your ID (or name if you do not have a personal ID). Confirm with 'Enter.'",LOGIN_DIALOG_NO_LOGIN:"You have to type a name in this field, then click 'Enter.'",DISCLAIMER_DIALOG_CONTINUE_BUTTON:"Continue",DISCLAIMER_DIALOG_BEFORE_LOGIN:"Welcome, ",DISCLAIMER_DIALOG_AFTER_LOGIN:"!",DISCLAIMER_DIALOG_TEXT:"Before you can begin training, you must read the statement below. When you have done so, click the 'continue' button to enter the program.",BOOKMARK_DIALOG_BEFORE_LOGIN:"Welcome back, ",BOOKMARK_DIALOG_AFTER_LOGIN:"!",BOOKMARK_DIALOG_TEXT:"Click 'Continue' to resume or 'New' if you want to start again.",WELCOME_DIALOG_TITLE:"Welcome to this module: ",WELCOME_DIALOG_MODULE_VERSION:"Module version: ",WELCOME_DIALOG_VIEWER_VERSION:"Seagull Viewer ",SCO_DISCLAIMER_PANEL_MODULE_VERSION:"Module version: ",SCO_DISCLAIMER_PANEL_VIEWER_VERSION:"Seagull Viewer ",WELCOME_PANEL_SELECT_LEVEL:"Select level or language:",WELCOME_PANEL_All_RIGHTS:"All rights reserved",WELCOME_PANEL_COPYRIGHTS:"No part of this work, covered by the copyright hereon, may be reproduced or otherwise copied without prior permission from",WELCOME_PANEL_MODULE_ID:"Module ID:",WELCOME_PANEL_MODULE_VERSION:"Module version",WELCOME_PANEL_CREDITS_LABEL:"Credits",WELCOME_PANEL_DISCLAIMER_LABEL:"Disclaimer",OBJECTIVES_PANEL_TITLE:"The objectives",MENU_PANEL_TITLE:"Menu",MAIN_UI_PREVIEW_TEXT:"DEMO - This training module is only partly implemented.",MENU_ITEM_CHAPTER_NAME:"Chapter ",MENU_ITEM_CHAPTER_INACTIVE:"INACTIVE",ASSESSMENT_INTRO_PANEL_ASSESS_TITLE:"Assessment",ASSESSMENT_INTRO_PANEL_ASSESS_TEXT:"In the following pages, the Assessor will ask you some questions. They will appear in a random order.  Please note that some are more important or difficult than others and may therefore have been allocated a higher individual mark.",ASSESSMENT_INTRO_PANEL_AGAIN:"This is not your first attempt, Your score will not be recorded.",ASSESSMENT_INTRO_PANEL_FIRST:"Your score will be recorded only on your first attempt.",ASSESSMENT_INTRO_PANEL_SELF_TITLE:"Self-test",ASSESSMENT_INTRO_PANEL_SELF_TEXT:"This section allows you to practice and test your knowledge. No score will be recorded and you may run the exercise as many times as you wish.",SUMMARY_PANEL_TITLE:"End of chapter",SUMMARY_PANEL_TEXT_BEFORE_CHAPTER:"You have now finished this chapter",SUMMARY_PANEL_TEXT_AFTER_CHAPTER:"",SUMMARY_PANEL_SCORM_TEXT:"Click on 'Done' to complete this session.",SUMMARY_PANEL_RETURN_TEXT:"Return to main menu",ASSESSMENT_RESULT_PANEL_TITLE:"Result",ASSESSMENT_RESULT_PANEL_AGAIN_TEXT:"Assessments can only be assessed once. This is your registered result: ",ASSESSMENT_RESULT_PANEL_AGAIN_BEFORE_SCORE:"The Assessor gave you ",ASSESSMENT_RESULT_PANEL_AGAIN_AFTER_SCORE:" points out of ",ASSESSMENT_RESULT_PANEL_SUMMARY_TITLE:"Assessment summary",ASSESSMENT_RESULT_PANEL_SUMMARY_BEFORE_CHAPTER:"Chapter ",ASSESSMENT_RESULT_PANEL_SUMMARY_AFTER_CHAPTER:": ",ASSESSMENT_RESULT_PANEL_SUMMARY_AFTER_POINTS:" points out of ",ASSESSMENT_RESULT_PANEL_SUMMARY_BEFORE_TOTAL:"Total Score: ",ASSESSMENT_RESULT_PANEL_SUMMARY_AFTER_TOTAL:" points out of ",ASSESSMENT_RESULT_PANEL_FIRST_BEFORE_POINTS:"The Assessor gave you ",ASSESSMENT_RESULT_PANEL_FIRST_AFTER_POINTS:" points out of ",REPORT_PANEL_CHAPTER_INACTIVE:"INACTIVE",REPORT_PANEL_CHAPTER_BEFORE_POINTS:"Score: ",REPORT_PANEL_CHAPTER_AFTER_POINTS:" points out of ",REPORT_PANEL_CHAPTER_NOT_ACCESSED:"Not performed yet!",REPORT_PANEL_DATE:"Date: ",REPORT_PANEL_TITLE:"Training Report: ",REPORT_PANEL_USER_NAME:"Trainee name: ",REPORT_PANEL_BEFORE_TIME:"Total time used: ",REPORT_PANEL_AFTER_TIME:" minutes.",TMP01_TITLE_BEFORE_QUESTION:"Question ",TMP01_TITLE_AFTER_QUESTION:" of ",VIDEO_TITLE_BEFORE_QUESTION:"Question ",VIDEO_TITLE_AFTER_QUESTION:" of ",Q1_TITLE_BEFORE_QUESTION:"Question ",Q1_TITLE_AFTER_QUESTION:" of ",Q1_ANSWER_REGISTERED:"Your answer is registered",Q1_ANSWER_INCORRECT:"Sorry, this is incorrect.",Q1_ANSWER_CORRECT:"This is correct",Q2_TITLE_BEFORE_QUESTION:"Question ",Q2_TITLE_AFTER_QUESTION:" of ",Q2_ANSWER_REGISTERED:"Your answer is registered",Q2_ANSWER_INCORRECT:"Sorry, it was not the correct match. This one is.",Q2_ANSWER_CORRECT:"This is the correct match!",PROVIDE_ANSWER:"Please provide an answer before you continue",WARNING:"Warning",ERROR:"Error",NO_MODULE_DATA:"Error 0. Could not load module data",LMS_ERROR:"Communication error - A connection to the learning management system (LMS) could not be established.",NEXT_STEP_TOOLTIP:"Next step",PREV_STEP_TOOLTIP:"Previous step",MENU_TOOLTIP:"Module menu",RELOAD_TOOLTIP:"Reload page",SOUND_ON_TOOLTIP:"Turn sound on",SOUND_OFF_TOOLTIP:"Mute",SUBTITLES_ON_TOOLTIP:"Turn on subtitles",SUBTITLES_OFF_TOOLTIP:"Turn off subtitles",FULLSCREEN_ON_TOOLTIP:"Go full screen",FULLSCREEN_OFF_TOOLTIP:"Exit full screen",CONTINUE_TOOLTIP:"Continue",BACK_TOOLTIP:"Back",EXIT_TOOLTIP:"Exit player",PREV_PAGE_TOOLTIP:"Previous page",NEXT_PAGE_TOOLTIP:"Next page",PAUSE_TOOLTIP:"Pause",PLAY_TOOLTIP:"Play",DONE_TOOLTIP:"Done",GLOSSARY_TOOLTIP:"Glossary",BOOKMARK_ALERT_TITLE:"Bookmark found",BOOKMARK_ALERT_QUESTION:"Do you want to continue from bookmark or start from first page?",BOOKMARK_ALERT_YES_BTN:"First Page",BOOKMARK_ALERT_NO_BTN:"Continue",BOOKMARK_ALERT_CANCEL_BTN:"Clear bookmark",BOOKMARK_INFO:"Info page",SESSION_COMPLETE_STATUS_INFO:"Completed!",SESSION_ASSESMENT_COMPLETE_STATUS_INFO:"Assessment done!",SESSION_INCOMPLETE_STATUS_INFO:"This session was not completed!",ASSESSMENT_INTRO_PANEL_AGAIN_BUT_STILL_CAN_DO:"This is your #ATTEMPTNR# attempt of #ALLATTEMPTS# possible, Your score will be recorded.",ASSESSMENT_INTRO_MASTERY_INFO:"You need to score at least #MASTERY_SCORE#% to pass the test.",GLOSSARY:"Glossary",SEARCH:"Search",CLEAR:"Clear",ALL_LETTERS:"All letters",WRONG_ANSWERS_TITLE:"Answered wrong:",ADL_DO_YOU_KNOW:"Do you know this phrase?",ADL_DONT_KNOW:"I don't know",ADL_TRANSLATE:"Translate to #LANG_NAME#",ADL_REWRITE:"Rewrite",ADL_CHOOSE_PROPER_IMAGE:"Choose proper image",ADL_CHOOSE_PROPER_TRANSLATION:"Choose proper translation",ADL_PROGRESS:"Progress",ADL_NEW:"New",ADL_SEEN:"Seen",ADL_ACQUAINTED:"Acquainted",ADL_MASTERED:"Mastered",DECLARATION_DONE_FEEDBACK:"Let's get on with this!",IN_PROGRESS_FEEDBACK:"Good job! Keep it up!!",HALF_DONE_FEEDBACK:"You're almost there. Keep learning!",ALL_DONE_FEEDBACK:"You did it! Congratulations!",ERR2_FEEDBACK:"Let's get on with this!",ERR3_FEEDBACK:"Keep on trying!",YOUR_SCORE:"Your score:",OK:"OK",CANCEL:"Cancel",LANG_CHANGE_WARNING:"Do you want to change the language to #SELECTED_LANG# in this e-learning chapter? Be aware that it will not be possible to change the language again afterward!"}},setItemsVisibility=function(a){if("tmp01"===a.template)for(var b=0;b<a.numSteps;b++){var c=a.texts[b],d=a.pics[b];c.showOnStep=[],d.showOnStep=[];for(var e=0;e<a.numSteps;e++)e<b?(c.showOnStep.push(!1),d.showOnStep.push(!1)):e===b?(c.showOnStep.push(!0),d.showOnStep.push(!0)):(e===b+1?c.showOnStep.push(!a.texts[e].txtFade):c.showOnStep.push(c.showOnStep[e-1]),d.noFade?d.showOnStep.push(!0):d.showOnStep[e-1]===!1?d.showOnStep.push(!1):a.pics[e].src?d.showOnStep.push(a.texts[e].showWithPrevious):d.showOnStep.push(!0)),c.rpo&&angular.forEach(c.rpo,function(c){var d=Number(c)-1;if(d>=0)for(var e=b;e<a.numSteps;e++)a.texts[d]&&a.texts[d].showOnStep&&(a.texts[d].showOnStep[e]=!1,a.pics[d].showOnStep[e]=!1)})}else for(var b=0;b<a.numSteps;b++);},MODULE_BUILD,s,shuffleArray=function(a){for(var b,c,d=a.slice(),e=d.length;e;)c=Math.floor(Math.random()*e--),b=d[e],d[e]=d[c],d[c]=b;return d},browserName=function(){var a=window.navigator.userAgent,b={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/internet explorer/i};for(var c in b)if(b[c].test(a))return c;return"unknown"},setS=function(a){if(s=a,a.length>16)s=s.substr(0,16);else for(var b=0;b<16-a.length;b++)s+=b>9?b-10:b},decData=function(a){var b=a.substr(0,24),c=new forge.util.ByteBuffer(forge.util.binary.base64.decode(b)),d=a.substr(24),e=new forge.util.ByteBuffer(forge.util.binary.base64.decode(d)),f=new forge.util.ByteBuffer(forge.util.text.utf16.encode(s)),g=forge.cipher.createDecipher("AES-CBC",f);g.start({iv:c}),g.update(e);g.finish();return g},getData=function(a,b){var c;try{if(b){if(c=a,a.compressedData){var d=a.compressedData.data,e=decData(d);c=JSON.parse(e.output.toString("utf16"))}}else{c=angular.element.parseXML(a);var f=angular.element(c),g=f.find("compressedData")[0];if(g){var d=f.find("compressedData > data")[0].textContent,e=decData(d);c=angular.element.parseXML(e.output.toString("utf16"))}}}catch(a){}return c},noCacheQuery=function(a){return a&&(a+="?b="+MODULE_BUILD+"&v=3.1.6"),a},noCacheTemplateQuery=function(a){return a&&(a=(window.basePath?window.basePath:"")+a+"?v=3.1.6"),a};app.directive("assessmentIntro",function(){var a=function(a,b,c,d){a.titleString=b.translation.ASSESSMENT_INTRO_PANEL_ASSESS_TITLE,a.infoString=b.translation.ASSESSMENT_INTRO_PANEL_ASSESS_TEXT,a.infoString2=null,b.chapter.alreadyScored?b.scorm?b.isSTA?1===b.chapter.attemptsNum?a.infoString=b.translation.ASSESSMENT_INTRO_PANEL_SCORE_EXISTS.replace("#SCORE#",b.chapter.precentScore):a.infoString=b.translation.ASSESSMENT_INTRO_PANEL_SCORE_EXISTS_MULTIPLE_TRIES.replace("#SCORE#",b.chapter.precentScore):1===b.chapter.attemptsNum?a.infoString=b.translation.ASSESSMENT_INTRO_PANEL_SCORE_EXISTS_3P.replace("#SCORE#",b.chapter.precentScore):a.infoString=b.translation.ASSESSMENT_INTRO_PANEL_SCORE_EXISTS_MULTIPLE_TRIES_3P.replace("#SCORE#",b.chapter.precentScore):a.infoString=b.translation.ASSESSMENT_INTRO_PANEL_AGAIN:(1===b.chapter.attemptsNum&&(a.infoString2=b.translation.ASSESSMENT_INTRO_PANEL_FIRST),b.scorm&&(b.chapter.attemptsNum>1&&(a.infoString2=b.translation.ASSESSMENT_INTRO_PANEL_AGAIN_BUT_STILL_CAN_DO.replace("#ATTEMPTNR#",d.getAssessmentTries()+1).replace("#ALLATTEMPTS#",b.chapter.attemptsNum)),d.getMasteryScore()&&d.getMasteryScore()>0&&(a.infoString3=b.translation.ASSESSMENT_INTRO_MASTERY_INFO.replace("#MASTERY_SCORE#",d.getMasteryScore())))),a.visible=!1,c(function(){a.visible=!0})};return a.$inject=["$scope","$rootScope","$timeout","SCORMService"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/assessmentIntro/assessmentIntro.html"),controller:a}}),app.directive("assessmentResult",function(){var a=function(a,b,c,d){a.titleString=b.translation.ASSESSMENT_RESULT_PANEL_TITLE,a.visible=!1,a.alreadyScored=b.chapter.alreadyScored,a.totalPossibleScore=0,a.totalScore=0,a.wrongQuestionsTemp=[],a.wrongQuestions=null,angular.forEach(b.pagesOrder,function(c){c.possibleScore&&(a.totalPossibleScore+=c.possibleScore,a.totalScore+=c.score,c.score<c.possibleScore&&!c.adaptive&&a.wrongQuestionsTemp.push(b.pagesData[c.id].texts[0].text))}),a.totalScore=Math.round(100*a.totalScore)/100,a.percentResult=Math.round(a.totalScore/a.totalPossibleScore*100),b.chapter.qinfos&&(a.questionsForChapters=!0,a.chapterScores={},angular.forEach(b.pagesOrder,function(c){c.forChapter&&(a.chapterScores[c.forChapter]||(a.chapterScores[c.forChapter]={totalPossibleScore:0,totalScore:0,percentScore:0,wrongQuestions:[]}),c.score<c.possibleScore&&a.chapterScores[c.forChapter].wrongQuestions.push(b.pagesData[c.id].texts[0].text),a.chapterScores[c.forChapter].totalPossibleScore+=c.possibleScore,a.chapterScores[c.forChapter].totalScore+=c.score,a.chapterScores[c.forChapter].percentScore=Math.round(a.chapterScores[c.forChapter].totalScore/a.chapterScores[c.forChapter].totalPossibleScore*100))})),b.scorm?(d.saveReport(!1),d.increaseAssessmentTries()):b.chapter.alreadyScored||1!==b.chapter.attemptsNum||(b.chapter.precentScore=a.percentResult,b.chapter.alreadyScored=!0);var e=this;e.waited=!1,c(function(){e.waited=!0,a.visible=!0},10),a.barWidth=function(){return{width:e.waited?a.percentResult+"%":0}},a.showExtraInfo=function(b){b?a.wrongQuestions=b.wrongQuestions:a.wrongQuestions=a.wrongQuestionsTemp},a.closeExtraInfo=function(){a.wrongQuestions=null}};return a.$inject=["$scope","$rootScope","$timeout","SCORMService"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/assessmentResult/assessmentResult.html"),controller:a}}),app.directive("chapterFinish",["$rootScope","$timeout","SCORMService",function(a,b,c){var d=function(b){b.titleString=a.translation.SUMMARY_PANEL_TITLE,b.menuClick=function(){a.nav.chapterNum=null,b.nav.page=b.TEMPLATES.MENU},a.scorm&&c.saveReport()};return d.$inject=["$scope"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/chapterFinishPanel/chapterFinishPanel.html"),controller:d}}]),app.directive("playerControls",function(){var a=function(a,b,c,d,e,f,g,h,i,j,k){function l(){m.timeoutBlocked=!0,m.videoSlider.options.disabled=!0,g(function(){m.timeoutBlocked=!1,m.videoSlider.options.disabled=!1},300)}var m=this;m.timeoutBlocked=!1,a.mainData=b.mainData,m.currentStep=0,m.numSteps=0,b.resetControls=!0,m.ac={exit:{show:!0},burgerMenu:{show:!0},menu:{show:!0},next:{show:!0,active:!1,disabled:!1},prev:{show:!0,disabled:!1},reload:{show:!0},vol:{show:!0},fs:{show:!0},subs:{show:!0},video:{show:!0},play:{show:!0},pause:{show:!0},quest:{show:!0},done:{show:!0,active:!1},page:{show:!0},videoProgress:{show:!0},displayProgress:{show:!0},step:{show:!0,active:!1,disabled:!1},stepPrev:{show:!1,active:!1,disabled:!1},glossary:{show:b.mainData.glossary.length>0,active:!0,disabled:!1},continue:{show:!1,active:!0,disabled:!1}},m.videoSlider={self:this,value:0,options:{floor:0,ceil:100,step:.01,precision:3,showSelectionBar:!0,hideLimitLabels:!0,hidePointerLabels:!0,interval:50,scale:1/b.calcScale,onStart:function(a){},onChange:function(){m.seek()},onEnd:function(a){m.seekEnd()}}},m.videoSlider.options.disabled=!0,d.resetInactivityTimeout(),b.$watch("page",function(){a.menuStyle={menuItem:{fill:"white"},centralControl:{fill:"white"},leftBottomText:{display:"inherit"}},b.mobile&&(a.menuStyle.menuItem.fill=b.mainData.fontStyles.menu.color,a.menuStyle.centralControl.fill=b.mainData.fontStyles.button.color,a.menuStyle.toolbarFont=b.mainData.fontStyles.toolbar),b.$broadcast(i.PRELOADING_FINISHED),b.page&&(m.ac.exit.show=!0,m.ac.menu.show=!0,m.ac.burgerMenu.show=!0,m.ac.next.show=!0,m.ac.next.disabled=!1,m.ac.prev.disabled=!1,m.ac.prev.show=!0,m.ac.prev.active=!1,m.ac.reload.show=!0,m.ac.vol.show=!0,m.ac.fs.show=b.mainData.allowFullScreen&&!b.mobile,m.ac.subs.show=b.mainData.subtitlesEnabled,m.ac.play.show=!1,m.ac.pause.show=!1,m.ac.quest.show=!0,m.ac.done.show=!0,m.ac.page.show=!0,m.ac.step.show=!0,m.ac.continue.show=!1,m.ac.video.show=!1,m.ac.videoProgress.show=!1,m.ac.displayProgress.show=!1,m.ac.next.active=!1,a.allowHideControls=!1,m.videoSlider.value=0,m.previousDisplayPercent=0,d.stopInactivityTimeout(),b.mobile&&i.PRELOADING_FINISHED&&a.toggleControls(!1,100),b.page.template===j.WELCOME?(m.ac.prev.show=!1,m.ac.reload.show=!1,m.ac.subs.show=!1,m.ac.video.show=!1,m.ac.quest.show=!1,m.ac.page.show=!1,m.ac.step.show=!1,b.mainData.customWelcome&&(b.mainData.customWelcome.skip||b.mainData.isSkiped)?m.ac.next.show=!1:m.ac.next.active=!0,d.resetInactivityTimeout()):b.page.template===j.MENU?(m.ac.next.show=!1,m.ac.burgerMenu.show=!1,m.ac.menu.show=!1,m.ac.reload.show=!1,m.ac.subs.show=!1,m.ac.video.show=!1,m.ac.quest.show=!1,m.ac.page.show=!1,m.ac.step.show=!1,d.resetInactivityTimeout()):b.page.template===j.TMP_01?(0===a.pageIndex&&(m.ac.prev.show=!1),m.ac.quest.show=!1,a.allowHideControls=!0,m.ac.video.show=!0,m.ac.step.show=b.page.stepMode,m.ac.displayProgress.show=b.page.showProgress,a.forcedStepMode&&(m.ac.step.show=!0,m.ac.displayProgress.show=!0),b.mainData.strictMode&&(m.ac.next.disabled=b.pagePerc>=b.chapter.percent)):b.page.template===j.PPT?(0===a.pageIndex&&(m.ac.prev.show=!1),m.ac.quest.show=!1,a.allowHideControls=!0,m.ac.video.show=!1,m.ac.step.show=!1,m.ac.stepPrev.show=!1,m.ac.displayProgress.show=!0,b.mainData.strictMode&&(m.ac.next.disabled=b.pagePerc>=b.chapter.percent)):b.page.template===j.Q1||b.page.template===j.Q2?(b.mobile&&(a.menuStyle.leftBottomText.display="none"),b.previewMode?(m.ac.next.show=!1,m.ac.prev.show=!1,m.ac.menu.show=!1,m.ac.video.show=!1,m.ac.step.show=!1):(m.ac.next.show=!1,m.ac.prev.show=!1,b.chapter.assessment&&b.mobile&&(a.allowHideControls=!0),b.chapter.assessment&&!b.mobile&&(a.allowHideControls=!1),(0===a.pageIndex||b.chapter.assessment&&b.pagesOrder[a.pageIndex].type===k.QUEST)&&(m.ac.prev.show=!1),b.chapter.assessment&&b.pagesOrder[a.pageIndex].type===k.QUEST&&(m.ac.menu.show=!1),m.ac.video.show=!1,b.chapter.assessment&&b.pagesOrder[a.pageIndex].type===k.QUEST&&(m.ac.reload.show=!1),m.ac.step.show=!1,b.mainData.strictMode&&(m.ac.next.disabled=b.pagePerc>=b.chapter.percent))):b.page.template===j.VID?(0===a.pageIndex&&(m.ac.prev.show=!1),m.ac.quest.show=!1,a.allowHideControls=!0,m.ac.step.show=!1,b.mainData.strictMode&&(m.ac.next.disabled=b.pagePerc>=b.chapter.percent),m.ac.videoProgress.show=!0):b.page.template===j.SELF_ASSESSMENT_INTRO?(b.mobile&&(a.menuStyle.leftBottomText.display="none"),0===a.pageIndex&&(m.ac.prev.show=!1),m.ac.quest.show=!1,m.ac.video.show=!1,m.ac.reload.show=!1,m.ac.subs.show=!1,m.ac.step.show=!1,m.ac.next.active=!0,d.resetInactivityTimeout()):b.page.template===j.ASSESSMENT_INTRO?(b.mobile&&(a.menuStyle.leftBottomText.display="none"),0===a.pageIndex&&(m.ac.prev.show=!1),m.ac.quest.show=!1,m.ac.video.show=!1,m.ac.reload.show=!1,m.ac.subs.show=!1,m.ac.step.show=!1,m.ac.next.active=!0,d.resetInactivityTimeout()):b.page.template===j.ASSESSMENT_RESULT?(b.mobile&&(a.menuStyle.leftBottomText.display="none"),m.ac.prev.show=!1,m.ac.menu.show=!0,m.ac.quest.show=!1,m.ac.video.show=!1,m.ac.reload.show=!1,m.ac.subs.show=!1,m.ac.step.show=!1,m.ac.next.active=!0,d.resetInactivityTimeout()):b.page.template===j.CHAPTER_END?(m.ac.vol.show=!1,m.ac.next.show=!1,m.ac.quest.show=!1,m.ac.video.show=!1,m.ac.reload.show=!1,m.ac.subs.show=!1,m.ac.step.show=!1,d.resetInactivityTimeout()):b.page.template===j.ADAPTIVE?(m.ac.next.show=!1,m.ac.next.disabled=b.pagePerc<=b.chapter.percent,m.ac.quest.show=!1,m.ac.step.show=!1,(0===a.pageIndex||b.chapter.assessment&&b.pagesOrder[a.pageIndex].type===k.QUEST)&&(m.ac.prev.show=!1),m.ac.video.show=!1,m.ac.reload.show=!1,a.allowHideControls=!1):(0===a.pageIndex&&(m.ac.prev.show=!1),m.ac.quest.show=!1,m.ac.video.show=!1,m.ac.step.show=!1,d.resetInactivityTimeout()),b.scorm&&(m.ac.menu.show=!1,m.ac.burgerMenu.show=!0,b.page.template===j.ASSESSMENT_INTRO&&(m.ac.next.show=!b.chapter.alreadyScored,m.ac.burgerMenu.show=!m.ac.burgerMenu.show),b.chapter.alreadyScored&&(m.ac.burgerMenu.show=!0,m.ac.vol.show=!m.ac.vol.show),b.page.template===j.WELCOME&&(m.ac.exit.show=!1),b.page.template!==j.ASSESSMENT_RESULT&&b.page.template!==j.CHAPTER_END||(m.ac.vol.show=!1),b.page.template===j.CHAPTER_END&&b.chapter.assessment&&(m.ac.prev.show=!1)))}),b.$watch("glassLayerActive",function(){b.$broadcast(i.PRELOADING_FINISHED),b.glassLayerActive&&(m.ac.next.prevState=jQuery.extend(!0,[],m.ac.next),m.ac.prev.prevState=jQuery.extend(!0,[],m.ac.prev),m.ac.video.prevState=jQuery.extend(!0,[],m.ac.video),m.ac.play.prevState=jQuery.extend(!0,[],m.ac.play),m.ac.pause.prevState=jQuery.extend(!0,[],m.ac.pause),m.ac.quest.prevState=jQuery.extend(!0,[],m.ac.quest),m.ac.done.prevState=jQuery.extend(!0,[],m.ac.done),m.ac.videoProgress.prevState=jQuery.extend(!0,[],m.ac.videoProgress),m.ac.step.prevState=jQuery.extend(!0,[],m.ac.step),m.ac.displayProgress.prevState=jQuery.extend(!0,[],m.ac.displayProgress),m.ac.next.show=!1,m.ac.prev.show=!1,m.ac.play.show=!1,m.ac.pause.show=!1,m.ac.quest.show=!1,m.ac.done.show=!1,m.ac.page.show=!0,m.ac.step.show=!1,m.ac.video.show=!1,m.ac.videoProgress.show=!1,m.ac.displayProgress.show=!1,m.videoSlider.value=0,m.previousDisplayPercent=0,d.stopInactivityTimeout(),b.glassData.template===j.TMP_01?(m.ac.quest.show=!1,m.ac.video.show=!0,m.ac.step.show=b.glassData.stepMode,m.ac.displayProgress.show=b.glassData.showProgress,a.forcedStepMode&&(m.ac.step.show=!0,m.ac.displayProgress.show=!0)):b.glassData.template===j.Q1||b.glassData.template===j.Q2?(b.mobile&&(a.menuStyle.leftBottomText.display="none"),m.ac.video.show=!1,m.ac.step.show=!1,m.ac.quest.show=!0,m.ac.done.show=!0):b.glassData.template===j.VID&&(m.ac.quest.show=!1,m.ac.step.show=!1,m.ac.videoProgress.show=!0))}),a.$watch("$root.subPageData",function(c,e){if(b.page)if(d.stopInactivityTimeout(),a.subPageData)m.ac.displayProgress.show=!1,a.subPageData.template===j.TMP_01?(m.ac.video.show=a.subPageData.cover,m.ac.step.show=b.subPageData.stepMode,m.ac.displayProgress.show=b.subPageData.showProgress):a.subPageData.template===j.VID?(m.ac.videoProgress.show=!0,
m.ac.video.show=!0):a.subPageData.template===j.Q1||a.subPageData.template===j.Q2?(b.mobile&&(a.menuStyle.leftBottomText.display="none"),m.ac.quest.show=!0,m.ac.done.show=!0,m.ac.video.show=!a.subPageData.cover):a.subPageData.template===j.ADAPTIVE&&(m.ac.quest.show=!1,m.ac.step.show=!1,m.ac.video.show=!1,m.ac.reload.show=!1,a.allowHideControls=!1),a.subPageData.cover&&(m.ac.next.show=a.subPageData.auto,m.ac.prev.show=!0);else{if(!e)return;m.ac.prev.show=0!==a.pageIndex,m.ac.prev.active=!1,m.ac.next.show=!0,m.ac.quest.show=!1,m.ac.continue.show=!1,a.allowHideControls=!0,m.ac.video.show=!0,m.ac.videoProgress.show=!1,m.ac.step.show=b.page.stepMode,m.ac.displayProgress.show=b.page.showProgress}}),a.$watch("$root.subGlassData",function(){b.glassLayerActive&&(d.stopInactivityTimeout(),null===b.subGlassData?(m.ac.prev.show=!1,m.ac.next.show=!1,m.ac.done.show=!1,m.ac.videoProgress.show=!1,m.ac.continue.show=!1,d.resetInactivityTimeout()):(a.subGlassData.template===j.TMP_01?(m.ac.video.show=a.subGlassData.cover,m.ac.step.show=b.subGlassData.stepMode,m.ac.displayProgress.show=b.subGlassData.showProgress):a.subGlassData.template===j.VID?(m.ac.videoProgress.show=!0,m.ac.video.show=!0):a.subGlassData.template!==j.Q1&&a.subGlassData.template!==j.Q2||(b.mobile&&(a.menuStyle.leftBottomText.display="none"),m.ac.quest.show=!0,m.ac.done.show=!0,m.ac.video.show=!a.subGlassData.cover),a.subGlassData.cover&&(m.ac.next.show=a.subGlassData.auto,m.ac.prev.show=!0)))}),m.controlsBlocked=function(){return m.timeoutBlocked||b.glossaryVisible||b.alertVisible},m.modulePercent=function(){var a=0,c=0;angular.forEach(b.mainData.chapters,function(b){b.num>0&&(a+=b.percent,c++)});var d=a/c;return Math.round(d)},a.togglePause=function(){!m.ac.pause.disabled&&m.ac.pause.show?m.pause():!m.ac.play.disabled&&m.ac.play.show&&m.play()},m.pause=function(){m.ac.pause.disabled||!m.ac.pause.show||m.controlsBlocked()||(b.$broadcast(i.PAUSE),l())},m.seek=function(){m.controlsBlocked()||(b.$broadcast(i.SEEK,m.videoSlider.value),m.seeking=!0)},m.seekEnd=function(){m.controlsBlocked()||(l(),g(function(){b.$broadcast(i.SEEK_END),m.seeking=!1},50))},m.play=function(){m.ac.play.disabled||!m.ac.play.show||m.controlsBlocked()||(b.$broadcast(i.PLAY),l())},m.done=function(){m.ac.done.disabled||!m.ac.done.show||m.controlsBlocked()||(b.chapter.assessment&&b.pagesOrder.length&&b.pagesOrder[a.pageIndex].type===k.QUEST&&!m.ac.done.active?b.$broadcast(i.ALERT,b.translation.WARNING,b.translation.PROVIDE_ANSWER,["OK","OK"],null,function(){}):(b.$broadcast(i.CHECK),m.ac.quest.show=!1,a.subPageData||b.glassLayerActive?(b.subPageData&&b.subPageData.cover||b.subGlassData&&b.subGlassData.cover)&&(m.ac.prev.active=!b.subPageData.auto):(m.ac.next.show=!0,m.ac.next.active=!0,m.ac.prev.show=!0,m.ac.prev.active=!0)),l())},m.stepClick=function(a){m.ac.step.disabled||!m.ac.step.show||m.controlsBlocked()||(b.$broadcast(i.NEXT_STEP),l())},m.stepPrevClick=function(a){m.ac.stepPrev.disabled||!m.ac.stepPrev.show||m.controlsBlocked()||b.$broadcast(i.PREV_STEP)},m.prevClick=function(c){if(!m.ac.prev.disabled&&m.ac.prev.show&&!m.controlsBlocked()){if(b.glassLayerActive)b.subGlassData&&b.subGlassData.cover&&(b.subGlassData=null);else if(b.subPageData&&b.subPageData.cover)b.subPageData.auto?(b.subPageData=null,a.pageIndex>=0&&a.nav.page--):b.subPageData=null;else if(b.page.template===j.MENU)a.nav.page=j.WELCOME;else if(b.page.template===j.CHAPTER_END&&b.chapter.assessment){for(var d=-1,e=0;e<b.pagesOrder.length;e++)b.pagesOrder[e].name===j.ASSESSMENT_INTRO&&(d=e);d>-1&&(a.nav.page=d)}else a.pageIndex>=0&&a.nav.page--;l()}},a.playerSwipe=function(a){2==a.direction?m.ac.next.show&&!m.ac.next.disabled&&m.nextClick():4==a.direction?m.ac.prev.show&&!m.ac.prev.disabled&&m.prevClick():8==a.direction?(b.resetControls=!0,g(function(){b.resetControls=!1},500)):16==a.direction&&(b.resetControls=!1)},m.nextClick=function(d){(!m.ac.next.disabled&&m.ac.next.show&&!m.controlsBlocked()||d)&&(b.page.template===j.WELCOME?(b.scorm?0===b.numQuestions&&1===b.numPages?a.nav.page=j.CHAPTER_END:c.getBookmark()?b.$broadcast(i.ALERT,b.translation.BOOKMARK_ALERT_TITLE,b.translation.BOOKMARK_ALERT_QUESTION,[b.translation.BOOKMARK_ALERT_NO_BTN,b.translation.BOOKMARK_ALERT_YES_BTN,b.translation.BOOKMARK_ALERT_CANCEL_BTN],function(){b.$broadcast(i.ALERT_DISMISSED),b.nav.page=c.getBookmark()},function(){b.$broadcast(i.ALERT_DISMISSED),a.nav.page=0},function(){c.clearBookmark(b.chapter.pagesNum),b.$broadcast(i.ALERT_DISMISSED),a.nav.page=0}):a.nav.page=0:a.nav.page=j.MENU,b.hasLocalStorage&&localStorage.setItem("prefferedLang",b.session.level)):b.subPageData&&b.subPageData.cover&&b.subPageData.auto||d?(b.subPageData=null,a.nav.page++):a.pageIndex>=0&&a.nav.page++,l())},b.exitClick=function(){m.exitClick()},m.exitClick=function(){function d(){angular.forEach(m.ac,function(a,b){a.disabled=!0}),m.videoSlider.options.disabled=!0,b.scorm?c.quitPlayer():typeof parent.HideHtml5Preview==typeof Function?parent.HideHtml5Preview():e.location.href="http://"+location.host}m.ac.exit.disabled||!m.ac.exit.show||m.controlsBlocked()||(b.chapter?b.chapter.percent<100?(m.videoSlider.options.disabled=!0,b.$broadcast(i.ALERT,b.translation.CONFIRM,b.translation.QUIT_CONFIRMATION,["OK","Cancel"],function(){!a.chapter.assessment&&b.scorm&&c.chapterCompleted()?b.statusInfo=null:b.statusInfo=b.translation.SESSION_INCOMPLETE_STATUS_INFO,d()},function(){m.videoSlider.options.disabled=!1,b.$broadcast(i.ALERT_DISMISSED)})):(b.$broadcast(i.QUITTING),a.chapter.assessment?b.chapter.alreadyScored&&a.page.template==j.ASSESSMENT_INTRO?b.statusInfo=null:b.statusInfo=b.translation.SESSION_ASSESMENT_COMPLETE_STATUS_INFO:b.statusInfo=b.translation.SESSION_COMPLETE_STATUS_INFO,d()):d(),l())},m.toggleSound=function(){m.ac.vol.disabled||!m.ac.vol.show||m.controlsBlocked()||(b.session.soundEnabled=!b.session.soundEnabled,l())},m.toggleSubtitles=function(){m.ac.subs.disabled||!m.ac.subs.show||m.controlsBlocked()||(b.session.subtitlesVisible=!b.session.subtitlesVisible,l())},m.menuClick=function(){m.ac.menu.disabled||!m.ac.menu.show||m.controlsBlocked()||(b.nav.chapterNum=null,b.$broadcast(i.PRELOADING_FINISHED),a.nav.page=j.MENU,l())},a.popup="popup-menu__hidden",a.showHidePopupMenu=function(c){b.mobile?c||"popup-menu__hidden"!==a.popup?c?(a.popup="popup-menu__hidden",c.preventDefault(),a.allowHideControls=!0):"popup-menu__mobile"===a.popup&&(a.popup="popup-menu__hidden",a.allowHideControls=!0):(a.popup="popup-menu__mobile",a.allowHideControls=!1):c||"popup-menu__hidden"!==a.popup?c?(a.popup="popup-menu__hidden",c.preventDefault()):"popup-menu"===a.popup&&(a.popup="popup-menu__hidden"):a.popup="popup-menu"},m.showPopupMenu=function(){b.isWelcomePopupShown=!b.isWelcomePopupShown,m.pause()},m.reloadPage=function(){b.glassLayerActive||m.ac.reload.disabled||!m.ac.reload.show||m.controlsBlocked()||(b.$broadcast(i.REPLAY),a.subPageData?a.subPageData.template===j.Q1||a.subPageData.template===j.Q2?m.ac.quest.show=!0:a.subPageData.template===j.TMP_01&&(a.allowHideControls=!0,m.ac.video.show=!0):a.page.template===j.Q1||a.page.template===j.Q2?(m.ac.quest.show=!0,m.ac.next.show=!1):a.page.template===j.TMP_01&&(a.allowHideControls=!0,m.ac.video.show=!0),m.ac.next.active=!1,m.ac.prev.active=!1,l())},m.closeSubpage=function(){m.controlsBlocked()||(b.subPageData=null,b.subGlassData=null,m.ac.continue.show=!1,l())},m.toggleGlossary=function(){m.ac.glossary.disabled||!m.ac.glossary.show||m.timeoutBlocked||b.alertVisible||(b.glossaryVisible=!b.glossaryVisible,m.videoSlider.options.disabled=b.glossaryVisible,b.glossaryVisible?(b.$broadcast(i.GLOSSARY_ON),d.resetInactivityTimeout()):b.$broadcast(i.GLOSSARY_DISMISSED))},a.$on(i.PAGE_FINISHED,function(c,e){if(e){var f=null;b.subPageData?f=b.subPageData:b.glassLayerActive&&b.subGlassData&&(f=b.subGlassData),f&&f.cover?(m.ac.continue.show=f.auto,m.ac.video.show=!1,m.ac.prev.active=!f.auto):b.mainData.strictMode&&b.hasSubpages&&(b.allSubpagesVisited||b.page.disableStrictSubpage)&&(m.ac.next.disabled=!1),f&&f.cover&&"autoback"===f.subPageMode?m.closeSubpage():b.subPageData&&b.subPageData.cover&&"autoadvance"===b.subPageData.subPageMode&&!b.glassLayerActive&&m.nextClick(!0)}else b.glassLayerActive||(b.mainData.strictMode&&b.hasSubpages?(b.allSubpagesVisited||b.page.disableStrictSubpage)&&(m.ac.next.disabled=!1):m.ac.next.disabled=!1,b.page.autoAdvance||b.chapter.assessment&&b.pagesOrder.length&&b.pagesOrder[a.pageIndex].type===k.QUEST?m.nextClick(!0):(b.page.template===j.ADAPTIVE&&(m.ac.next.show=!0),m.ac.next.active=!0));a.allowHideControls=!1,m.ac.video.show=!1,m.ac.videoProgress.show=!1,d.resetInactivityTimeout()}),a.contextMenuFunc=function(a){if(!b.mobile){a.preventDefault();var c=(a.pageX-b.playerDOM.offset().left)/b.calcScale,d=(a.pageY-b.playerDOM.offset().top)/b.calcScale;b.$broadcast(i.CONTEXT_REQUESTED,c,d)}},a.mobileContextMenuFunc=function(a){var c=(a.center.x-b.playerDOM.offset().left)/b.calcScale,d=(a.center.y-b.playerDOM.offset().top)/b.calcScale;b.$broadcast(i.CONTEXT_REQUESTED,c,d)},a.currentTTBtn=null,a.showToolTipMobile=function(c){b.mobile&&(a.currentTTBtn=c,c.tt=!0)},a.playerTouchEndHandler=function(){d.resetInactivityTimeout(!0),a.currentTTBtn&&(a.currentTTBtn.tt=!1,a.currentTTBtn=null)},b.$on(i.VIDEO_PLAYING,function(b,c){m.ac.play.show=!1,m.ac.pause.show=!0,a.$broadcast("rzSliderForceRender"),d.stopInactivityTimeout()}),b.$on(i.VIDEO_HIDE_CONTROLS,function(a,b){m.ac.video.show=!b,m.ac.videoProgress.show=!b}),b.$on(i.VIDEO_TIME_CHANGE,function(b,c,d){m.seeking||(m.videoSlider.value=100*c/d,a.currTimeString=toHHMMSS(c),a.totalTimeString=toHHMMSS(d))}),b.$on(i.VIDEO_BUFFER,function(b,c){m.currentBufferPercents=c,a.safeApply()}),b.$on(i.VIDEO_CUE_PERCENTS,function(a,b){m.cuePercents=b}),b.$on(i.VIDEO_PAUSED,function(a,b){m.ac.play.show=!0,m.ac.pause.show=!1,d.resetInactivityTimeout()}),b.$on(i.PRELOADING_FINISHED,function(a,c){b.page&&b.page.template===j.WELCOME&&b.mainData.isSkiped&&"allPages"===c?m.nextClick(!0):b.page&&b.page.template===j.WELCOME&&b.mainData.customWelcome&&b.mainData.customWelcome.skip&&"allPages"===c&&m.nextClick(!0)}),b.$on(i.QUESTION_FULLY_DISPLAYED,function(a,b){d.resetInactivityTimeout()}),a.$on(i.ANSWER_GIVEN,function(a,b){m.ac.done.active=b}),a.$on(i.STEP_CHANGE,function(c,e,f,g){var h=e;a.forcedStepMode&&a.page.template===j.TMP_01&&(h=!0,m.ac.displayProgress.show=!0),m.ac.step.show=h,m.currentStep=Math.max(f,0)+1,m.numSteps=g,h?(m.ac.step.active=!1,m.ac.step.disabled=f>=g-1,m.ac.stepPrev.disabled=f<1):m.ac.step.disabled=!0,b.mainData.strictMode&&(m.ac.step.disabled=b.pagePerc>=b.chapter.percent,d.stopInactivityTimeout()),m.previousDisplayPercent=100*Math.max(m.currentStep-1,0)/m.numSteps,m.currentDisplayPercent=100*m.currentStep/m.numSteps}),a.$on(i.STEP_FINISHED,function(a,c,e){c>=0&&c<e-1&&(m.ac.step.active=!0),m.ac.step.disabled=c>=e-1;var f=c+1;m.previousDisplayPercent=100*f/e,b.mainData.strictMode&&d.resetInactivityTimeout()}),a.mousePlayerMove=function(c){d.resetInactivityTimeout(!0),b.mobile||(a.mouseXPos=(c.pageX-$(c.currentTarget).offset().left)/b.calcScale|0,a.mouseYPos=(c.pageY-$(c.currentTarget).offset().top)/b.calcScale|0,b.mainData.toolbarAutoHide&&(a.mouseYPos>b.mainData.height-200?a.toggleControls(!0,6e5):a.toggleControls(!1,500)))},a.showMobileControls=function(c){d.resetInactivityTimeout(!0),b.mobile&&a.toggleControls(!0,1500)};var n;a.toggleControls=function(c,d){c?(d||(d=500),n&&g.cancel(n),b.resetControls=!0,n=g(function(){a.toggleControls(!1)},d)):b.resetControls&&d?(n&&g.cancel(n),n=g(function(){a.toggleControls(!1)},d)):(b.resetControls=!1,n=null)},m.toFullScreen=function(){b.mobile||(b.isFullScreen=!b.isFullScreen,document.addEventListener("keydown",function(a){27===a.keyCode&&(b.isFullScreen=!1)})),b.mobile&&m.toFullScreenMobile()},m.toFullScreenMobile=function(){var a=window.document,b=a.documentElement,c=b.requestFullscreen||b.mozRequestFullScreen||b.webkitRequestFullScreen||b.msRequestFullscreen,d=a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen;a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?d.call(a):c.call(b)},m.fullscreen=function(){!m.ac.fs.disabled&&m.ac.fs.show&&(b.mobile||(b.session.fullScreen?exitFullscreen():launchIntoFullscreen()))},b.$watch("calcScale",function(){b.getPlayerDOM(!0),m.videoSlider.options.scale=1/b.calcScale}),b.$on(i.GLASS_LAYER,function(a){}),b.$on(i.GLASS_LAYER_DISMISSED,function(a){m.ac.next=m.ac.next.prevState,m.ac.prev=m.ac.prev.prevState,m.ac.check=m.ac.done.prevState,m.ac.video=m.ac.video.prevState,m.ac.done=m.ac.done.prevState,m.ac.quest=m.ac.quest.prevState,m.ac.videoProgress=m.ac.videoProgress.prevState,m.ac.step=m.ac.step.prevState,m.ac.displayProgress=m.ac.displayProgress.prevState,m.ac.pause.show=!0,m.ac.next.prevState=null,m.ac.prev.prevState=null,m.ac.done.prevState=null,m.ac.quest.prevState=null,m.ac.video.prevState=null,m.ac.play.prevState=null,m.ac.pause.prevState=null,m.ac.videoProgress.prevState=null,m.ac.step.prevState=null,m.ac.displayProgress.prevState=null})};return a.$inject=["$scope","$rootScope","SCORMService","inactivityCounter","$window","$location","$timeout","sessionData","EVENTS","TEMPLATES","PAGE_TYPES"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/controls/controls.html"),controller:a,controllerAs:"controlsCtrl"}}),app.directive("devPanel",function(){var a=function(a,b,c,d,e,f,g,h,i){a.devPanelVisible=!1;var j=jQuery.extend(!0,{},d.mainData);a.pageTarget={value:null},a.showAllQuestions={value:!1},a.showCorrectAnswers={value:!1},a.fastForward={value:!1},a.forceStepMode={value:!1},a.debugMinimized=!1,a.showTicks=!1,a.forcedStepMode=!1,a.pageTitles=null;var k=null;a.hideDev=function(){k&&e.cancel(k),a.devPanelVisible=!1,a.pageTarget.value=null,a.showAllQuestions.value=!1,a.fastForward.value=!1,a.forceStepMode.value=!1,a.debugMinimized=!1,a.showTicks=!1,a.forcedStepMode=!1,d.mainData.toolbarAutoHide=j.toolbarAutoHide,a.showCorrectAnswers.value=!1,d.debugShowCorrectAnswers=!1,a.pageTitles=null},a.debugToggle=function(){a.devPanelVisible?a.hideDev():(a.pageTarget.value=isNaN(d.nav.page)?null:a.pageIndex+1,a.devPanelVisible=!0,d.mainData.toolbarAutoHide=!1,a.showTicks=!0)},a.toggleForceStepMode=function(){a.devPanelVisible&&(a.forcedStepMode=a.forceStepMode.value,a.page&&a.page.template==i.TMP_01&&d.$broadcast(g.REPLAY))},a.jumpToPage=function(){a.pageTarget.value>0&&a.pageTarget.value<=d.pagesOrder.length&&(d.nav.page=a.pageTarget.value-1)},a.toggleList=function(){a.pageTitles?a.pageTitles=null:(a.pageTitles=[],angular.forEach(d.pagesOrder,function(b){if(b.type===h.PANEL)a.pageTitles.push(a.pageTitles.length+1+". PANEL: "+b.name);else{var c=d.pagesData[b.id];c&&(c.title.trim()?a.pageTitles.push(a.pageTitles.length+1+". "+c.title):c.texts[0].text?a.pageTitles.push(a.pageTitles.length+1+". ..."+c.texts[0].text):a.pageTitles.push(a.pageTitles.length+1+". TEMPLATE: "+c.template.toUpperCase()))}}))},a.pageTitleSelected=function(b){a.pageTarget.value=b+1,a.pageTitles=null,a.jumpToPage()},a.$watch("$root.nav.page",function(){a.inactivityTime=f.inactivityTime(),a.activeTime=toHHMMSS(f.activeTime()/1e3),a.totalTime=toHHMMSS(f.totalTime()/1e3)}),a.$watch("$root.nav.chapterNum",function(){a.devPanelVisible&&d.chapter&&(a.showAllQuestions.value?(d.chapter.ordered=!0,d.chapter.qinfos=null,d.chapter.numSelQuest=d.chapter.numQuest):(d.chapter.ordered=j.chapters[a.chapterID].ordered,d.chapter.qinfos=j.chapters[a.chapterID].qinfos,d.chapter.numSelQuest=j.chapters[a.chapterID].numSelQuest)),a.pageTitles=null}),a.allQuestionsChange=function(){if(d.chapter){var a=d.nav.chapterNum;d.nav.chapterNum=null,c(function(){d.nav.chapterNum=a,d.nav.page=0},100)}},a.correctAnswersChange=function(){d.debugShowCorrectAnswers=a.showCorrectAnswers.value},a.$on(g.STEP_CHANGE,function(b,c,d,e){a.debugCurrStep=d+1,a.debugNumSteps=e}),a.debugNextPO=function(){(a.page.template==i.TMP_01||a.page.template==i.VID&&a.debugCurrStep<=a.debugNumSteps)&&d.$broadcast(g.NEXT_STEP)},a.debugPrevPO=function(){(a.page.template==i.TMP_01||a.page.template==i.VID&&a.debugCurrStep>1)&&d.$broadcast(g.PREV_STEP)},a.minimizeDevToggle=function(){a.debugMinimized=!a.debugMinimized},a.getPageIndex=function(b){if(d.previewMode&&!d.previewQuestion)return d.nav.page;if(d.pagesOrder[a.pageIndex]&&d.pagesOrder[a.pageIndex].type==h.PAGE)for(var c=0;c<d.chapter.pages.length;c++)if(d.chapter.pages[c].id==b)return c+1;return null},a.getQuestIndex=function(b){if(d.previewMode&&d.previewQuestion)return d.nav.page;if(d.pagesOrder[a.pageIndex]&&d.pagesOrder[a.pageIndex].type==h.QUEST)for(var c=0;c<d.chapter.questions.length;c++)if(d.chapter.questions[c].id==b)return c+1;return null},a.toggleFastForward=function(){k&&e.cancel(k),d.session.soundEnabled=!0,a.fastForward.value&&(d.session.soundEnabled=!1,k=e(function(){a.debugNextPO()},300))},d.$on(g.VIDEO_PLAYING,function(){a.debugPaused=!1}),d.$on(g.VIDEO_PAUSED,function(){a.debugPaused=!0}),d.$on("keydown",function(b,c){f.resetInactivityTimeout(!0),83==c.keyCode&&c.ctrlKey&&c.altKey?a.$apply(function(){a.debugToggle()}):a.devPanelVisible&&(32==c.keyCode?a.fastForward.value||a.$apply(function(){a.togglePause()}):70==c.keyCode?a.$apply(function(){a.fastForward.value=!a.fastForward.value,a.toggleFastForward()}):34==c.keyCode?isNaN(d.nav.page)?d.nav.page==i.WELCOME&&a.$apply(function(){d.nav.page=i.MENU}):(a.pageTarget.value=d.nav.page+2,a.$apply(function(){a.jumpToPage()})):33==c.keyCode?isNaN(d.nav.page)?d.nav.page==i.MENU&&a.$apply(function(){d.nav.page=i.WELCOME}):(a.pageTarget.value=d.nav.page,a.$apply(function(){a.jumpToPage()})):39==c.keyCode?a.fastForward.value||a.$apply(function(){a.debugNextPO()}):37==c.keyCode?a.fastForward.value||a.$apply(function(){a.debugPrevPO()}):83==c.keyCode?a.$apply(function(){a.forceStepMode.value=!a.forceStepMode.value,a.toggleForceStepMode()}):67==c.keyCode?a.$apply(function(){a.showCorrectAnswers.value=!a.showCorrectAnswers.value,a.correctAnswersChange()}):77==c.keyCode&&c.ctrlKey&&a.$apply(function(){a.minimizeDevToggle()}))})};return a.$inject=["$scope","$document","$timeout","$rootScope","$interval","inactivityCounter","EVENTS","PAGE_TYPES","TEMPLATES"],{restrict:"E",replace:"true",templateUrl:"htmlViewer/components/devPanel/devPanel.html",controller:a}}),app.directive("glassLayer",function(){var a=function(a,b,c,d){a.toggleGlassLayer=function(){b.glassTemplate=b.glassData.template,b.glassLayerActive?(b.glassLayerActive=!1,b.subGlassData=null,b.$broadcast(d.GLASS_LAYER_DISMISSED)):(b.glassLayerActive=!0,b.$broadcast(d.GLASS_LAYER))},a.$on("$destroy",function(){})};return a.$inject=["$scope","$rootScope","TEMPLATES","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/glassLayer/glassLayer.html"),controller:a,controllerAs:"glassLayerCtrl"}}),app.directive("glossary",function(){var a=function(a,b,c,d){a.closeGlossary=function(){b.glossaryVisible=!1,b.$broadcast(d.GLOSSARY_DISMISSED)},a.termSelected=function(b){a.searchText===b?a.searchText="":a.searchText=b,a.updateEntries()},a.isSelected=function(b){return a.searchText&&a.searchText.toLowerCase()===b.toLowerCase()},a.clearSearch=function(){a.searchText="",a.updateEntries()},a.filteredEntries=b.mainData.glossary,a.updateEntries=function(){a.filteredEntries=c("glossaryFilter")(b.mainData.glossary,a.searchText)}};return a.$inject=["$scope","$rootScope","$filter","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/glossary/glossary.html"),controller:a}}),app.filter("glossaryFilter",glossaryFilter),app.directive("menuPanel",function(){var a=function(a,b,c,d){a.titleString=c.translation.MENU_PANEL_TITLE,a.visible=!1;var e=this,f=50,g=a.mainData.height-f-defaults.controls.height;a.chapContStyle={top:f+"px",height:g+"px","margin-right":"12px"},e.waited=!1,b(function(){e.waited=!0,a.visible=!0},10),a.barWidth=function(a){return{width:e.waited?a.percent+"%":0}},a.startChapter=function(a){c.nav.chapterNum=a,c.nav.page=0}};return a.$inject=["$scope","$timeout","$rootScope","TEMPLATES"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/menuPanel/menuPanel.html"),controller:a}}),app.directive("objectivesPanel",function(){var a=function(a,b,c,d,e){a.$on("$destroy",function(){finishPage()})};return a.$inject=["$scope","$interval","$timeout","$rootScope","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/objectivesPanel/objectivesPanel.html"),controller:a,controllerAs:"objCtrl"}}),app.directive("sgPreloader",function(){var a=function(a,b,c){a.percent=0,a.preloading=!1,a.$on(c.PRELOADING,function(b,c){a.preloading=!0,a.percent=c}),a.$on(c.PRELOADING_FINISHED,function(b){a.preloading=!1})};return a.$inject=["$scope","$rootScope","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/preloader/preloader.html"),controller:a}}),app.directive("pageTitle",function(){return{restrict:"E",replace:"true",scope:!0,template:"<h1 class=\"pageTitle\"\n    ng-class=\"{'hidden':$root.mainData.titleVisible == 'no',\n    'autohide':$root.mainData.titleVisible == 'autohide',\n    'reset':!visible}\"\n    ng-style=\"$root.mainData.fontStyles['title']\">{{titleString}}</h1> "}}),app.directive("contextMenu",["EVENTS",function(a){var b=function(a,b){a.fullScreenText=function(){return b.session.fullScreen?"Exit fullscreen":"Enter fullscreen"},a.fullscreen=function(){b.mobile||(b.session.fullScreen?exitFullscreen():launchIntoFullscreen())}};return b.$inject=["$scope","$rootScope"],{restrict:"EA",scope:!0,controller:b,template:'<ul id="contextmenu" ng-show="contextVisible" ng-style="contextPosition">\n    <li>Ocean e-learning player v<span app-version></span> HTML</li>\n    <li>Module ID: {{$root.mainData.moduleId}}<br>\n    Module version: {{$root.mainData.version}} ({{$root.mainData.build}})</li>\n    <li ng-show="!$root.mobile" class="active" ng-click="fullscreen()">{{fullScreenText()}}</li>\n    <li class="active">Close</li>\n</ul>',link:function(b){b.$on(a.CONTEXT_REQUESTED,function(a,c,d){b.contextVisible=!0,b.contextPosition={left:c+"px",top:d+"px"}}),b.$on(a.CLICK_ON_PAGE,function(){b.contextVisible=!1})}}}]),app.directive("slider",function(){var a=function(a,b){};return a.$inject=["$scope","$rootScope"],{restrict:"EA",scope:!0,controller:a,template:'<div class="slider-range">\n    <div class="slider-thumb" ng-style="{left:controlsCtrl.currentVideoPercent+\'%\'}"></div>\n</div>',link:function(a){}}}),app.directive("statusInfo",function(){var a=function(a,b){};return a.$inject=["$scope","$rootScope"],{restrict:"EA",scope:!0,controller:a,template:'<div ng-if="statusInfo" class="status-info">{{statusInfo}}</div>',link:function(a){}}}),app.directive("subtitles",function(){var a=function(a,b){var c=a.$watchGroup(["page","isSubpage","isGlass","isSubGlass"],function(){a.page&&(a.subtitlesPresent=a.page.subtitlesPresent),a.isSubpage&&b.glassLayerActive?a.subtitlesPresent=a.subPageData.subtitlesPresent:a.isGlass?a.subtitlesPresent=a.glassData.subtitlesPresent:b.isSubGlass&&(a.subtitlesPresent=a.subGlassData.subtitlesPresent)}),d=null;a.soundText=null,a.$watch("currentStep",function(){a.currentStep<0?(d=null,a.soundText=null):0==a.currentStep?a.page.soundTexts[a.currentStep]&&(a.soundText=a.page.soundTexts[a.currentStep].text,d=a.soundText):(a.page.soundTexts[a.currentStep]&&(a.soundText=a.page.soundTexts[a.currentStep].text),a.soundText?d=a.soundText:a.soundText=d)}),a.showSubtitles=function(){return!!b.session.subtitlesVisible&&(b.glassLayerActive?a.isGlass?!b.subGlassData:a.isSubGlass:!b.subPage||b.subPage&&isSubPage)},a.$on("$destroy",function(){c()})};return a.$inject=["$scope","$rootScope"],{restrict:"E",replace:"true",controller:a,template:'<div ng-if="subtitlesPresent" id="subtitles" ng-class="{\'inProgress\':!pageFinished}" ng-show="showSubtitles()" dir="{{page.textDirection}}"><div ng-if="!pageFinished" class="subtitle"  ng-hide="!soundText || page.soundTexts[currentStep].hideSubtitles">{{soundText}}</div><div ng-if="pageFinished" class="mouseActive"><div class="subtitle finished" ng-repeat="sndTxt in page.soundTexts" ng-show="page.soundTexts[$index].text">{{sndTxt.text}}</div></div></div>'}}),app.directive("keypressEvents",["$document","$rootScope",function(a,b){return{restrict:"A",link:function(){a.bind("keydown",function(a){a.originalEvent.repeat||"input"==document.activeElement.nodeName.toLowerCase()||b.$broadcast("keydown",a,String.fromCharCode(a.which))})}}}]),app.directive("selfAssessmentIntro",function(){var a=function(a,b,c){a.titleString=b.translation.ASSESSMENT_INTRO_PANEL_SELF_TITLE,a.visible=!1,c(function(){a.visible=!0})};return a.$inject=["$scope","$rootScope","$timeout"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/selfAssessmentIntro/selfAssessmentIntro.html"),controller:a}}),app.directive("sgAlert",function(){var a=function(a,b,c,d){var e=this;e.sgAlertShow=!1,e.userAnswered=!1,e.alertCallback=null,e.cancelCallback=null,e.thirdCallback=null,e.btnLabels=null,b.$on(d.ALERT,function(a,d,f,g,h,i,j){e.alertHeader=d,e.alertMessage=f,e.sgAlertShow=!0,e.userAnswered=!1,e.btnLabels=g,e.alertCallback=h,e.cancelCallback=i,e.thirdCallback=j,b.alertVisible=!0,c.resetInactivityTimeout()}),b.$on(d.ALERT_DISMISSED,function(){e.sgAlertShow=!1,b.alertVisible=!1}),a.closeAlert=function(){b.alertVisible=!1,e.userAnswered||(e.userAnswered=!0,e.alertCallback&&e.alertCallback())},a.cancelAlert=function(){e.userAnswered||(b.alertVisible=!1,e.sgAlertShow=!1,e.alertMessage=null,e.alertHeader=null,e.userAnswered=!0,e.btnLabels=null,e.cancelCallback&&e.cancelCallback(),e.alertCallback=null,e.cancelCallback=null)},a.alertThirdFunction=function(){e.userAnswered||(e.userAnswered=!0,e.thirdCallback&&e.thirdCallback())},a.closeWithX=function(){e.cancelCallback?a.cancelAlert():e.alertCallback&&a.closeAlert()}};return a.$inject=["$scope","$rootScope","inactivityCounter","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/sgAlert/sgAlert.html"),controller:a,controllerAs:"sgAlertCtrl"}}),app.directive("subGlass",function(){var a=function(a){a.isSubGlass=!0};return a.$inject=["$scope"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/subGlass/subGlass.html"),controller:a,controllerAs:"subGlassCtrl"}}),app.directive("subPage",function(){var a=function(a){a.isSubPage=!0};return a.$inject=["$scope"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/subPage/subPage.html"),controller:a,controllerAs:"subCtrl"}}),app.directive("adaptiveTemplate",function(){var a=function(a,b,c,d,e,f,g,h,i){angular.extend(this,f("abstractTemp01Controller",{$scope:a}));var j={coolingFactor:3,numAlternatives:4,correctPoints:2,incorrectPoints:-1,passingPoints:2,rewriteAt:-2,immediateRewrite:!0,maxSkippedToShowFeedback:8};a.DECLARATION_PHASE=0,a.TEST_PHASE=1,a.TEST_REVERSE_PHASE=2,a.WRITE_PHASE=3,a.WRITE_REVERSE_PHASE=4,a.HEARING_TEST_PHASE=5,a.HEARING_PHASE=6,a.PASSED_PHASE=7,a.DECLARATION_DONE_FEEDBACK="declarationDone",a.IN_PROGRESS_FEEDBACK="inProgress",a.ALL_DONE_FEEDBACK="allDone",a.ERR2_FEEDBACK="twoErrors",a.ERR3_FEEDBACK="threeErrors",a.skippingPhase=null,a.feedback=null,a.feedbackImages=null,a.feedbackImage=null,a.declarationDone=!1,a.testsDone=!1,a.halfDone=!1,a.allDone=!1,a.errFeedbackDone=!1,a.numErrors=0,a.numSkipped=0,a.lastOverall=null,a.assessmentMode=!1,a.assessmentNum=null,a.assessmentScore=null,a.showReport=!1,a.init(c),a.adaptiveData=null,a.langToLearn="EN",a.vertical=!1,a.resetPage=function(){a.resetBegin(a.getProperData()),a.assessmentMode=d.chapter.assessment,b.get(noCacheQuery(a.page.pics[0].src)).then(function(b){var c=getData(b.data,!0);a.adaptiveData=c,a.prepareItems(c),a.assessmentMode&&a.drawItems(a.assessmentNum),a.start()})},a.items=null,a.questionPhases=[],a.allowedPhases=[],a.adaptiveProgress={seen:0,acquainted:0,learned:0,mastered:0,overall:0},a.prepareItems=function(b){a.items=[],a.langToLearn=b.targetLanguage,a.allowedPhases=b.questionTypes,a.assessmentNum=parseInt(b.assessmentNum,10),a.skippingPhase=parseInt(b.skippingPhase,10),a.vertical="horizontal"!==b.displayType,a.numAllowedPhases=a.numAllowedPhasesBefore(a.PASSED_PHASE),a.declarationDone=!a.allowedPhases[0],a.feedbackImages=b.feedbackImages,angular.forEach(b.items,function(b){a.questionPhases.push(a.nextAllowedPhase(-1)),a.items.push(new ALItem(b,a.langToLearn,d.session.level,i.PIC)),a.currIndex=null,a.adaptiveProgress={seen:0,acquainted:0,learned:0,mastered:0,overall:0}})},a.numAllowedPhasesBefore=function(b){for(var c=a.assessmentMode?0:-1,d=0;d<b;d++)a.allowedPhases[d]&&c++;return c},a.drawItems=function(b){var c=[];a.questionPhases=[],b=Math.min(b,a.items.length);for(var d=0;d<b;d++)c.push(a.items.splice(Math.floor(Math.random()*a.items.length),1)[0]),a.questionPhases.push(a.nextAllowedPhase(-1));a.items=c},a.nextAllowedPhase=function(b){for(var c=null,d=b+1;d<a.allowedPhases.length;d++)if(a.allowedPhases[d]){c=d;break}return c},a.start=function(){a.nextQuestion(a.assessmentMode?null:0,1)},a.question=null,a.answers=null,a.showResult=!1,a.showImage=!1,a.showHint=!1,a.showIWasWrong=!1,a.helperMode=!1,a.resetStateBeforeQuestion=function(){angular.forEach(a.items,function(a){a.resetMarkings()}),a.question=null,a.answers=null,a.answerText="",a.showResult=!1,a.showImage=!1,a.helperMode=!1,a.showHint=!1,a.viewPhase=null,a.showIWasWrong=!1},a.nextQuestion=function(b,c){a.resetStateBeforeQuestion(),a.feedback=a.checkForFeedback(),a.feedback?g(function(){a.feedbackWaited=!0},10):g(function(){a.showQuestion(b)},c)},a.checkForFeedback=function(){for(var b={},c=0;c<a.questionPhases.length;c++){var e=a.questionPhases[c];b[e]=b[e]?b[e]+1:1}var f=null;if(a.assessmentMode){if(b[a.PASSED_PHASE]===a.questionPhases.length){var g=0;angular.forEach(a.items,function(a){angular.forEach(a.phasePoints,function(a){a>0&&g++})}),a.assessmentScore=Math.round(100*(g/(a.items.length*a.numAllowedPhases))),f=a.ALL_DONE_FEEDBACK,a.allDone?a.printOrdersFinished():(d.pagesOrder[a.pageIndex].score=a.assessmentScore,d.pagesOrder[a.pageIndex].possibleScore=100,d.pagesOrder[a.pageIndex].adaptive=!0,a.allDone=!0)}}else a.declarationDone||b[a.DECLARATION_PHASE]?a.declarationDone&&!a.allDone&&b[a.PASSED_PHASE]===a.questionPhases.length?(f=a.ALL_DONE_FEEDBACK,a.allDone=!0,a.printOrdersFinished()):a.declarationDone&&a.adaptiveProgress.overall>=a.lastOverall+15?(f=a.IN_PROGRESS_FEEDBACK,a.lastOverall=a.adaptiveProgress.overall):a.errFeedbackDone||2!==a.numErrors?a.errFeedbackDone||3!==a.numErrors||(f=a.ERR3_FEEDBACK,a.errFeedbackDone=!0):(f=a.ERR2_FEEDBACK,a.errFeedbackDone=!0):(a.lastOverall=a.adaptiveProgress.overall,f=a.DECLARATION_DONE_FEEDBACK,a.declarationDone=!0);return f&&(a.showReport=!1,a.feedbackImage=a.getFeedbackImage(f)),f},a.getFeedbackImage=function(b){var c,d=a.feedbackImages&&a.feedbackImages[b]?a.feedbackImages[b]:null;return c=d?d[Math.floor(Math.random()*d.length)]:null,c?i.PIC+c:null},a.showQuestion=function(b){var c=[];if(null===b)for(var d=0;d<a.questionPhases.length;d++)a.questionPhases[d]<a.PASSED_PHASE&&c.push(d);(c.length||null!=b&&a.questionPhases[b]<a.PASSED_PHASE)&&(a.currIndex=null!=b?b:c[Math.floor(Math.random()*c.length)],null===b&&a.items[a.currIndex].cooling>0?(a.items[a.currIndex].cooling--,a.nextQuestion(null,1)):(a.question=a.items[a.currIndex],a.viewPhase=a.questionPhases[a.currIndex],a.viewPhase!==a.DECLARATION_PHASE?(a.question.cooling=j.coolingFactor,a.questionPhases[a.currIndex]===a.TEST_PHASE||a.questionPhases[a.currIndex]===a.TEST_REVERSE_PHASE||a.questionPhases[a.currIndex]===a.HEARING_TEST_PHASE?a.prepareTest(j.numAlternatives,a.currIndex):a.questionPhases[a.currIndex]!==a.WRITE_PHASE&&a.questionPhases[a.currIndex]!==a.WRITE_REVERSE_PHASE||a.prepareWriteTest(a.currIndex),a.showImage=!a.adaptiveData.disableHelperMode&&a.viewPhase!==a.TEST_PHASE&&a.viewPhase!==a.HEARING_TEST_PHASE&&a.question.phasePoints[a.viewPhase]<0,
a.helperMode=!a.adaptiveData.disableHelperMode&&a.question.phasePoints[a.viewPhase]<0,a.viewPhase!==a.HEARING_PHASE&&a.viewPhase!==a.HEARING_TEST_PHASE||a.question.toLearnSounds&&a.question.toLearnSounds[0]&&a.audio.play(i.SOUND+a.question.toLearnSounds[0]).then(function(){})):a.question.toLearnSounds&&a.question.toLearnSounds[0]&&a.audio.play(i.SOUND+a.question.toLearnSounds[0]).then(function(){})))},a.prepareTest=function(b,c){a.question=a.items[c];for(var d=Array.apply(null,{length:a.items.length}).map(Number.call,Number),e=d.splice(c,1),f=0;f<b-1;f++){var g=Math.floor(Math.random()*d.length);e.push(d.splice(g,1)[0])}e=shuffleArray(e);var h=[];angular.forEach(e,function(b){var c=a.items[b];h.push(c)}),a.answers=h},a.prepareWriteTest=function(b){a.viewPhase===a.WRITE_REVERSE_PHASE&&a.question.phasePoints[a.viewPhase]<=j.rewriteAt&&(a.showHint=!0)},a.declaration=function(b){a.applyPhasePoints(b),a.showResult=!0,a.showImage=!0,a.showIWasWrong=b,a.question.skipped=b,a.numSkipped+=b?1:0,a.question.saveAnswer(b,a.viewPhase)},a.declarationWrong=function(){a.viewPhase===a.DECLARATION_PHASE&&(a.question.phasePoints[a.viewPhase]=j.incorrectPoints,a.questionPhases[a.currIndex]=a.TEST_PHASE),a.calculateProgress(),a.continueTest()},a.dontKnow=function(){a.viewPhase===a.DECLARATION_PHASE&&(a.question.phasePoints[a.viewPhase]=j.incorrectPoints,a.questionPhases[a.currIndex]=a.TEST_PHASE),a.calculateProgress(),a.continueTest()},a.selectedAnswerHandler=function(b){if(b){var c=a.question.id===b.id;b.markCorrect=c,b.markIncorrect=!c,a.question.markCorrect=!0,angular.forEach(a.answers,function(c){c&&(c.markHidden=c.id!==b.id&&c.id!==a.question.id)}),a.question.saveAnswer(a.viewPhase===a.TEST_PHASE||a.viewPhase===a.HEARING_TEST_PHASE?b.usersLangWord:b.toLearnWord,a.viewPhase),a.showResult=!0,a.applyPhasePoints(c)}},a.answerSubmit=function(b){a.answerTextCopy=b;var c;a.viewPhase===a.WRITE_PHASE||a.viewPhase===a.HEARING_PHASE?c=a.question.checkCorrect(b,!1):a.viewPhase===a.WRITE_REVERSE_PHASE&&(c=a.question.checkCorrect(b,!0)),a.question.saveAnswer(b,a.viewPhase),c?a.question.markCorrect=!0:a.question.markIncorrect=!0,a.showResult=!0,a.applyPhasePoints(c)},a.applyPhasePoints=function(b){!b&&a.viewPhase===a.WRITE_REVERSE_PHASE&&a.question.skipped?(a.question.phasePoints[a.DECLARATION_PHASE]=j.incorrectPoints,a.question.phasePoints[a.viewPhase]=0,a.questionPhases[a.currIndex]=a.nextAllowedPhase(a.DECLARATION_PHASE),a.question.skipped=!1,a.numSkipped--):a.question.phasePoints[a.viewPhase]+=b?j.correctPoints:j.incorrectPoints,b?a.numErrors=0:a.viewPhase!==a.DECLARATION_PHASE&&(a.numErrors++,a.errFeedbackDone=!1),a.viewPhase===a.DECLARATION_PHASE?a.questionPhases[a.currIndex]=b?a.skippingPhase:a.nextAllowedPhase(a.DECLARATION_PHASE):(a.question.phasePoints[a.viewPhase]>=j.passingPoints||a.assessmentMode)&&(a.questionPhases[a.currIndex]=a.nextAllowedPhase(a.questionPhases[a.currIndex])?a.nextAllowedPhase(a.questionPhases[a.currIndex]):a.PASSED_PHASE),a.calculateProgress(),a.adaptiveProgress.overall<a.lastOverall&&(a.lastOverall=a.adaptiveProgress.overall)},a.calculateProgress=function(){var b=(a.numAllowedPhases*a.questionPhases.length,0),c=0,d=0,e=0,f=0;angular.forEach(a.questionPhases,function(g){g===a.TEST_PHASE?b+=1:g===a.TEST_REVERSE_PHASE?(b+=1,c+=1):g===a.WRITE_PHASE?(b+=1,c+=2):g===a.WRITE_REVERSE_PHASE?(b+=1,c+=2,d+=1):g===a.HEARING_PHASE||g===a.HEARING_TEST_PHASE?(b+=1,c+=2,d+=2):g===a.PASSED_PHASE&&(b+=1,c+=2,d+=2,e+=1),f+=(a.numAllowedPhasesBefore(g)+1)/(a.numAllowedPhases+1)}),a.adaptiveProgress.seen=Math.round(100*b/a.questionPhases.length),a.adaptiveProgress.acquainted=Math.round(100*c/(2*a.questionPhases.length)),a.adaptiveProgress.learned=Math.round(100*d/(2*a.questionPhases.length)),a.adaptiveProgress.mastered=Math.round(100*e/a.questionPhases.length),a.adaptiveProgress.overall=100*f/a.questionPhases.length},a.continueTest=function(){var b=null;a.viewPhase===a.DECLARATION_PHASE?b=a.currIndex<a.items.length-1?a.currIndex+1:null:j.immediateRewrite&&a.viewPhase===a.WRITE_REVERSE_PHASE&&a.question.phasePoints[a.viewPhase]<=j.rewriteAt&&(b=a.currIndex),a.feedbackWaited=!1,a.nextQuestion(b,300)},a.playAudio=function(b,c){a.question.toLearnSound&&a.audio.play(i.SOUND+a.question.toLearnSound).then(function(){}),$("input")[0]?$("input")[0].focus():null},a.declarationBtnStyle=function(a){return{height:.4*d.mainData.height+"px",width:.4*d.mainData.height+"px",left:a?.4*d.mainData.width-.4*d.mainData.height+"px":null,right:a?null:.4*d.mainData.width-.4*d.mainData.height+"px",bottom:.15*d.mainData.height+"px"}},a.testBtnStyle=function(b,c,e){if("horizontal"===a.adaptiveData.displayType){var f=.025*d.mainData.width+b*d.mainData.width*.25;return c?f=.025*d.mainData.width:e&&(f=.025*d.mainData.width+.25*d.mainData.width),{height:.2*d.mainData.width+"px",width:.2*d.mainData.width+"px",left:f+"px",bottom:.2*d.mainData.height+"px"}}var g=.2*d.mainData.height+b*d.mainData.height*.09;return c?g=.2*d.mainData.height+3*d.mainData.height*.09:e&&(g=.2*d.mainData.height),{minHeight:.08*d.mainData.height+"px",width:d.mainData.width-100+"px",left:"50px",bottom:g+"px",alignItems:"flex-start",paddingLeft:"20px"}},a.mainWindowTap=function(b){(a.showResult||a.feedback&&a.feedback!==a.ALL_DONE_FEEDBACK)&&"adaptive-container"===b.target.id&&a.continueTest()},a.langName=function(b){var c=a.viewPhase===a.WRITE_REVERSE_PHASE?a.langToLearn:d.session.level,e=d.translation["LANGUAGE_NAME_"+c];return e?b.replace("#LANG_NAME#",e):b},a.feedbackWaited=!1,a.feedbackBarWidth=function(b){return{width:a.feedbackWaited?b+"%":0}},a.styling=function(b){var c=a.adaptiveData.styles?a.adaptiveData.styles[b]:null;return c}};return a.$inject=["$scope","$http","$attrs","$rootScope","$sce","$controller","$timeout","EVENTS","PREFIX"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/adaptive/adaptive.html"),controller:a,controllerAs:"adaptiveCtrl"}}),app.directive("showFocus",["$timeout",function(a){return function(b,c,d){b.$watch(d.showFocus,function(b){a(function(){b&&c.focus()})},!0)}}]),app.directive("docTemplate",function(){var a=function(a,b,c,d,e,f){angular.extend(this,d("abstractTemp01Controller",{$scope:a})),a.init(b),a.viewerPath=(c.basePath?c.basePath:"")+"htmlViewer/bower_components/pdfjs-dist/web/viewer.html?file=",a.frameDisplayed=!1,a.resetPage=function(){c.subPageData&&c.subPageData.cover||(c.subPageData=null),a.resetBegin(a.getProperData()),a.pictures=a.page.pics,a.texts=a.page.texts,a.pdfSource=a.page.pics[0].src,a.reorder=c.glassLayerActive&&!a.isSubGlass,a.printVisible=!1,a.frameDisplayed=!1,a.resetFinish(),a.pdfWidth=(a.page.pics[0].width?a.page.pics[0].width:c.mainData.width)*c.calcScale,a.pdfHeight=(a.page.pics[0].height?Number(a.page.pics[0].height):c.mainData.height-34)*c.calcScale,a.pdfX=a.page.pics[0].x?Number(a.page.pics[0].x):0,a.pdfY=a.page.pics[0].y?Number(a.page.pics[0].y):0,a.pdfSource=(f.PIC.indexOf("//")>-1?"":"../../../../")+a.page.pics[0].src,"firefox"!==browserName()?(a.pdfScale=null,a.pdfZoom=1/c.calcScale):(a.pdfScale="scale("+1/c.calcScale+")",a.pdfZoom=null,c.calcScale>1&&(a.pdfX-=a.pdfWidth/(4*c.calcScale),a.pdfY-=a.pdfHeight/(4*c.calcScale))),a.getContainer()},a.canvasContainer=null,a.docTimeout=null,a.getContainer=function(){a.docTimeout=e(function(){a.getContainer(),a.frameDisplayed=!0},10)};var g=c.$watch("calcScale",function(b,c){Number(b)!==Number(c)&&e(function(){a.resetPage()},10)});a.print=function(){printJS(a.pdfSource)},a.$on("$destroy",function(){a.docTimeout&&(a.docTimeout=null),g(),a.commonTmp01Destroy()})};return a.$inject=["$scope","$attrs","$rootScope","$controller","$timeout","PREFIX"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/doc/doc.html"),controller:a,controllerAs:"docCtrl"}}),app.directive("htmlTemplate",function(){var a=function(a,b,c,d,e,f){angular.extend(this,d("abstractTemp01Controller",{$scope:a})),a.subPrefix="",a.init(),a.resetPage=function(){b.subPageData&&b.subPageData.cover||(b.subPageData=null,a.resetBegin(),a.pictures=a.page.pics,a.texts=a.page.texts,a.stepsToSkip=0,a.skippedSteps=0,a.joinedStepsPending=0,a.resetFinish())},a.manualNextStep=function(){b.subPageData||(a.audio.stop(),a.paused=!1,a.nextStep())};b.$on(e.STEP_CHANGE,function(){a.displayDocument()});a.trustedHtml=null,a.displayDocument=function(){if(a.currentStep>=0){var b=a.page.pics[a.currentStep].src;b&&jQuery.get(b,function(b){var d=b;d=d.replace(/href="image/g,'href="'+f.PIC+"image"),d=d.replace(/href='image/g,"href='"+f.PIC+"image"),d=d.replace(/src="/g,'src="'+f.PIC),d=d.replace(/src='/g,"src='"+f.PIC),a.$apply(function(){a.trustedHtml=c.trustAsHtml(d)})})}},a.styleCalculator=function(a){var c={};return a&&(c.maxHeight=b.mainData.height-34+"px",c.height=b.mainData.height-34+"px",c.width=b.mainData.width+"px"),c}};return a.$inject=["$scope","$rootScope","$sce","$controller","EVENTS","PREFIX"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/html/html.html"),controller:a,controllerAs:"htmlCtrl"}}),app.directive("pptTemplate",function(){var a=function(a,b,c,d,e,f,g){angular.extend(this,e("abstractTemp01Controller",{$scope:a})),a.init(b),a.pptFolderPath="",a.resetPage=function(){a.resetBegin(a.getProperData()),a.pictures=a.page.pics,a.trustedResource=null;var b=a.pictures[0].src.split("/");a.pptFolderPath=b[b.length-2]+"/",a.texts=a.page.texts,a.stepsToSkip=0,a.skippedSteps=0,a.joinedStepsPending=0,a.resetFinish()},a.manualNextStep=function(){!a.isGlass&&c.glassLayerActive||c.subPageData||(a.audio.stop(),a.paused=!1,a.nextStep())},a.manualPrevStep=function(){!a.isGlass&&c.glassLayerActive||(a.audio.stop(),a.paused=!1,a.prevStep())};c.$on(f.STEP_CHANGE,function(){a.page.pics[a.currentStep]&&(a.trustedResource=a.page.pics[a.currentStep].src)});a.trustedHtml=null};return a.$inject=["$scope","$attrs","$rootScope","$sce","$controller","EVENTS","PREFIX"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/ppt/ppt.html"),controller:a,controllerAs:"pptCtrl"}}),app.directive("q1Template",function(){var a=function(a,b,c,d,e,f,g,h){angular.extend(this,f("abstractQuestionController",{$scope:a})),a.init(b),a.resetPage=function(){if(a.resetBegin(a.getProperData()),a.showAnswer=!1,c.chapter.assessment&&c.pagesOrder.length&&c.pagesOrder[a.pageIndex].type===h.QUEST){var b=a.numQuestions,d=a.pageIndex-c.chapter.pagesNum;c.previewMode&&(b=a.chapter.numQuest,d=c.nav.page),a.titleString=c.translation.Q1_TITLE_BEFORE_QUESTION+" "+d+" "+c.translation.Q1_TITLE_AFTER_QUESTION+" "+b}if(a.answerChecked=!1,a.anwsersBlocked=!1,a.question=a.page.texts[0],a.oneAnswer=a.page.texts[0].oneAnswer,a.picture=a.page.pics[0],a.shuffleAnswers=a.page.shuffleAnswers,a.answers=[],a.feedbacks=[],a.answersModel={index:null},a.multipleFeedbacks=!1,a.positionedFeedbacks=!1,a.defFeedback=null,a.dynamicPositioning=a.page.dynamicPositioning,angular.forEach(a.page.texts,function(b){b.crct&&!isNaN(b.crct)&&(b.answer=!0,a.answers.push(b),b.correctAnsw=!1,(b.rightText||b.wrongText)&&(a.multipleFeedbacks=!0),(b.rghtX||b.rghtY||b.wrngX||b.wrngY)&&(a.positionedFeedbacks=!0))}),a.shuffleAnswers){a.shuffledAnswers=shuffleArray(a.answers);var e=[];angular.forEach(a.answers,function(a){e.push({x:a.x,y:a.y,rghtX:a.rghtX,rghtY:a.rghtY,wrngX:a.wrngX,wrngY:a.wrngY})}),angular.forEach(a.shuffledAnswers,function(a,b){a.x=e[b].x,a.y=e[b].y,a.rghtX=e[b].rghtX,a.rghtY=e[b].rghtY,a.wrngX=e[b].wrngX,a.wrngY=e[b].wrngY})}else a.shuffledAnswers=a.answers;c.$broadcast(g.ANSWER_GIVEN,!1),a.resetFinish(),a.debugAnswers()};var i=20,j=70,k=c.mainData.width-50,l=20,m=c.mainData.height-80,n=c.mainData.width-40,o=80,p="auto",q=120,r=80,s=44,t=20,u=s-c.mainData.height,v=-t;a.feedbacksContStyle={left:t+"px",bottom:s+"px",width:n+"px"},a.processText=function(b,d){var e=Math.min((c.mainData.height-200)/a.answers.length,r);return b==a.question?(b.y||(b.y=j),b.x||(b.x=i),b.width||(b.width=k)):b.answer&&(b.y||(b.y=q+e*(d+1)-e/2),b.x||(b.x=o),b.width||(b.width=p),b.color||a.defaultPOTextStyle.color||(b.color=c.mainData.fontStyles.pagebody.color)),a.styleCalculator(b)},a.answerChanged=function(){var b=!1;a.oneAnswer?b=null!=a.answersModel.index:angular.forEach(a.answersModel.index,function(a){a&&(b=!0)}),c.$broadcast(g.ANSWER_GIVEN,b)},a.checkCorrectness=function(){function b(b){return(Number(a.page.texts[b].crct)-b)%2==0}function d(b){var c=!1;return a.oneAnswer?c=a.answersModel.index==b.index:angular.forEach(a.answersModel.index,function(a,d){d==b.index&&(c=a)}),c}if(a.isGlass||!c.glassLayerActive){a.answerChecked=!0;var e=!0,f=0;if(angular.forEach(a.answers,function(a){a.correctAnsw=b(a.index),a.selected=d(a),a.correctAnsw!=a.selected?e=!1:f++}),c.chapter.assessment&&c.pagesOrder.length&&c.pagesOrder[a.pageIndex].type===h.QUEST){a.defFeedback={text:c.translation.Q1_ANSWER_REGISTERED},a.feedbacks=[a.defFeedback];var i=f/a.answers.length*a.question.points;a.question.important&&(i=e?a.question.points:0),c.pagesOrder[a.pageIndex].score=i}else if(a.page.qqQuestion)a.defFeedback={text:c.translation.Q1_ANSWER_REGISTERED},a.feedbacks=[a.defFeedback],a.page.pagegroup&&c.chapter.pagegroups[a.page.pagegroup].answersCorr.push(e?1:0);else if(a.multipleFeedbacks){a.showAnswer=!c.chapter.hideSelfAssessmentAnswers;var j=[],k=!1,o=!1;if(angular.forEach(a.answers,function(b){var c={x:v,y:u,width:n};b.correctAnsw==b.selected?a.answers[b.index-1].rightText?c.text=a.answers[b.index-1].rightText:a.positionedFeedbacks?k=!0:c.text=a.page.defaultCorrectFeedback.text:a.answers[b.index-1].wrongText?c.text=a.answers[b.index-1].wrongText:a.positionedFeedbacks?o=!0:c.text=a.page.defaultIncorrectFeedback.text,b.wrngX&&(c.x=b.wrngX+v),b.wrngY&&(c.y=b.wrngY+u),a.feedbacks.push(c),j.push({x:c.x,y:c.y})}),a.positionedFeedbacks){if(k&&a.page.defaultCorrectFeedback){var p={text:a.page.defaultCorrectFeedback.text,x:v,y:u,width:n};a.page.defaultCorrectFeedback.x&&(p.x=a.page.defaultCorrectFeedback.x+v),a.page.defaultCorrectFeedback.y&&(p.y=a.page.defaultCorrectFeedback.y+u),a.feedbacks.push(p)}if(o&&a.page.defaultIncorrectFeedback){var q={text:a.page.defaultIncorrectFeedback.text,x:v,y:u,width:n};a.page.defaultIncorrectFeedback.x&&(q.x=a.page.defaultIncorrectFeedback.x+v),a.page.defaultIncorrectFeedback.y&&(q.y=a.page.defaultIncorrectFeedback.y+u),a.feedbacks.push(q)}}}else a.showAnswer=!c.chapter.hideSelfAssessmentAnswers,a.defFeedback=e?a.page.defaultCorrectFeedback:a.page.defaultIncorrectFeedback,a.defFeedback.text||(a.defFeedback.text=e?c.translation.Q1_ANSWER_CORRECT:c.translation.Q1_ANSWER_INCORRECT),(a.defFeedback.x||a.defFeedback.x)&&(a.positionedFeedbacks=!0),a.defFeedback.x=(a.defFeedback.x?a.defFeedback.x:l)+v,a.defFeedback.y=(a.defFeedback.y?a.defFeedback.y:m)+u,a.feedbacks=[a.defFeedback];c.$broadcast(g.PAGE_FINISHED,a.isSubPage||a.isSubGlass)}},a.$watch("$root.debugShowCorrectAnswers",function(){a.debugAnswers()}),a.debugAnswers=function(){function b(b){return(Number(a.page.texts[b].crct)-b)%2==0}c.debugShowCorrectAnswers&&angular.forEach(a.shuffledAnswers,function(a){a.correctAnsw=b(a.index)})},a.$watch("$root.alertVisible",function(){c.alertVisible?a.anwsersBlocked=!0:d(function(){a.anwsersBlocked=!1},1)})};return a.$inject=["$scope","$attrs","$rootScope","$timeout","$filter","$controller","EVENTS","PAGE_TYPES"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/q1/q1.html"),controller:a,controllerAs:"q1Ctrl"}}),app.directive("q2Template",function(){var a=function(a,b,c,d,e,f,g,h){function i(b){for(var c=!1,d=0;d<a.matches.length;d++)if(a.matches[d].matchPO==b){c=!0;break}return c}function j(b){if(b){var c=null;return angular.forEach(a.answers,function(a){if(a.hovered=!1,b.currX+b.calcWidth>a.x&&b.currX<a.x+a.calcWidth&&b.currY+b.calcHeight>a.y&&b.currY<a.y+a.calcHeight)if(c){var d={x:b.currX+b.calcWidth/2,y:b.currY+b.calcHeight/2},e={x:c.x+c.calcWidth/2,y:c.y+c.calcHeight/2},f={x:a.x+a.calcWidth/2,y:a.y+a.calcHeight/2},g=Math.sqrt((e.x-=d.x)*e.x+(e.y-=d.y)*e.y),h=Math.sqrt((f.x-=d.x)*f.x+(f.y-=d.y)*f.y);h<g&&(c=a)}else c=a}),c}}function k(b){for(var c=null,d=0;d<a.answers.length;d++)if(a.answers[d].index==b){c=a.answers[d];break}return c}angular.extend(this,f("abstractQuestionController",{$scope:a}));var l=!1;a.init(b),a.resetPage=function(){if(a.resetBegin(a.getProperData()),a.showAnswer=!1,c.chapter.assessment&&c.pagesOrder.length&&c.pagesOrder[a.pageIndex].type===h.QUEST){var b=a.numQuestions,d=a.pageIndex-c.chapter.pagesNum;c.previewMode&&(b=a.chapter.numQuest,d=c.nav.page),a.titleString=c.translation.Q1_TITLE_BEFORE_QUESTION+" "+d+" "+c.translation.Q1_TITLE_AFTER_QUESTION+" "+b}a.moves=0,a.answerChecked=!1,a.question=a.page.texts[0],a.picture=a.page.pics[0],a.answers=[],a.matches=[],a.pictureMatches=!1,a.pictureAnswers=!1,a.maxDimensions={width:0,height:0},a.feedback=null,angular.forEach(a.page.texts,function(b){if(b.index>0){(b.text||b.pictureAnswer)&&(b.answer=!0,b.matchedItems=[],a.answers.push(b)),b.pictureAnswer&&(a.pictureAnswers=!0);var c={match:!0,index:b.index,matchPO:b.matchPO?b.matchPO:b.index,picture:b.pictureMatch,text:b.match?b.match:" ",x:b.matchX,y:b.matchY,currX:b.matchX,currY:b.matchY,startX:b.matchX,startY:b.matchY,matchedAnswer:null,isDragged:!1,rtlDirection:b.rtlDirection};a.matches.push(c),c.picture&&(a.pictureMatches=!0),l===!1&&c.rtlDirection===!0&&(l=!0)}});for(var e=0;e<a.answers.length;e++)i(a.answers[e].index)||(a.answers.splice(e,1),e--);a.shuffledMatches=shuffleArray(a.matches),c.$broadcast(g.ANSWER_GIVEN,!1),a.resetFinish(),a.debugAnswers()};var m=20,n=70,o=c.mainData.width-50,p=c.mainData.width-40,q=50,r=380,s=95,t=30,u=170,v=c.mainData.width-350,w=140,x=100,y=178,z=100,A=44,B=20,C=10;a.feedbacksContStyle={left:B+"px",bottom:A+"px",width:p+"px"},a.processText=function(b,d){if(b==a.question)b.y||(b.y=n),b.x||(b.x=m),b.width||(b.width=o),b.color||a.defaultPOTextStyle.color||(b.color=c.chapter.color),b.isQuestion=!0;else if(b.answer){b.y||(b.y=u+z*d),b.x||(b.x=q),a.pictureMatches?(b.width=a.maxDimensions.width,b.height=a.maxDimensions.height):a.pictureAnswers?(b.width=s,b.height=t):(b.width=r,b.align="center");var e=$("#dropItem"+b.index);b.calcHeight=e.outerHeight()/c.calcScale,b.calcWidth=e.outerWidth()/c.calcScale,b.color||(b.color="#000000")}else if(b.match){var f=$("#dragItem"+b.index);b.calcWidth=f.outerWidth()/c.calcScale,b.calcHeight=f.outerHeight()/c.calcScale,b.y||(b.y=w+Math.floor(d/2)*z,b.currY=b.y),b.x||(b.x=v+d%2*y,b.currX=b.x),b.picture?(a.maxDimensions.width=Math.max(a.maxDimensions.width,b.calcWidth),a.maxDimensions.height=Math.max(a.maxDimensions.height,b.calcHeight)):b.width||(b.width=x),b.color||(b.color="#000000")}return a.styleCalculator(b)},a.currentMatch=null,a.startCallback=function(b,d){if(!a.answerChecked){c.mobile&&(b=b.targetTouches[0]),a.moves++,d.isDragged=!0,a.currentMatch=d,a.currentMatch.diffX=d.x-b.pageX/c.calcScale,a.currentMatch.diffY=d.y-b.pageY/c.calcScale,d.matchedAnswer=null,angular.forEach(a.answers,function(a){for(var b=!1,c=0;c<a.matchedItems.length;c++){var e=a.matchedItems[c];if(e===d&&(a.matchedItems.splice(c,1),c--,b=!0),b){var f=e.x-C;e.currX-=e.x-f,e.x=f,e.startX=e.x;var g=e.y-C;e.currY-=e.y-g,e.y=g,e.startY=e.y}}});var e=$("#dragItem"+d.index);e.css("z-index",a.moves)}},a.stopCallback=function(){a.currentMatch&&(a.currentMatch.isDragged=!1),d(function(){var b=j(a.currentMatch);if(b){var c=b.x+(b.calcWidth-a.currentMatch.calcWidth)/2+C*b.matchedItems.length;a.currentMatch.currX-=a.currentMatch.x-c,a.currentMatch.x=c;var d=b.y+(b.calcHeight-a.currentMatch.calcHeight)/2+C*b.matchedItems.length;a.currentMatch.currY-=a.currentMatch.y-d,a.currentMatch.y=d,b.matchedItems.push(a.currentMatch),a.currentMatch.matchedAnswer=b}a.currentMatch=null,a.answerChanged()},10)},a.dragCallback=function(b){if(a.currentMatch){c.mobile&&(b=b.targetTouches[0]),a.currentMatch.x=b.pageX/c.calcScale+a.currentMatch.diffX,a.currentMatch.y=b.pageY/c.calcScale+a.currentMatch.diffY,0==a.currentMatch.x&&(a.currentMatch.x=.1),0==a.currentMatch.y&&(a.currentMatch.y=.1),a.currentMatch.currX=a.currentMatch.x,a.currentMatch.currY=a.currentMatch.y;var d=j(a.currentMatch);d&&(d.hovered=!0)}},a.answerChanged=function(){var b=!1;angular.forEach(a.answers,function(a){a.matchedItems.length>0&&(b=!0)}),c.$broadcast(g.ANSWER_GIVEN,b)},a.checkCorrectness=function(){if(a.isGlass||!c.glassLayerActive){a.answerChecked=!0;var b=!0,d=0;if(angular.forEach(a.matches,function(a){a.matchedAnswer?a.matchedAnswer.index!=a.matchPO?b=!1:d++:k(a.matchPO)?b=!1:d++}),b||c.chapter.assessment&&c.pagesOrder.length&&c.pagesOrder[a.pageIndex].type===h.QUEST||(angular.forEach(a.answers,function(a){a.matchedItems=[]}),angular.forEach(a.matches,function(b){var c=k(b.matchPO);if(c){b.x=c.x+(c.calcWidth-b.calcWidth)/2-(b.currX-b.x)+C*c.matchedItems.length,b.y=c.y+(c.calcHeight-b.calcHeight)/2-(b.currY-b.y)+C*c.matchedItems.length,a.moves++;var d=$("#dragItem"+b.index);d.css("z-index",a.moves),c.matchedItems.push(b)}else b.x=b.startX,b.y=b.startY})),c.chapter.assessment&&c.pagesOrder.length&&c.pagesOrder[a.pageIndex].type===h.QUEST){a.feedback={text:a.translation.Q2_ANSWER_REGISTERED};var e=d/a.matches.length*a.question.points;a.question.important&&(e=b?a.question.points:0),c.pagesOrder[a.pageIndex].score=e}else a.page.qqQuestion?(a.feedback={text:a.translation.Q2_ANSWER_REGISTERED},a.page.pagegroup&&c.chapter.pagegroups[a.page.pagegroup].answersCorr.push(b?1:0)):(a.showAnswer=!0,a.feedback={text:b?a.translation.Q2_ANSWER_CORRECT:a.translation.Q2_ANSWER_INCORRECT});a.feedback.rtlFeedbackDirection=l,c.$broadcast(g.PAGE_FINISHED,a.isSubPage||a.isSubGlass)}},a.$watch("$root.debugShowCorrectAnswers",function(){a.debugAnswers()}),a.debugInfoPos=function(a){var b={};return b.left=a.x-20,b.top=a.y,b},a.debugAnswers=function(){c.debugShowCorrectAnswers&&angular.forEach(a.matches,function(b){var c=b.matchPO;b.debugSpan=c;for(var d=0;d<a.answers.length;d++)a.answers[d].index===b.matchPO&&(a.answers[d].debugSpan=c)})}};return a.$inject=["$scope","$attrs","$rootScope","$timeout","$filter","$controller","EVENTS","PAGE_TYPES"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/q2/q2.html"),controller:a,controllerAs:"q2Ctrl"}}),app.directive("tempTemplate",function(){var a=["$scope",function(a){}];return{restrict:"E",replace:"true",scope:{page:"="},templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/temprorary/temp.html"),controller:a,controllerAs:"tempCtrl"}}),app.directive("tmp01Template",function(){var a=function(a,b,c,d,e,f){angular.extend(this,e("abstractTemp01Controller",{$scope:a})),a.isGlass?a.$watch("$root.subGlassData",function(b,c){a.subPageWatcher(b,c)}):a.$watch("$root.subPageData",function(b,c){a.subPageWatcher(b,c)}),a.subPageWatcher=function(b,d){null==b&&null!=d&&a.currentStep>=0&&!a.page.texts[a.currentStep].wait&&(c.$broadcast(f.STEP_CHANGE,a.page.stepMode,a.currentStep-a.skippedSteps,a.page.numSteps-a.stepsToSkip),a.startPlayback())},a.resetPage=function(){c.subPageData&&c.subPageData.cover&&!c.subPageData.auto||c.subGlassData&&c.subGlassData.cover||(c.subPageData=null,c.subGlassData=null,a.resetBegin(a.getProperData()),a.pictures=a.page.pics,a.texts=a.page.texts,a.rollOverTexts=[],a.stepsToSkip=0,a.skippedSteps=0,a.joinedStepsPending=0,a.mouseOverText=null,a.forcedStepMode&&(a.page.stepMode=!0),c.allSubpagesVisited=!1,c.hasSubpages=!1,angular.forEach(a.page.texts,function(b,d){b.mOver&&(a.rollOverTexts.push(jQuery.extend(!0,{},b)),a.pictures[d].mouseActive=!0),b.showWithPrevious&&a.stepsToSkip++,(b.hot||a.pictures[d].hot)&&(c.hasSubpages=!0)}),a.resetFinish())},a.manualNextStep=function(){c.subPageData||c.subGlassData||(a.audio.stop(),a.paused=!1,a.nextStep())},a.manualPrevStep=function(){c.subPageData||c.subGlassData||(a.audio.stop(),a.paused=!1,a.prevStep())};var g=c.$on(f.STEP_FINISHED,function(){!a.isGlass&&c.glassLayerActive||c.subPageData||c.subGlassData||(a.paused||a.page.stepMode)&&c.$broadcast(f.VIDEO_PAUSED)}),h=c.$on(f.STEP_CHANGE,function(){!a.isGlass&&c.glassLayerActive||c.$broadcast(f.VIDEO_PLAYING)});a.pagePreloadedHandler=function(){c.subPageData||c.subGlassData||a.startPlayback()};var i=c.$on(f.PAUSE,function(b,d){!a.isGlass&&c.glassLayerActive||c.subPageData||c.subGlassData||(a.audio.pause(),c.$broadcast(f.VIDEO_PAUSED))}),j=c.$on(f.PLAY,function(b,d){!a.isGlass&&c.glassLayerActive||c.subPageData||c.subGlassData||(a.audio.paused()?a.audio.unpause():(a.paused||a.page.stepMode)&&(a.paused=!1,a.audio.stop(),a.nextStep()),c.$broadcast(f.VIDEO_PLAYING))});a.$on("$destroy",function(){h(),g(),i(),j(),a.commonTmp01Destroy()}),a.init(b)};return a.$inject=["$scope","$attrs","$rootScope","$timeout","$controller","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/tmp01/tmp01.html"),controller:a,controllerAs:"tmp01Ctrl"}}),app.directive("subTmp01Template",function(){var a=function(a,b,c,d,e,f){angular.extend(this,e("abstractTemp01Controller",{$scope:a})),a.resetPage=function(){a.resetBegin(a.getProperData()),a.pictures=a.page.pics,a.texts=a.page.texts,a.rollOverTexts=[],a.stepsToSkip=0,a.skippedSteps=0,a.joinedStepsPending=0,a.mouseOverText=null,angular.forEach(a.page.texts,function(b,c){b.mOver&&(a.rollOverTexts.push(jQuery.extend(!0,{},b)),a.pictures[c].mouseActive=!0),b.showWithPrevious&&a.stepsToSkip++}),a.resetFinish()};var g=c.$on(f.STEP_FINISHED,function(){!a.isSubGlass&&c.subGlassData||c.isSubPage&&c.glassLayerActive||(a.paused||a.page.stepMode)&&c.$broadcast(f.VIDEO_PAUSED)}),h=c.$on(f.STEP_CHANGE,function(){!a.isSubGlass&&c.subGlassData||c.isSubPage&&c.glassLayerActive||c.$broadcast(f.VIDEO_PLAYING)});a.pagePreloadedHandler=function(){!a.isSubGlass&&c.subGlassData||c.isSubPage&&c.glassLayerActive||a.startPlayback()},a.manualNextStep=function(){a.audio.stop(),a.paused=!1,a.nextStep()},a.manualPrevStep=function(){a.audio.stop(),a.paused=!1,a.prevStep()};var i=c.$on(f.PAUSE,function(b,d){!a.isSubGlass&&c.subGlassData||c.isSubPage&&c.glassLayerActive||(a.audio.pause(),c.$broadcast(f.VIDEO_PAUSED))}),j=c.$on(f.PLAY,function(b,d){!a.isSubGlass&&c.subGlassData||c.isSubPage&&c.glassLayerActive||(a.audio.paused()?a.audio.unpause():(a.paused||a.page.stepMode)&&(a.paused=!1,a.audio.stop(),a.nextStep()),c.$broadcast(f.VIDEO_PLAYING))});a.init(b),a.$on("$destroy",function(){h(),g(),i(),j(),a.commonTmp01Destroy()})};return a.$inject=["$scope","$attrs","$rootScope","$timeout","$controller","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/tmp01/tmp01.html"),controller:a,controllerAs:"subTmp01Ctrl"}}),app.directive("repeatDone",function(){return function(a,b,c){a.$last&&a.$eval(c.repeatDone)}}),app.directive("vidTemplate",function(){var a=function(a,b,c,d,e,f,g,h){angular.extend(this,e("abstractTemp01Controller",{$scope:a})),a.init(b),a.resetPage=function(b){a.timeInterval&&(f.cancel(a.timeInterval),a.timeInterval=null),a.resetBegin(a.getProperData());var c=$("#"+a.subPrefix+"sgVideo")[0];c&&(c.src="",c.pause(),c.removeAttribute("src"),c.load()),a.clearBufferTimeout(),a.addVideoDOM=!1,a.videoReady=!1,a.firstCanPlay=!0,a.prevVideoStep=-1,a.currAudio=null,a.soundPlaying=!1,a.audioPromises={},a.vidStep=-1,a.currentStep=-1,a.targetTime=null,a.timeBeforeSeek=null,a.videoElement=null,a.videoFinished=!1,a.printOrdersFinished=!1,a.vidTime=0,a.waitingForSound=!1,a.realPause=!1,a.allowPause=!1,a.allowPlay=!1,a.pageFinished=!1,a.firstPlay=!0,a.calcStep=-1,a.videoIsWaitingForSound=!1,a.firstSeekEvent=!0,a.manualPlay=!1,b||(a.videoData=a.page.pics[0],a.flvVideo="flv"===a.videoData.src.substr(a.videoData.src.length-3,3).toLowerCase(),a.page.texts.shift(),a.page.pics.shift(),a.page.soundTexts.shift(),a.page.sounds.shift(),a.page.numSteps=a.page.texts.length,a.pictures=a.page.pics,a.texts=a.page.texts,a.rollOverTexts=[],a.mouseOverText=null,a.steps=[],angular.forEach(a.page.texts,function(b,c){b.index--,a.steps.push(b.cue),b.mOver&&(a.rollOverTexts.push(jQuery.extend(!0,{},b)),a.pictures[c].mouseActive=!0)}),a.resetFinish())},a.videoDataTimeout=null,a.$watch("videoData",function(){a.videoDataTimeout=d(function(){a.isSubPage&&!g.subPageData||(a.addVideoDOM=!0,a.getVideoElement())},100)}),a.pagePreloadedHandler=function(){a.startPlayback(),g.$broadcast(h.PRELOADING,0),a.hangTimeout=d(function(){a.retryRun()},5e3)},a.retryRun=function(){a.videoElement||(a.getVideoElement(),a.firstRunVideo(),a.manualPlay=!0)},a.getVideoElement=function(){a.videoElement||(a.videoElement=$("#"+a.subPrefix+"sgVideo")[0]),a.toggleMute()},a.videoPlayEvent=function(){if(a.firstPlay){a.hangTimeout&&d.cancel(a.hangTimeout),a.manualPlay=!1,a.videoReady=!0,a.getVideoElement(),g.$broadcast(h.VIDEO_HIDE_CONTROLS,a.videoData.hidePlay);var b=[];angular.forEach(a.steps,function(c){b.push(c/(10*a.videoElement.duration))}),g.$broadcast(h.VIDEO_CUE_PERCENTS,b),a.firstPlay=!1}g.$broadcast(h.PRELOADING_FINISHED),a.timeInterval||(a.timeInterval=f(function(){a.videoTimeUpdate()},15)),g.$broadcast(h.VIDEO_PLAYING),!a.isGlass&&g.glassLayerActive&&a.forcePause()},a.videoTimeUpdate=function(){if(a.videoElement&&!a.videoElement.paused){a.vidTime=1e3*a.videoElement.currentTime|0;for(var b=-1,c=0;c<a.steps.length&&a.vidTime>=a.steps[c];c++)b=c;a.calcStep=b,g.$broadcast(h.PRELOADING_FINISHED),g.$broadcast(h.VIDEO_TIME_CHANGE,a.videoElement.currentTime,a.videoElement.duration)}},a.$watch("calcStep",function(){if(a.calcStep>-1)if(a.currAudio&&!a.currAudio.ended)if(a.currAudio.waitForMe){a.softPause();var b=a.$watch("currAudio.ended",function(){a.currAudio&&a.currAudio.ended&&(a.softResume(),a.vidStep=a.calcStep,b())})}else a.vidStep=a.calcStep;else a.vidStep=a.calcStep}),a.softPause=function(){a.videoIsWaitingForSound=!0,a.videoElement.pause()},a.softResume=function(){a.videoIsWaitingForSound=!1,a.playVideoWithFallback()},a.audioEnded=function(){a.currAudio&&(a.currAudio.ended=!0),a.checkForPOFinished()},a.$watch("vidStep",function(){a.vidStep>-1&&a.startStep()}),a.startStep=function(){a.nextStep(),a.vidStep>-1?(a.currAudio={},a.page.sounds[a.vidStep]?a.page.sounds[a.vidStep].src?(a.currAudio.src=a.page.sounds[a.vidStep].src,a.currAudio.waitForMe=a.page.sounds[a.vidStep].waitForSound,a.currAudio.ended=!1,a.audio.play(a.currAudio.src).then(function(){a.audioEnded()})):(a.currAudio=null,a.checkForPOFinished()):a.currAudio=null):a.currAudio=null},a.nextStep=function(){a.vidStep>=0&&(a.currentStep=a.vidStep,g.$broadcast(h.STEP_CHANGE,!1,a.currentStep,a.page.numSteps))},a.seekEndTimeout=null,a.manualNextStep=function(){if(a.videoElement&&a.currentStep<a.steps.length-1){var b=a.currentStep+1,c=(a.steps[b]+10)/(10*a.videoElement.duration);g.$broadcast(h.SEEK,c),a.seekEndTimeout=d(function(){g.$broadcast(h.SEEK_END)},10)}},a.manualPrevStep=function(){if(a.videoElement&&a.currentStep>=1){var b=a.currentStep-1,c=(a.steps[b]+10)/(10*a.videoElement.duration);g.$broadcast(h.SEEK,c),a.seekEndTimeout=d(function(){g.$broadcast(h.SEEK_END)},10)}},a.checkForPOFinished=function(){a.currentStep===a.page.numSteps-1&&(a.printOrdersFinished=!0,a.attemptFinishPage())},a.videoEnded=function(){a.videoFinished=!0,a.timeInterval&&f.cancel(a.timeInterval),a.attemptFinishPage()},a.attemptFinishPage=function(){a.videoFinished&&(a.printOrdersFinished||0===a.page.numSteps)&&(a.pageFinished=!0,g.$broadcast(h.PAGE_FINISHED,a.isSubPage||a.isSubGlass))};var i=g.$on(h.PAUSE,function(b,c){!a.isGlass&&g.glassLayerActive||a.forcePause(!0)}),j=g.$on(h.PLAY,function(b,c){!a.isGlass&&g.glassLayerActive||a.unForcePause(!0)}),k=g.$on(h.SEEK,function(b,c){!a.isGlass&&g.glassLayerActive||(a.firstSeekEvent&&(a.getVideoElement(),a.softPause(),a.currAudio&&a.audio.pause(),a.currAudio=null,a.firstSeekEvent=!1),a.targetTime=c)}),l=g.$on(h.SEEK_END,function(b){if(a.isGlass||!g.glassLayerActive){var c=1e3*a.videoElement.duration*(a.targetTime/100);if(a.steps.length>0){for(var d=0,e=0;e<a.steps.length&&c>=a.steps[e];e++)d=e;a.videoElement.currentTime=a.steps[d]/1e3,
d===a.calcStep&&a.startStep()}else a.videoElement.currentTime=c/1e3;a.firstSeekEvent=!0,a.afterSeek=!0,a.softResume()}}),m=g.$watch("session.soundEnabled",function(){a.getVideoElement(),a.toggleMute()});a.toggleMute=function(){a.videoElement&&(a.videoElement.muted=!g.session.soundEnabled)},a.forcePause=function(b){a.getVideoElement(),a.videoElement.pause(),a.currAudio&&!a.currAudio.ended&&a.audio.pause(),b&&g.$broadcast(h.VIDEO_PAUSED)},a.unForcePause=function(b){a.videoFinished||a.videoIsWaitingForSound||a.playVideoWithFallback(),a.currAudio&&!a.currAudio.ended&&(a.audio.unpause(),b&&g.$broadcast(h.VIDEO_PLAYING))};var n=g.$on(h.GLASS_LAYER,function(b){a.forcePause()}),o=g.$on(h.GLASS_LAYER_DISMISSED,function(b){a.unForcePause()}),p=g.$on(h.ALERT,function(b){a.forcePause()}),q=g.$on(h.GLOSSARY_ON,function(b){a.forcePause()}),r=g.$on(h.QUITTING,function(b){a.forcePause()}),s=g.$on(h.ALERT_DISMISSED,function(b){(!a.isGlass&&!g.glassLayerActive||a.isGlass&&g.glassLayerActive)&&a.unForcePause()}),t=g.$on(h.GLOSSARY_DISMISSED,function(b){(!a.isGlass&&!g.glassLayerActive||a.isGlass&&g.glassLayerActive)&&a.unForcePause()});a.refreshBufferTimeout=function(){a.clearBufferTimeout(),a.buferIdleTimeout=d(function(){a.playVideoWithFallback(),a.firstCanPlay=!1},500)},a.clearBufferTimeout=function(){a.buferIdleTimeout&&d.cancel(a.buferIdleTimeout),a.buferIdleTimeout=null},a.downloadProgress=function(b){if(a.firstCanPlay){a.getVideoElement();for(var c,d,e=a.videoElement.buffered,f=e.length,i=a.videoElement.duration,j=[];f--;)c=e.start(f)/i,d=e.end(f)/i,j.push({start:c,end:d});if(j.length>0){a.buffered=j[0].end;var k=j[0].end-j[0].start;k*i>5&&a.firstRunVideo()}g.$broadcast(h.VIDEO_BUFFER,j)}},a.videoBuffered=function(b){a.firstCanPlay&&a.firstRunVideo()},a.canplaythroughEvent=function(b){"chrome"!==browserName()&&a.firstCanPlay&&a.firstRunVideo()},a.firstRunVideo=function(){a.getVideoElement(),a.clearBufferTimeout(),a.videoReady=!0,a.playVideoWithFallback(),a.firstCanPlay=!1},a.playVideoWithFallback=function(){var b=a.videoElement.play();void 0!==b&&b.catch(function(b){g.$broadcast(h.PRELOADING_FINISHED),g.$broadcast(h.VIDEO_PAUSED),g.$broadcast(h.VIDEO_HIDE_CONTROLS,!1),a.safeApply()})};var u=function(){v(a.hangTimeout),v(a.videoDataTimeout),v(a.buferIdleTimeout),v(a.seekEndTimeout)},v=function(a){a&&(d.cancel(a),a=null)};a.$on("$destroy",function(){m(),i(),j(),k(),l(),p(),q(),r(),n(),o(),s(),t(),u(),a.resetPage(!0),a.commonTmp01Destroy()})};return a.$inject=["$scope","$attrs","$http","$timeout","$controller","$interval","$rootScope","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/templates/vid/vid.html"),controller:a,controllerAs:"vidCtrl"}}),angular.module("myApp.version.interpolate-filter",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("myApp.version.version-directive",[]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]),angular.module("myApp.version",["myApp.version.interpolate-filter","myApp.version.version-directive"]).value("version","3.1.6"),app.directive("welcomePanel",function(){var a=function(a,b,c){a.year=(new Date).getFullYear(),a.tempLevel={data:b.session.level},a.levelSelectEnebled=function(){return Object.keys(b.mainData.levels).length>1},a.copyrightStyle=Object.assign(b.mainData.fontStyles.copyrightbody,{background:b.mainData.fontStyles.versioninfo.color}),a.disclaimerStyle=Object.assign(b.mainData.fontStyles.disclaimerbody,{background:b.mainData.fontStyles.versioninfo.color}),a.creditsStyle=Object.assign(b.mainData.fontStyles.creditbody,{background:b.mainData.fontStyles.versioninfo.color}),a.levelChanged=function(d){d.data!==b.session.level&&b.$broadcast(c.ALERT,b.translation.CONFIRM,b.translation.LANG_CHANGE_WARNING.replace("#SELECTED_LANG#",b.mainData.levels[d.data].text),[b.translation.OK,b.translation.CANCEL],function(){b.session.level=d.data,b.$broadcast(c.ALERT_DISMISSED)},function(){a.tempLevel.data=b.session.level,b.$broadcast(c.ALERT_DISMISSED)})},a.welcomeBackground=function(){var a={};const c=b.mainData.customWelcome&&b.mainData.customWelcome.skip?b.mainData.customWelcome.skip:void 0;return b.mainData.customWelcome&&b.mainData.customWelcome.bcg&&(a["background-image"]="url("+b.mainData.customWelcome.bcg+")"),(b.mainData.isSkiped||c)&&(a.visibility="hidden"),a},a.disclaimerTop=b.mainData.customWelcome?"18px":"25px",a.creditsTop=(b.mainData.customWelcome,"9px")};return a.$inject=["$scope","$rootScope","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/welcomePanel/welcomePanel.html"),controller:a}}),app.directive("welcomePanelPopup",function(){var a=function(a,b,c){a.closePopup=function(){b.isWelcomePopupShown=!1},a.showComponent=function(){b.isWelcomePopupShown=!b.isWelcomePopupShown},a.copyrightStyle=Object.assign(b.mainData.fontStyles.copyrightbody,{background:b.mainData.fontStyles.versioninfo.color}),a.disclaimerStyle=Object.assign(b.mainData.fontStyles.disclaimerbody,{background:b.mainData.fontStyles.versioninfo.color}),a.creditsStyle=Object.assign(b.mainData.fontStyles.creditbody,{background:b.mainData.fontStyles.versioninfo.color})};return a.$inject=["$scope","$rootScope","EVENTS"],{restrict:"E",replace:"true",templateUrl:noCacheTemplateQuery("htmlViewer/components/welcomePanelPopup/welcome-panel-popup.html"),controller:a}}),app.constant("PAGE_TYPES",{PANEL:"panel",QUEST:"question",PAGE:"page"}),angular.module("myApp.player",["ngRoute"]).config(["$routeProvider",function(a){a.when("/player",{templateUrl:noCacheTemplateQuery("htmlViewer/player/player.html"),controller:"PlayerViewCtrl"})}]).controller("PlayerViewCtrl",["$scope","$rootScope","$location","$routeParams","$timeout","sessionData","pageReader","pagePreloader","SCORMService","EVENTS","TEMPLATES","PAGE_TYPES","STRINGS",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,c,d){g.getPage(function(a){d(a)},c,a,b.session.level)}function o(){if(b.previewMode)return void q();b.pagesOrder=[];for(var c=1;c<=b.chapter.pagesNum;)b.pagesOrder.push({type:l.PAGE,name:c,id:b.chapter.pages[c-1].id}),c++;var d=jQuery.extend(!0,[],b.chapter.questions),f=[];if(d.length>0)if(b.chapter.qinfos){var g={};angular.forEach(a.chapter.qinfos,function(a){var b=[];angular.forEach(d,function(c){c.chapterId===a.chapId&&b.push(c.id)}),g[a.chapId]=b});var h=[];angular.forEach(a.chapter.qinfos,function(a){for(var b=0;b<a.numQuest;b++){var c=g[a.chapId].splice(Math.floor(Math.random()*g[a.chapId].length),1)[0];h.push({id:c,forChapter:a.chapId})}});for(var i=0;i<h.length;i++){var m=h[i].id;m&&f.push({type:l.QUEST,name:m,forChapter:h[i].forChapter,possibleScore:b.pagesData[m].points,score:0,id:m})}}else if(b.chapter.ordered)for(var n=0;n<b.chapter.numSelQuest;n++){var o=d[n].id;f.push({type:l.QUEST,name:o,id:o,forChapter:null,possibleScore:b.pagesData[o].points,score:0})}else{var r=[];b.chapter.obligatory>b.chapter.numSelQuest&&(b.chapter.obligatory=b.chapter.numSelQuest);for(var n=0;n<b.chapter.obligatory;n++)r.push(d.shift());for(var s=b.chapter.numSelQuest-b.chapter.obligatory,n=0;n<s;n++){var t=d.splice(Math.random()*d.length|0,1)[0];r.push(t)}for(var u=0;u<r.length;u++){var m=r[u].id;f.push({type:l.QUEST,name:m,id:m,forChapter:null,possibleScore:b.pagesData[m].points,score:0})}f=shuffleArray(f)}b.numQuestions=f.length,b.chapter.assessment?(b.scorm&&b.chapter.alreadyScored?f=[]:f.push({type:l.PANEL,name:k.ASSESSMENT_RESULT}),f.unshift({type:l.PANEL,name:k.ASSESSMENT_INTRO})):f.length>0&&f.unshift({type:l.PANEL,name:k.SELF_ASSESSMENT_INTRO}),b.pagesOrder=b.pagesOrder.concat(f),b.scorm&&b.chapter.assessment&&b.chapter.alreadyScored||b.pagesOrder.push({type:l.PANEL,name:k.CHAPTER_END}),b.numPages=b.pagesOrder.length,b.inProgress=!0,a.pageIndex=b.nav.page,b.readyToDisplay=!0,b.scorm||p(),e(function(){b.$broadcast(j.PRELOADING_FINISHED,"allPages")},100)}function p(){if(b.pagesOrder[a.pageIndex].type===l.PANEL?(b.page={},b.page.template=b.pagesOrder[a.pageIndex].name):b.page=b.pagesData[b.pagesOrder[a.pageIndex].id],b.chapter&&(b.page.template!==k.WELCOME&&(b.scorm&&b.pagesOrder[a.pageIndex].type===l.PAGE&&i.saveBookmark(a.pageIndex,b.chapter.pagesNum),b.pagePerc=Math.round((a.pageIndex+1)/b.pagesOrder.length*100),isNaN(b.chapter.percent)&&(b.chapter.percent=0),b.chapter.percent=Math.min(Math.max(b.chapter.percent,b.pagePerc),100)),"on"==b.mainData.qqMode&&"on"==b.chapter.qq)){var c=b.page.pagegroupId;if(c&&b.pagePerc>=b.chapter.percent){var d=b.chapter.pagegroups[c].answersCorr.reduce(add,0);b.chapter.pagegroups[c].passed=0!=d&&b.chapter.pagegroups[c].answersCorr.length==d,b.chapter.pagegroups[c].passed&&b.nav.page++}}}function q(a){b.page=a,b.readyToDisplay=!0}b.calcScale=1,b.glassLayerActive=!1,b.glassLayerSub=!1,b.glassData=null,b.subGlassData=null,b.glossaryVisible=!1,b.alertVisible=!1,b.isWelcomePopupShown=!1,a.$watch("$root.nav.chapterNum",function(){a.preparePages()}),a.$watch("$root.nav.page",function(){a.pageChange()}),b.$watch("session.level",function(b,c){b.toString()!==c.toString()&&(a.preparePages(),a.pageChange())}),a.pageChange=function(){b.previewMode||(b.page={},b.subPageData=null,isNaN(b.nav.page)?(b.pagesOrder=[],b.pagesOrder.push({type:l.PANEL,name:b.nav.page}),a.pageIndex=0,(b.readyToDisplay||b.scorm)&&p(),b.scorm&&!b.lmsInitialized&&e(function(){b.$broadcast(j.ALERT,b.translation.ERROR,b.translation.LMS_ERROR,["OK","OK"],function(){$("#player").remove()})},500)):(a.pageIndex=b.nav.page,b.readyToDisplay&&p()))},a.preparePages=function(){b.pagesOrder=[],null===b.nav.chapterNum?(b.chapter=null,b.page={},b.glassLayerActive=!1,b.glassLayerSub=!1,b.subGlassData=null,b.glassData=null,b.readyToDisplay=!0):(b.glassData=null,b.readyToDisplay=!1,a.chapterID=b.mainData.chaptersIdByNum[b.nav.chapterNum],b.chapter=b.mainData.chapters[a.chapterID],b.scorm&&(i.validateBookmark(),b.chapter.attemptsNum=i.attemptsNum(b.chapter.attemptsNum),i.alreadyScored()),b.pagesData={},b.chapter.pagesNum+b.chapter.numQuest>0&&b.$broadcast(j.PRELOADING,0),b.previewMode?a.preloadPage(b.nav.page-1):a.preloadPage(0))},a.preloadPage=function(c){var d=Math.min(100*c/(b.chapter.pagesNum+b.chapter.numQuest)|0,100);b.$broadcast(j.PRELOADING,d);var e,f=a.chapterID;if(c<b.chapter.pagesNum)e=b.chapter.pages[c].id;else if(c<b.chapter.pagesNum+b.chapter.numQuest)e=b.chapter.questions[c-b.chapter.pagesNum].id;else{if(!b.chapter.glassGuid||b.glassData)return void o();f=m.GLASS_FOLDER,e=b.chapter.glassGuid}if(b.previewMode){b.previewQuestion?b.chapter.pagesNum+c:c;b.previewQuestion?(e=b.chapter.questions[c].id,a.numPages=b.chapter.questions.length):(e=b.chapter.pages[c].id,a.numPages=b.chapter.pages.length),a.pageIndex=c,n(e,f,function(a){q(a)})}else n(e,f,function(d){f===m.GLASS_FOLDER?b.glassData=d:(b.chapter.pages[c]&&(d.pagegroupId=b.chapter.pages[c].pagegroupId),b.pagesData[e]=d),c++,a.preloadPage(c)})},a.$on(j.SUBPAGE_REQUESTED,function(c,d,e){b.glassLayerActive?g.getPage(function(a){b.subGlassData=a,b.subGlassData.cover="H"!==e,b.subGlassData.auto="A"===e,""===b.subGlassData.title&&(b.subGlassData.title=b.glassData.title)},m.GLASS_FOLDER,b.glassData.id,b.session.level,d):g.getPage(function(a){b.subPageData=a,b.subPageData.cover="H"!==e,b.subPageData.auto="A"===e,""===b.subPageData.title&&(b.subPageData.title=b.page.title)},a.chapterID,b.page.id,b.session.level,d)}),a.playerStyle=function(a){var c={};b.session.fullScreen||b.mobile||a.autoFullScale?b.calcScale=calculateScale(a.width,a.height):b.calcScale=calculateAutoScaleDown(a.width,a.height),c.transform="scale("+b.calcScale+")";var d=(a.width*b.calcScale-a.width)/2;return d<0&&(c.left=d,c.right=d),a&&(a.width=a.defaultWidth,a.height=a.defaultHeight,a.bcg&&(c.backgroundImage="url("+a.bcg+")")),b.chapter&&(b.chapter.width&&(a.width=b.chapter.width),b.chapter.height&&(a.height=b.chapter.height),b.chapter.bcg&&b.readyToDisplay&&(c.backgroundImage="url("+b.chapter.bcg+")")),c.width=a.width+"px",c.height=a.height+"px",c};var r="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange";$(document).on(r,function(){b.session.fullScreen=!b.session.fullScreen,a.$apply()}),b.getPlayerDOM=function(a){b.playerDOM&&!a||(b.playerDOM=jQuery("#player"))},b.getPlayerDOM()}]),angular.module("myApp.player").controller("abstractTemplateController",["$scope","$rootScope","pagePreloader","$timeout","sgAudio","subAudio","glassAudio","subGlassAudio","EVENTS",function(a,b,c,d,e,f,g,h,i){a.defaultPOTextStyle=b.mainData.fontStyles.pagebody;var j=null;a.hotClickRandomizer=Date.now(),a.init=function(b){a.isMainPage=!1,a.isSubPage=!1,a.isGlass=!1,a.isSubGlass=!1,b.templateRole&&"mainPage"!==b.templateRole?"subPage"===b.templateRole?(a.isSubPage=!0,a.subPrefix="sub-tmp01-",a.audio=f):"glassLayer"===b.templateRole?(a.isGlass=!0,a.subPrefix="glass-tmp01-",a.audio=g):"subGlassLayer"===b.templateRole&&(a.isGlass=!0,a.isSubGlass=!0,a.subPrefix="sub-glass-tmp01-",a.audio=h):(a.isMainPage=!0,a.subPrefix="tmp01-",a.audio=e),j=a.$watch("$root.page",function(){a.resetPage()})},a.getProperData=function(){return a.isSubPage?b.subPageData:a.isSubGlass?b.subGlassData:a.isGlass?b.glassData:b.page},a.resetPage=function(){alert("$scope.resetPage function must be overrided!")},a.resetBegin=function(b){a.page=jQuery.extend(!0,{},b),a.tempPO=!0,a.visible=!1,a.titleString=a.page.title,a.currentStep=-1,a.pageFinished=!1,a.hotClickRandomizer=Date.now(),a.audio.reset(),a.timeoutPromise&&(d.cancel(a.timeoutPromise),a.timeoutPromise=null)},a.resetFinish=function(){a.setItemsVisibility(),a.timeoutPromise=d(a.startPage,100)},a.setItemsVisibility=function(){alert("$scope.setItemsVisibility function must be overrided!")},a.showPOItem=function(){alert("$scope.showPOItem function must be overrided!")},a.startPage=function(){a.paused=!0,c.preloadPage(a.page).then(function(){a.pagePreloadedHandler()})},a.pagePreloadedHandler=function(){a.startPlayback()},a.startPlayback=function(){a.paused=!1,a.visible=!0,b.$broadcast(i.PRELOADING_FINISHED),a.timedNextStep(10)},a.timedNextStep=function(b){a.timeoutPromise=d(a.nextStep,b)},a.nextStep=function(){alert("$scope.nextStep function must be overrided!")},a.prevStep=function(){alert("$scope.prevStep function must be overrided!")},a.styleCalculator=function(c){var d={};return c&&(d.left=c.x+"px",d.top=c.y+"px",c.width&&(d.width=c.width+"px"),c.height&&(d.height=c.height+"px"),(c.wait||c.hot&&"A"!=c.hot)&&(d.cursor="pointer",d.pointerEvents="all",c.text?(d.border="2px solid",d.left=c.x-1+"px",d.top=c.y-1+"px",d.borderColor=c.clicked?"#737272 #d4d3d3 #d4d3d3 #737272 ":"#d4d3d3 #737272 #737272 #d4d3d3",d.paddingLeft="2px"):c.clicked&&!c.clickedSrc&&(d.opacity=.5),c.wait&&c.clicked&&(d.cursor="initial")),c.mouseActive&&(d.pointerEvents="all"),d.objectFit=c.exactfit?"fill":"contain",d.fontSize=c.size?c.size+"px":a.defaultPOTextStyle.fontSize,d.fontFamily=c.font?c.font:a.defaultPOTextStyle.fontFamily,c.color?d.color=c.color:a.defaultPOTextStyle.color?d.color=a.defaultPOTextStyle.color:d.color=b.chapter.color,d.textAlign=c.align?c.align:null,c.s?("1"==c.s&&(d.fontWeight="bold",d.letterSpacing="-0.05em"),"3"==c.s&&(d.fontStyle="italic")):(d.fontWeight=a.defaultPOTextStyle.fontWeight,d.fontStyle=a.defaultPOTextStyle.fontStyle),c.bullet&&(d.marginLeft="10px"),c.rtlDirection&&!c.answer&&(d.direction="rtl",c.match!==!0&&(d.textAlign=c.oneAnswer||c.isQuestion?"left":"right")),c.rtlFeedbackDirection&&(d.direction="rtl")),d};var k=a.$on(i.REPLAY,function(){a.resetPage()});a.commonAbstractDestroy=function(){j(),k(),a.audio.stop(),a.timeoutPromise&&(d.cancel(a.timeoutPromise),a.timeoutPromise=null)},a.$on("$destroy",function(){a.commonAbstractDestroy()})}]).controller("abstractTemp01Controller",["$scope","$controller","$rootScope","pagePreloader","$timeout","sgAudio","subAudio","EVENTS",function(a,b,c,d,e,f,g,h){angular.extend(this,b("abstractTemplateController",{$scope:a}));var i=20,j=12,k=100,l=50;a.setItemsVisibility=function(){for(var b=0;b<a.page.numSteps;b++){var c=a.texts[b],d=a.pictures[b];c.showOnStep=[],d.showOnStep=[];for(var e=0;e<a.page.numSteps;e++)e<b?(c.showOnStep.push(!1),d.showOnStep.push(!1)):e==b?(c.showOnStep.push(!0),d.showOnStep.push(!0)):(e==b+1?c.showOnStep.push(!a.texts[e].txtFade):c.showOnStep.push(c.showOnStep[e-1]),d.noFade?d.showOnStep.push(!0):0==d.showOnStep[e-1]?d.showOnStep.push(!1):a.pictures[e].src?d.showOnStep.push(a.texts[e].showWithPrevious):d.showOnStep.push(!0)),c.rpo&&angular.forEach(c.rpo,function(c){var d=Number(c)-1;if(d>=0)for(var e=b;e<a.page.numSteps;e++)a.texts[d]&&a.texts[d].showOnStep&&(a.texts[d].showOnStep[e]=!1,a.pictures[d].showOnStep[e]=!1)})}},a.layoutDone=function(){e(function(){a.tempPO=!1},1)},a.startPage=function(){a.paused=!0,c.$broadcast(h.STEP_CHANGE,a.page.stepMode,a.currentStep-a.skippedSteps,a.page.numSteps-a.stepsToSkip),d.preloadPage(a.page).then(function(){a.pagePreloadedHandler()})},a.processText=function(b,d){var e=0;return d&&(b.x=b.orgX,b.y=b.orgY,b.width=b.orgWidth),b.index>0&&(e=$("#"+(d?"temp":"")+a.subPrefix+"poText"+(b.index-1)).height()/c.calcScale,b.txtFade&&(b.y||(b.y=a.texts[b.index-1].y),b.x||(b.x=a.texts[b.index-1].x),b.width||(b.width=a.texts[b.index-1].width)),(b.mOver||"A"===b.hot)&&(b.y||(b.y=a.texts[b.index-1].y),b.x||(b.x=a.texts[b.index-1].x),b.width||(b.width=a.texts[b.index-1].width),b.text="",b.height=e)),"right"==a.page.align?(b.y||(b.y=0==b.index?k+j:a.texts[b.index-1].y+e+j),b.x||(b.x=0==b.index?c.mainData.width/2+i:a.texts[b.index-1].x),b.width||(b.width=0==b.index?c.mainData.width/2-2*i:a.texts[b.index-1].width)):"top"==a.page.align?(b.y||(b.y=0==b.index?c.mainData.height/2+j:a.texts[b.index-1].y+e+j),b.x||(b.x=0==b.index?i:a.texts[b.index-1].x),b.width||(b.width=0==b.index?c.mainData.width-2*i:a.texts[b.index-1].width)):"bottom"==a.page.align?(b.y||(b.y=0==b.index?l+j:a.texts[b.index-1].y+e+j),b.x||(b.x=0==b.index?i:a.texts[b.index-1].x),b.width||(b.width=0==b.index?c.mainData.width-2*i:a.texts[b.index-1].width)):(b.y||(b.y=0==b.index?k+j:a.texts[b.index-1].y+e+j),b.x||(b.x=0==b.index?i:a.texts[b.index-1].x),b.width||(b.width=0==b.index?c.mainData.width/2-2*i:a.texts[b.index-1].width)),a.styleCalculator(b)},a.processPic=function(b){return"right"==a.page.align?(b.y||(b.y=k),b.x||(b.x=i)):"top"==a.page.align?(b.y||(b.y=l),b.x||(b.x=i)):"bottom"==a.page.align?(b.y||(b.y=c.mainData.height/2),b.x||(b.x=i)):(b.y||(b.y=k),b.x||(b.x=c.mainData.width/2+i)),a.styleCalculator(b)},a.itemClickHandler=function(b){!b.clicked&&b.wait&&a.currentStep==b.index?(a.paused=!1,a.audio.stop(),a.nextStep()):b.hot&&(a.hotClickRandomizer=Date.now(),"S"!==b.hot&&"A"!==b.hot||(a.audio.stop(),a.paused=!0),a.isGlass?c.subGlassData=null:c.subPageData=null,e(a.newSubPage,100,!0,b)),b.clicked=!0},a.newSubPage=function(b){c.$broadcast(h.SUBPAGE_REQUESTED,b.hotid,b.hot),c.allSubpagesVisited=!0,angular.forEach(a.pictures,function(b,d){b.hot&&!b.clicked&&(c.allSubpagesVisited=!1),a.texts[d].hot&&!a.texts[d].clicked&&(c.allSubpagesVisited=!1)})},a.mouseOverText=null,a.mouseOver=function(b,d){c.mobile||angular.forEach(a.rollOverTexts,function(b){b.index===d&&(a.mouseOverText=b)})},a.touchImage=function(b,d){angular.forEach(a.rollOverTexts,function(c){c.index===d&&(a.mouseOverText===c?a.mouseOverText=null:a.mouseOverText=c,b.stopPropagation())});var e=c.playerDOM[0].getBoundingClientRect(),f=b.currentTarget.getBoundingClientRect(),g=(f.left+f.width/2-e.left)/c.calcScale,h=(f.top+f.height/2-e.top)/c.calcScale;a.mouseOverText&&(a.mouseOverText.y=2*e.bottom,setTimeout(function(){var b=$("#"+a.subPrefix+"rollOverText");a.mouseOverText.calcHeight=b.outerHeight()/c.calcScale,a.mouseOverText.calcWidth=b.outerWidth()/c.calcScale,a.mouseOverText.x=g-a.mouseOverText.calcWidth/2,a.mouseOverText.y=h-a.mouseOverText.calcHeight-10,a.mouseOverText.x<0&&(a.mouseOverText.x=0),a.mouseOverText.x>c.mainData.width-a.mouseOverText.calcWidth&&(a.mouseOverText.x=c.mainData.width-a.mouseOverText.calcWidth),a.mouseOverText.y<0&&(a.mouseOverText.y=0),a.mouseOverText.y>c.mainData.height-a.mouseOverText.calcHeight&&(a.mouseOverText.y=c.mainData.height-a.mouseOverText.calcHeight)}))},a.mouseLeave=function(b,d){c.mobile||(a.mouseOverText=null)},a.clearRollover=function(b,c){a.mouseOverText=null},a.mouseMove=function(b,d){a.mouseOverText&&!c.mobile&&(a.mouseOverText.calcHeight=$("#"+a.subPrefix+"rollOverText").outerHeight(),a.mouseOverText.calcWidth=$("#"+a.subPrefix+"rollOverText").outerWidth()/c.calcScale,a.mouseOverText.x=b.currentTarget.offsetLeft+b.offsetX-a.mouseOverText.calcWidth/2,a.mouseOverText.y=b.currentTarget.offsetTop+b.offsetY-a.mouseOverText.calcHeight/c.calcScale,a.mouseOverText.x<0&&(a.mouseOverText.x=0),a.mouseOverText.x>c.mainData.width-a.mouseOverText.calcWidth&&(a.mouseOverText.x=c.mainData.width-a.mouseOverText.calcWidth),a.mouseOverText.y<0&&(a.mouseOverText.y=0),a.mouseOverText.y>c.mainData.height-a.mouseOverText.calcHeight&&(a.mouseOverText.y=c.mainData.height-a.mouseOverText.calcHeight))},a.showPOItem=function(b){return!(!b.text&&!b.src)&&(!!b.showOnStep&&b.showOnStep[a.currentStep])},a.timeoutPromise=null,a.skippedSteps=0,a.joinedSources=[],a.joinedDelays=[],a.nextStep=function(){a.paused||(a.currentStep<a.page.numSteps-1?(a.currentStep++,a.playCurrentStep()):(a.timeoutPromise&&(e.cancel(a.timeoutPromise),a.timeoutPromise=null),a.printOrdersFinished()))},a.prevStep=function(){a.currentStep>=1&&(a.currentStep--,a.playCurrentStep())},a.playCurrentStep=function(){return a.texts[a.currentStep+1]&&a.texts[a.currentStep+1].showWithPrevious?(a.skippedSteps++,a.joinedSources.push(a.page.sounds[a.currentStep].src),a.joinedDelays.push(a.page.texts[a.currentStep].delay),void a.nextStep()):(a.joinedSources.length>0?(a.joinedSources.push(a.page.sounds[a.currentStep].src),a.joinedDelays.push(a.page.texts[a.currentStep].delay||0),a.audio.playJoined(a.joinedSources,a.joinedDelays).then(function(){a.timedNextStep(100)}),a.joinedSources=[],a.joinedDelays=[]):a.timeoutPromise=a.audio.play(a.page.sounds[a.currentStep].src,a.page.pics[a.currentStep].noDelay,a.page.texts[a.currentStep].delay).then(function(){c.$broadcast(h.STEP_FINISHED,a.currentStep-a.skippedSteps,a.page.numSteps-a.stepsToSkip),a.timedNextStep(100)}),"A"==a.texts[a.currentStep].hot?a.itemClickHandler(a.texts[a.currentStep]):a.paused=a.texts[a.currentStep].wait,void c.$broadcast(h.STEP_CHANGE,a.page.stepMode,a.currentStep-a.skippedSteps,a.page.numSteps-a.stepsToSkip))},a.printOrdersFinished=function(){a.pageFinished=!0,c.$broadcast(h.PAGE_FINISHED,a.isSubPage||a.isSubGlass)},a.manualNextStep=function(){},a.manualPrevStep=function(){};var m=a.$on(h.NEXT_STEP,function(){a.manualNextStep()}),n=a.$on(h.PREV_STEP,function(){a.manualPrevStep()});a.timedNextStep=function(b){c.$broadcast(h.STEP_FINISHED,a.currentStep-a.skippedSteps,a.page.numSteps-a.stepsToSkip),a.page.stepMode&&a.currentStep!=-1&&a.currentStep!=c.page.numSteps-1||(a.timeoutPromise=e(a.nextStep,b))},a.commonTmp01Destroy=function(){n(),m(),a.commonAbstractDestroy()},a.getItemSrc=function(b){return b.clicked&&b.clickedSrc?b.clickedSrc:b.isGif&&!b.preload?b.src+"&tmp="+a.hotClickRandomizer:b.src},a.$on("$destroy",function(){a.commonTmp01Destroy()})}]).controller("abstractQuestionController",["$scope","$controller","$rootScope","$timeout","sgAudio","subAudio","EVENTS",function(a,b,c,d,e,f,g){angular.extend(this,b("abstractTemplateController",{$scope:a})),a.defaultPOTextStyle=c.mainData.fontStyles.assessmentbody,a.setItemsVisibility=function(){},a.showPOItem=function(a){return!0},a.nextStep=function(){a.paused?a.timeoutPromise&&(d.cancel(a.timeoutPromise),a.timeoutPromise=null):a.currentStep<a.page.numSteps-1?(a.currentStep++,a.timeoutPromise=a.audio.play(a.page.sounds[a.currentStep].src,100).then(function(){a.timeoutPromise&&(d.cancel(a.timeoutPromise),a.timeoutPromise=null),a.timedNextStep(100)})):c.$broadcast(g.QUESTION_FULLY_DISPLAYED)},a.processPic=function(b){return b.y||(b.y=0),b.x||(b.x=0),a.styleCalculator(b)},a.answerChanged=function(){},a.checkCorrectness=function(){alert("This function (checkCorrectness) must be overrided!")};var h=a.$on(g.CHECK,function(){a.checkCorrectness()});a.commonQuestionDestroy=function(){h(),a.commonAbstractDestroy()},a.$on("$destroy",function(){a.commonQuestionDestroy()})}]),app.factory("sgAudio",["$document","$timeout","$rootScope","$q","EVENTS",function(a,b,c,d,e){var f=2500,g=new Audio;g.src="",g.autoplay=!1;var h=null,i=[],j=[],k=null,l=null,m=0,n=!1,o=null;c.$watch("session.soundEnabled",function(){g.muted=!c.session.soundEnabled,angular.forEach(i,function(a){a.muted=!c.session.soundEnabled})}),c.$on(e.ALERT,function(a){v()}),c.$on(e.ALERT_DISMISSED,function(a){c.glassLayerActive||w()}),c.$on(e.GLOSSARY_ON,function(a){v()}),c.$on(e.GLOSSARY_DISMISSED,function(a){c.glassLayerActive||w()}),c.$on(e.GLASS_LAYER,function(a){v()}),c.$on(e.GLASS_LAYER_DISMISSED,function(a){w()}),c.$on(e.QUITTING,function(a){v()});var p=function(){return n},q=function(){g.onerror=null,g.onended=null,g.src="",b.cancel(h),h=null,k=null,l=null,m=0,o=null,n=!1,angular.forEach(i,function(a){a.onerror=null,a.onended=null,a.src="",a=null}),angular.forEach(j,function(a){b.cancel(a),a=null}),i=[],j=[]},r=function(a,c,e){return o="single",k=null,n=!1,d(function(d,i){a?(g.onerror=i,g.onended=d,g.src=a,g.load(),t(g)):(k=d,h=c&&!e?b(function(){k=null,d()},10):b(function(){k=null,d()},e?e:f))})},s=function(a,e){return o="joined",n=!1,d(function(d,g){m=0,l=d;var h=function(){m++,m==a.length&&(i=[],j=[],d())};angular.forEach(a,function(a,d){if(a){var g=new Audio;i.push(g),g.src=a,g.muted=!c.session.soundEnabled,g.load(),t(g),g.onended=function(a){a.src="",a=null,h()}}else{var k=b(function(){h()},e[d]?e[d]:f);j.push(k)}})})},t=function(a){var b=a.play();void 0!==b&&b.catch(function(a){c.$broadcast(e.PRELOADING_FINISHED),c.$broadcast(e.VIDEO_PAUSED),c.$broadcast(e.VIDEO_HIDE_CONTROLS,!1),c.$broadcast(e.PAUSE)})},u=function(){g.pause(),g.src="",g.load(),h&&(b.cancel(h),h=null),angular.forEach(i,function(a){a.pause(),a.src="",a.load(),a=null}),angular.forEach(j,function(a){b.cancel(a),a=null}),i=[],j=[],n=!1},v=function(){n=!0,g&&""!=g.src&&g.pause(),h&&b.cancel(h),angular.forEach(i,function(a){""!=a.src&&a.pause()}),angular.forEach(j,function(a){b.cancel(a)})},w=function(){n&&("single"==o?(k&&(k(),k=null),g&&!g.ended&&""!=g.src&&g.src.match(".mp3")&&t(g)):"joined"==o&&(angular.forEach(i,function(a){a.ended||""==a.src||t(a)}),m+=j.length,i.length+j.length==m&&l&&(l(),l=null)),n=!1)};return{play:r,playJoined:s,stop:u,pause:v,unpause:w,paused:p,reset:q}}]),app.factory("subAudio",["$document","$timeout","$rootScope","$q","EVENTS",function(a,b,c,d,e){var f=2500,g=new Audio;g.src="",g.autoplay=!1;var h=null,i=[],j=[],k=null,l=null,m=0,n=!1,o=null;c.$watch("session.soundEnabled",function(){g.muted=!c.session.soundEnabled,angular.forEach(i,function(a){a.muted=!c.session.soundEnabled})}),c.$on(e.ALERT,function(a){v()}),c.$on(e.ALERT_DISMISSED,function(a){c.glassLayerActive||w()}),c.$on(e.GLOSSARY_ON,function(a){v()}),c.$on(e.GLOSSARY_DISMISSED,function(a){c.glassLayerActive||w()}),c.$on(e.GLASS_LAYER,function(a){v()}),c.$on(e.GLASS_LAYER_DISMISSED,function(a){w()}),c.$on(e.QUITTING,function(a){v()});var p=function(){return n},q=function(){g.onerror=null,g.onended=null,g.src="",b.cancel(h),h=null,k=null,l=null,m=0,o=null,n=!1,angular.forEach(i,function(a){a.onerror=null,a.onended=null,a.src="",a=null}),angular.forEach(j,function(a){b.cancel(a),a=null}),i=[],j=[]},r=function(a,c,e){return o="single",k=null,n=!1,d(function(d,i){a?(g.onerror=i,g.onended=d,g.src=a,t(g)):(k=d,h=c&&!e?b(function(){k=null,d()},10):b(function(){k=null,d()},e?e:f))})},s=function(a,e){return o="joined",n=!1,d(function(d,g){m=0,l=d;var h=function(){m++,m==a.length&&(i=[],j=[],d())};angular.forEach(a,function(a,d){if(a){var g=new Audio;i.push(g),g.src=a,g.muted=!c.session.soundEnabled,g.load(),t(g),g.onended=function(a){a.src="",a=null,h()}}else{var k=b(function(){h()},e[d]?e[d]:f);j.push(k)}})})},t=function(a){var b=a.play();void 0!==b&&b.catch(function(a){c.$broadcast(e.PRELOADING_FINISHED),c.$broadcast(e.VIDEO_PAUSED),c.$broadcast(e.VIDEO_HIDE_CONTROLS,!1),c.$broadcast(e.PAUSE)})},u=function(){g.pause(),h&&(b.cancel(h),h=null),angular.forEach(i,function(a){a.pause(),a=null}),angular.forEach(j,function(a){b.cancel(a),a=null}),i=[],j=[],n=!1},v=function(){n=!0,g&&""!=g.src&&g.pause(),h&&b.cancel(h),angular.forEach(i,function(a){""!=a.src&&a.pause()}),angular.forEach(j,function(a){b.cancel(a)})},w=function(){n&&("single"==o?(k&&(k(),k=null),g&&!g.ended&&""!=g.src&&g.src.match(".mp3")&&t(g)):"joined"==o&&(angular.forEach(i,function(a){a.ended||""==a.src||t(a)}),m+=j.length,i.length+j.length==m&&l&&(l(),l=null)),n=!1)};return{play:r,playJoined:s,stop:u,pause:v,unpause:w,paused:p,reset:q}}]),app.factory("glassAudio",["$document","$timeout","$rootScope","$q","EVENTS",function(a,b,c,d,e){var f=2500,g=new Audio;g.src="",g.autoplay=!1;var h=null,i=[],j=[],k=null,l=null,m=0,n=!1,o=null;c.$watch("session.soundEnabled",function(){g.muted=!c.session.soundEnabled,angular.forEach(i,function(a){a.muted=!c.session.soundEnabled})}),c.$on(e.ALERT,function(a){v()}),c.$on(e.ALERT_DISMISSED,function(a){c.glassLayerActive||w()}),c.$on(e.GLOSSARY_ON,function(a){v()}),c.$on(e.GLOSSARY_DISMISSED,function(a){c.glassLayerActive||w()}),c.$on(e.GLASS_LAYER,function(a){v()}),c.$on(e.GLASS_LAYER_DISMISSED,function(a){w()}),c.$on(e.QUITTING,function(a){v()});var p=function(){return n},q=function(){g.onerror=null,g.onended=null,g.src="",b.cancel(h),h=null,k=null,l=null,m=0,o=null,n=!1,angular.forEach(i,function(a){a.onerror=null,a.onended=null,a.src="",a=null}),angular.forEach(j,function(a){b.cancel(a),a=null}),i=[],j=[]},r=function(a,c,e){return o="single",k=null,n=!1,d(function(d,i){a?(g.onerror=i,g.onended=d,g.src=a,t(g)):(k=d,h=c&&!e?b(function(){k=null,d()},10):b(function(){k=null,d()},e?e:f))})},s=function(a,e){return o="joined",n=!1,d(function(d,g){m=0,l=d;var h=function(){m++,m==a.length&&(i=[],j=[],d())};angular.forEach(a,function(a,d){if(a){var g=new Audio;i.push(g),g.src=a,g.muted=!c.session.soundEnabled,g.load(),t(g),g.onended=function(a){a.src="",a=null,h()}}else{var k=b(function(){h()},e[d]?e[d]:f);j.push(k)}})})},t=function(a){var b=a.play();void 0!==b&&b.catch(function(a){c.$broadcast(e.PRELOADING_FINISHED),c.$broadcast(e.VIDEO_PAUSED),c.$broadcast(e.VIDEO_HIDE_CONTROLS,!1),c.$broadcast(e.PAUSE)})},u=function(){g.pause(),h&&(b.cancel(h),h=null),angular.forEach(i,function(a){a.pause(),a=null}),angular.forEach(j,function(a){b.cancel(a),a=null}),i=[],j=[],n=!1},v=function(){n=!0,g&&""!=g.src&&g.pause(),h&&b.cancel(h),angular.forEach(i,function(a){""!=a.src&&a.pause()}),angular.forEach(j,function(a){b.cancel(a)})},w=function(){n&&("single"==o?(k&&(k(),k=null),g&&!g.ended&&""!=g.src&&g.src.match(".mp3")&&t(g)):"joined"==o&&(angular.forEach(i,function(a){a.ended||""==a.src||t(a)}),m+=j.length,i.length+j.length==m&&l&&(l(),l=null)),n=!1)};return{play:r,playJoined:s,stop:u,pause:v,unpause:w,paused:p,reset:q}}]),app.factory("subGlassAudio",["$document","$timeout","$rootScope","$q","EVENTS",function(a,b,c,d,e){var f=2500,g=new Audio;g.src="",g.autoplay=!1;var h=null,i=[],j=[],k=null,l=null,m=0,n=!1,o=null;c.$watch("session.soundEnabled",function(){g.muted=!c.session.soundEnabled,angular.forEach(i,function(a){a.muted=!c.session.soundEnabled})}),c.$on(e.ALERT,function(a){v()}),c.$on(e.ALERT_DISMISSED,function(a){w()}),c.$on(e.GLOSSARY_ON,function(a){v()}),c.$on(e.GLOSSARY_DISMISSED,function(a){w()}),c.$on(e.QUITTING,function(a){v()});var p=function(){return n},q=function(){g.onerror=null,g.onended=null,g.src="",b.cancel(h),h=null,k=null,l=null,m=0,o=null,n=!1,angular.forEach(i,function(a){a.onerror=null,a.onended=null,a.src="",a=null}),angular.forEach(j,function(a){b.cancel(a),a=null}),i=[],j=[]},r=function(a,c,e){return o="single",k=null,n=!1,d(function(d,i){a?(g.onerror=i,g.onended=d,g.src=a,t(g)):(k=d,h=c&&!e?b(function(){k=null,d()},10):b(function(){
k=null,d()},e?e:f))})},s=function(a,e){return o="joined",n=!1,d(function(d,g){m=0,l=d;var h=function(){m++,m==a.length&&(i=[],j=[],d())};angular.forEach(a,function(a,d){if(a){var g=new Audio;i.push(g),g.src=a,g.muted=!c.session.soundEnabled,g.load(),t(g),g.onended=function(a){a.src="",a=null,h()}}else{var k=b(function(){h()},e[d]?e[d]:f);j.push(k)}})})},t=function(a){var b=a.play();void 0!==b&&b.catch(function(a){c.$broadcast(e.PRELOADING_FINISHED),c.$broadcast(e.VIDEO_PAUSED),c.$broadcast(e.VIDEO_HIDE_CONTROLS,!1),c.$broadcast(e.PAUSE)})},u=function(){g.pause(),h&&(b.cancel(h),h=null),angular.forEach(i,function(a){a.pause(),a=null}),angular.forEach(j,function(a){b.cancel(a),a=null}),i=[],j=[],n=!1},v=function(){n=!0,g&&""!=g.src&&g.pause(),h&&b.cancel(h),angular.forEach(i,function(a){""!=a.src&&a.pause()}),angular.forEach(j,function(a){b.cancel(a)})},w=function(){n&&("single"==o?(k&&(k(),k=null),g&&!g.ended&&""!=g.src&&g.src.match(".mp3")&&t(g)):"joined"==o&&(angular.forEach(i,function(a){a.ended||""==a.src||t(a)}),m+=j.length,i.length+j.length==m&&l&&(l(),l=null)),n=!1)};return{play:r,playJoined:s,stop:u,pause:v,unpause:w,paused:p,reset:q}}]),app.factory("manifestReader",["$http",function(a){var b=function(b){a.get("../../imsmanifest.xml",{transformResponse:function(a){function b(a){var b={},c=a.split("@");return angular.forEach(c,function(a){var c=a.split("="),d={};d.text=c[0],d.id=c[1],b[d.id]=d}),b}var c={},d=angular.element.parseXML(a),e=angular.element(d),f=e.find("metadata > lom, metadata > imsmd\\:lom")[0],g=angular.element(f),h=g.find("otherplatformrequirements, imsmd\\:otherplatformrequirements")[0],i=angular.element(h),j=i.find("langstring, imsmd\\:langstring")[0],k=angular.element(j).text(),l=k.split("|");return angular.forEach(l,function(a){var d=a.split(":");"LEVELS"==d[0]?c[d[0].toLowerCase()]=b(d[1]):c[d[0]]=d[1]}),angular.element.isEmptyObject(c)&&(c=null),c}}).then(function(a){b(a.data)})};return{getManifestData:b}}]),app.factory("mainDataReader",["$http","PREFIX","STRINGS","$log","LOG_LEVEL",function(a,b,c,d,e){function f(a,b){null==b&&(b=""),""==a.replace(/^\s+|\s+$/g,"")&&(a="");var c=""===a?null:b+a;return noCacheQuery(c)}function g(a,b,c){return e>=LOG_LEVELS.ERROR&&d.error("** "+a+" ** in cbt.xml is necessary to properly start module",c),b}function h(a,b,c){return e>=LOG_LEVELS.WARN&&d.warn("** "+a+" ** not defined in cbt.xml",c),b}function i(a,b,c){return e>=LOG_LEVELS.INFO&&d.info("No ** "+a+" ** in cbt.xml. Assigned default: "+b,c),b}var j=function(d,e){a.get(b.MODULE+c.CBT_FILENAME+"?nocache="+(new Date).getTime(),{transformResponse:function(a){function c(a){var c=angular.element(a.find(" > module_settings"));j.build=c.find("build").text()?c.find("build").text():g("build",defaults.module.build),MODULE_BUILD=j.build,j.defaultWidth=c.find("resolution > width").text()?Number(c.find("resolution > width").text()):g("resolution > width",defaults.module.resolution.width),j.defaultHeight=c.find("resolution > height").text()?Number(c.find("resolution > height").text()):g("resolution > height",defaults.module.resolution.height),j.width=j.defaultWidth,j.height=j.defaultHeight,j.defaultLang=c.find("default_lang").text()?c.find("default_lang").text():g("default_lang",defaults.module.defaultLang),j.moduleId=c.find("moduleId").text()?c.find("moduleId").text():h("moduleId",defaults.module.moduleId),j.version=c.find("module_version").text()?c.find("module_version").text():h("module_version",defaults.module.version),j.folder=c.find("folder").text()?c.find("folder").text():h("folder",defaults.module.folder),j.displayName=c.find("name").text()?c.find("name").text():h("name",defaults.module.displayName),j.allowFullScreen=c.find("resolution > allow_fullscreen").text()?"true"===c.find("resolution > allow_fullscreen").text():i("resolution > allow_fullscreen",defaults.module.resolution.allowFullScreen),j.autoFullScale=c.find("resolution > auto_full_scale").text()?"true"===c.find("resolution > auto_full_scale").text():i("resolution > auto_full_scale",defaults.module.resolution.autoFullScale),j.bcg=c.find(" > background").text()?f(c.find(" > background").text(),b.PIC):i(" > background",defaults.module.bcg),j.introPath=c.find("intro").text()?f(c.find("intro").text(),b.PIC):i("intro",defaults.module.introPath),j.titleVisible=c.find("title > display").text()?c.find("title > display").text():i("title > display",defaults.module.title.visibility),j.titleX=c.find("title > x").text()?Number(c.find("title > x").text()):i("title > x",defaults.module.title.x),j.titleY=c.find("title > y").text()?Number(c.find("title > y").text()):i("title > y",defaults.module.title.y),j.subtitlesEnabled=c.find("subtitles > enabled").text()?"true"===c.find("subtitles > enabled").text():i("subtitles > enabled",defaults.module.subtitles.enabled),j.subtitlesVisible=c.find("subtitles > visible").text()?"true"===c.find("subtitles > visible").text():i("subtitles > visible",defaults.module.subtitles.visible),j.strictMode=c.find("strict_mode").text()?"true"===c.find("strict_mode").text():i("strict_mode",defaults.module.strictMode),j.toolbarAutoHide=c.find("toolbar > auto_hide").text()?"true"===c.find("toolbar > auto_hide").text():i("toolbar > auto_hide",defaults.module.toolbar.toolbarAutoHide),j.qqMode=c.find("qq_mode").text()?c.find("qq_mode").text():i("qq_mode",defaults.module.qqMode),j.rapidElearning=!!c.find("rapidElearning").text()&&"true"===c.find("rapidElearning").text();var d=angular.element(c.find(" > welcome"));j.isSkiped=!!d.find("skip").text()&&"true"===d.find("skip").text(),j.customWelcome=d&&d.find(" custom").text()&&"true"===d.find("custom").text()?{}:null,j.customWelcome&&(j.customWelcome.skip=!!d.find("skip").text()&&"true"===d.find("skip").text(),j.customWelcome.bcg=d.find("background").text()?f(d.find("background").text(),b.PIC):null,j.customWelcome.logo=d.find("logo").text()?f(d.find("logo").text(),b.PIC):null,j.customWelcome.logoX=Number(d.find("logo_x").text())?Number(d.find("logo_x").text()):0,j.customWelcome.logoY=Number(d.find("logo_y").text())?Number(d.find("logo_y").text()):0,j.customWelcome.copyrights=d.find("copyrights").text()?d.find("copyrights").text():"",j.customWelcome.showPlayerVersion=!d.find("player_version_visible").text()||"true"===d.find("player_version_visible").text(),j.customWelcome.showModuleId=!d.find("module_id_visible").text()||"true"===d.find("module_id_visible").text(),j.customWelcome.showModuleVersion=!d.find("module_version_visible").text()||"true"===d.find("module_version_visible").text(),j.customWelcome.showCredits=!d.find("credits_visible").text()||"true"===d.find("credits_visible").text(),j.customWelcome.showDisclaimer=!d.find("disclaimer_visible").text()||"true"===d.find("disclaimer_visible").text()),j.customCSS=noCacheQuery(b.MODULE+"customStyle.css");var e=function(a){var b=[];return a.find("> pages > page").each(function(a,c){var d={id:c.hasAttribute("guid")?c.getAttribute("guid"):g("Page "+a+"|guid"),pagegroupId:c.hasAttribute("pagegroupId")?c.getAttribute("pagegroupId"):i("Page "+a+"|pagegroupId",null)};b.push(d)}),b},k=function(a){var b=[];return a.find("> questions > page").each(function(c,d){var e={id:d.hasAttribute("guid")?d.getAttribute("guid"):g("Question "+c+" -> guid"),chapterId:d.hasAttribute("chapterId")?d.getAttribute("chapterId"):m(a)?h(a.find("name").text()+" -> Question "+(c+1)+" -> chapterId",null,"while qinfos are defined"):null};b.push(e)}),b},l=function(a){var b={};return a.find("> pagegroups > group").each(function(a,c){var d=c.getAttribute("guid");b[d]={id:d,answersCorr:[],passed:!1}}),angular.element.isEmptyObject(b)&&(b=null),b},m=function(a){var b={};return a.find("> qinfos > chapter").each(function(a,c){var d=c.getAttribute("chapterId");b[d]={chapId:d,numQuest:Number(c.getAttribute("numberQuestions"))}}),angular.element.isEmptyObject(b)&&(b=null),b};j.chapters={},j.chaptersIdByNum={},a.find("> chapters > chapter").each(function(a,c){var d=angular.element(c),n=d.find("questions")[0],o=d.find("glass")[0],p=a+1,q={index:a,num:p,id:c.hasAttribute("guid")?c.getAttribute("guid"):g("Chapter "+p+"|guid"),name:d.find("name").text()?d.find("name").text():h("Chapter "+p+"|name",defaults.chapter.chapterName+p),bcg:d.find("background").text()?f(d.find("background").text(),b.PIC):i("Chapter "+p+"|background",defaults.chapter.background),color:d.find("color").text()?"#"+d.find("color").text():i("Chapter "+p+"|color",defaults.chapter.color),glass:d.find("glass").text()?nullifySwf(f(d.find("glass").text(),b.PIC)):i("Chapter "+p+"|glass",defaults.chapter.glass),glassGuid:o&&o.hasAttribute("guid")?o.getAttribute("guid"):null,glassOpenImg:o&&o.hasAttribute("openImg")?noCacheQuery(b.PIC+o.getAttribute("openImg")):null,glassCloseImg:o&&o.hasAttribute("closeImg")?noCacheQuery(b.PIC+o.getAttribute("closeImg")):null,glassImgX:o&&o.hasAttribute("x")?o.getAttribute("x")+"px":0,glassImgY:o&&o.hasAttribute("y")?o.getAttribute("y")+"px":0,setScore100:d.find("set_score100").text()?"true"===d.find("set_score100").text():i("Chapter "+p+"|set_score100",defaults.chapter.setScore100),qq:d.find("qq_mode").text()?d.find("qq_mode").text():i("Chapter "+p+"|qq_mode",defaults.chapter.qq),pages:e(d),questions:k(d),pagesNum:d.find("pages > page").length,numQuest:d.find("questions > page").length,assessment:n.hasAttribute("assessment")?"true"===n.getAttribute("assessment"):h("Chapter "+p+"|assessment",defaults.chapter.assessment),hideSelfAssessmentAnswers:!!n.hasAttribute("hideAnswers")&&"true"===n.getAttribute("hideAnswers"),obligatory:n.hasAttribute("obligatory")?Number(n.getAttribute("obligatory")):h("Chapter "+p+"|obligatory",defaults.chapter.obligatory),ordered:n.hasAttribute("ordered")?"true"===n.getAttribute("ordered"):h("Chapter "+p+"|ordered",defaults.chapter.ordered),points:n.hasAttribute("points")?Number(n.getAttribute("points")):h("Chapter "+p+"|points",defaults.chapter.points),numSelQuest:n.hasAttribute("numSelected")?Number(n.getAttribute("numSelected")):h("Chapter "+p+"|numSelected",defaults.chapter.numSelQuest),attemptsNum:n.hasAttribute("attemptsNum")?Number(n.getAttribute("attemptsNum")):h("Chapter "+p+"|attemptsNum",defaults.chapter.attemptsNum),percent:0,pagegroups:l(d),qinfos:m(d),width:d.find("resolution > width")[0]&&$(d.find("resolution > width")[0]).text()?parseInt($(d.find("resolution > width")[0]).text()):null,height:d.find("resolution > height")[0]&&$(d.find("resolution > height")[0]).text()?parseInt($(d.find("resolution > height")[0]).text()):null};j.chapters[q.id]=q,j.chaptersIdByNum[q.num]=q.id});var o=a.find("> glass_chapter")[0];if(o){var p=angular.element(o),q={};q.id="glass",q.num=-1,q.pages=e(p),q.pagesNum=q.pages.length,j.chapters[q.id]=q,j.chaptersIdByNum[q.num]=q.id}j.fontStyles={pagebody:{},title:{},summaryheader:{},assessmentheader:{},assessmentbody:{},objectivesbody:{},copyrightbody:{},menu:{},previewbody:{},creditbody:{},disclaimerbody:{},dialogbody:{},levelselector:{},button:{},versioninfo:{},toolbar:{}},a.find("> styles > style").each(function(a,b){var c={id:b.getAttribute("id"),fontFamily:b.hasAttribute("fontfamily")?b.getAttribute("fontfamily"):defaults.fontStyle.fontFamily,fontSize:b.hasAttribute("fontsize")?Number(b.getAttribute("fontsize"))+"px":defaults.fontStyle.fontSize,fontWeight:b.hasAttribute("fontstyle")&&"bold"==b.getAttribute("fontstyle")?"bold":defaults.fontStyle.fontWeight,fontStyle:b.hasAttribute("fontstyle")&&"italic"==b.getAttribute("fontstyle")?"italic":defaults.fontStyle.fontStyle,color:b.hasAttribute("fontcolor")?"#"+b.getAttribute("fontcolor"):defaults.fontStyle.color,embed:b.hasAttribute("embed")?"true"==b.getAttribute("embed"):defaults.fontStyle.embed};c.fontFamily.search("cbt")>-1&&(c.fontFamily=defaults.fontStyle.fontFamily),j.fontStyles[c.id]=c}),j.fontStyles.title.left=j.titleX,j.fontStyles.title.top=j.titleY,j.fontStyles.toolbar.lineHeight=parseFloat(j.fontStyles.toolbar.fontSize)+2+"px",j.translations={};var r=angular.element(n.find("default_strings > language[id='"+j.defaultLang+"']"));angular.forEach(defaults.translations,function(a,b){var c=r.find(" > strings > s[id='"+b+"']").text();c&&""!=c||(c=a),j.translations[b]=c});var s=r.find("s[id*='LANGUAGE_NAME']");if(angular.forEach(s,function(a,b){a.hasAttribute("id")?a.getAttribute("id"):"";j.translations[a.getAttribute("id")]=a.textContent}),j.xmlv>6){var t=angular.element(a.find(" > credits"));j.translations.CREDITS=t&&t.text()?t.text():defaults.translations.CREDITS}}function d(a){var c=angular.element(a.find(" > module_settings"));c.find("resolution > width").text()&&(j.width=Number(c.find("resolution > width").text())),c.find("resolution > height").text()&&(j.height=Number(c.find("resolution > height").text())),c.find("resolution > allow_fullscreen").text()&&(j.allowFullScreen="true"===c.find("resolution > allow_fullscreen").text()),c.find("name").text()&&(j.displayName=c.find("name").text()),c.find("background").text()&&(j.bcg=f(c.find("background").text(),b.PIC)),c.find("intro").text()&&(j.introPath=f(c.find("intro").text(),b.PIC)),c.find("title > display").text()&&(j.titleVisible=c.find("title > display").text()),c.find("title > x").text()&&(j.titleX=Number(c.find("title > x").text())),c.find("title > y").text()&&(j.titleY=Number(c.find("title > y").text())),c.find("subtitles > enabled").text()&&(j.subtitlesEnabled="true"===c.find("subtitles > enabled").text()),c.find("subtitles > visible").text()&&(j.subtitlesVisible="true"===c.find("subtitles > visible").text()),c.find("strict_mode").text()&&(j.strictMode="true"===c.find("strict_mode").text()),c.find("toolbar > auto_hide").text()&&(j.toolbarAutoHide="true"===c.find("toolbar > auto_hide").text()),c.find("qq_mode").text()&&(j.qqMode=c.find("qq_mode").text());var d=angular.element(n.find("default_strings > language[id='"+e+"']"));angular.forEach(defaults.translations,function(a,b){var c=d.find(" > strings > s[id='"+b+"']").text();c&&(j.translations[b]=c)});var g=d.find("s[id*='LANGUAGE_NAME']");if(angular.forEach(g,function(a,b){a.hasAttribute("id")?a.getAttribute("id"):"";j.translations[a.getAttribute("id")]=a.textContent}),angular.forEach(defaults.translations,function(b,c){var d=a.find(" > strings > s[id='"+c+"']").text();d&&(j.translations[c]=d)}),angular.forEach(g,function(b,c){var d=a.find(" > strings > s[id='"+b.id+"']").text();if(d){b.hasAttribute("id")?b.getAttribute("id"):"";j.translations[b.getAttribute("id")]=b.textContent}}),j.xmlv>6){var i=angular.element(n.find(" > credits"));i&&i.text()&&(j.translations.CREDITS=i.text())}a.find("chapters > chapter").each(function(a,c){var d=angular.element(c),e=c.getAttribute("guid");j.chapters[e]&&(d.find("name").text()&&(j.chapters[e].name=d.find("name").text()),d.find("background").text()&&(j.chapters[e].bcg=f(d.find("background").text(),b.PIC)),d.find("color").text()&&(j.chapters[e].color=d.find("color").text()),d.find("set_score100").text()&&(j.chapters[e].setScore100="true"===d.find("set_score100").text()),d.find("qq_mode").text()&&(j.chapters[e].qq=d.find("qq_mode").text()))}),a.find("> styles > style").each(function(a,b){var c=b.getAttribute("id");b.hasAttribute("fontfamily")&&(j.fontStyles[c].fontfamily=b.getAttribute("fontfamily")),b.hasAttribute("fontsize")&&(j.fontStyles[c].fontSize=Number(b.getAttribute("fontsize"))+"px"),b.hasAttribute("fontstyle")&&("bold"===b.getAttribute("fontstyle")&&(j.fontStyles[c].fontWeight="bold",j.fontStyles[c].fontStyle="normal"),"italic"===b.getAttribute("fontstyle")&&(j.fontStyles[c].fontStyle="italic",j.fontStyles[c].fontWeight="normal"),"normal"===b.getAttribute("fontstyle")&&(j.fontStyles[c].fontStyle="normal",j.fontStyles[c].fontWeight="normal")),b.hasAttribute("fontcolor")&&(j.fontStyles[c].color="#"+b.getAttribute("fontcolor")),b.hasAttribute("embed")&&(j.fontStyles[c].embed="true"===b.getAttribute("embed"))}),j.fontStyles.title.left=j.titleX,j.fontStyles.title.top=j.titleY,j.glossary=[],a.find("> glossary > entry").each(function(a,b){var c=angular.element(b),d=b.hasAttribute("guid")?b.getAttribute("guid"):null,e={id:d,term:c.find("term").text()?c.find("term").text():h("Glossary entry"+a+"|term",""),definition:c.find("definition").text()?c.find("definition").text():h("Glossary definition"+a+"|definition","")};j.glossary.push(e)});for(var k={},l=0;l<j.glossary.length;l++){var m=j.glossary[l].term.charAt(0);void 0==k[m]&&(k[m]=[]),k[m].push(j.glossary[l])}j.glossaryLetters=k}var j={},k=getData(a),l=angular.element(k),m=l.find("> module")[0],n=angular.element(m);j.xmlv=m.hasAttribute("xmlv")?parseInt(m.getAttribute("xmlv"),10):null,c(n),e||(e=j.defaultLang);var o=n.find(" > localization > language[id='"+e+"']")[0],p=angular.element(o);return d(p,!1),j.levels={},j.haveSessionLevel=!1,n.find("> localization > language").each(function(a,b){var c=angular.element(b),d={text:c.find("lang_label").text(),id:b.getAttribute("id"),embed:b.hasAttribute("embed")?"true"==b.getAttribute("embed"):defaults.fontStyle.embed};d.text||(d.text=n.find("default_strings > language[id='"+d.id+"'] > lang_label ").text()),j.levels[d.id]=d,d.id==e&&(j.haveSessionLevel=!0)}),angular.element.isEmptyObject(j.levels)&&(j.levels=null),angular.element.isEmptyObject(j)&&(j=null),j}}).then(function(a){d(a.data)})},k=function(){return"test mainDataService"};return{test:k,getMainData:j}}]),app.factory("pageReader",["$rootScope","$http","PREFIX","TEMPLATES","$log","LOG_LEVEL",function(a,b,c,d,e,f){function g(a,b){return f>=LOG_LEVELS.ERROR&&e.error(a),b}function h(a,b){return f>=LOG_LEVELS.WARN&&e.warn(a),b}var i=function(a,e,f,i,j){i||(i=defaults.level),b.get(noCacheQuery(c.MODULE+e+"/"+f+".xml"),{transformResponse:function(a){var b={},k=getData(a),l=angular.element(k),m=l.find("pages")[0];b.guid=m.getAttribute("guid"),b.qqQuestion=!!m.hasAttribute("qq")&&"on"==m.getAttribute("qq"),b.pagegroup=m.hasAttribute("pgguid")?m.getAttribute("pgguid"):null;var n=l.find("page[level='"+i+"']")[0];if(n||(n=l.find("page")[0]),!n)return b;j&&(n=l.find("page[id='"+j+"']")[0]),b.isSubPage=null!=j,b.id=f;var o=angular.element(n);b.title=o.find("title").text();var p=o.find("template");return b.template=p.text().split(".")[0],b.align=p[0].hasAttribute("alignTxt")?p[0].getAttribute("alignTxt"):null,b.autoAdvance=!!p[0].hasAttribute("autoAdv")&&"X"==p[0].getAttribute("autoAdv"),b.stepMode=!!p[0].hasAttribute("pm")&&"step"==p[0].getAttribute("pm"),b.disableStrictSubpage=!!p[0].hasAttribute("disableStrictSubpage")&&"X"===p[0].getAttribute("disableStrictSubpage"),b.showProgress=b.template===d.TMP_01||b.template===d.PPT,b.shuffleAnswers=!p[0].hasAttribute("notRandomized")||"X"!==p[0].getAttribute("notRandomized"),b.dynamicPositioning=!!p[0].hasAttribute("dynamicPositions")&&"X"===p[0].getAttribute("dynamicPositions"),b.isSubPage&&(b.subPageMode=p[0].hasAttribute("mode")?p[0].getAttribute("mode"):"default"),b.defaultCorrectFeedback={text:null,x:null,y:null,rtlFeedbackDirection:!1},b.defaultIncorrectFeedback={text:null,x:null,y:null,rtlFeedbackDirection:!1},b.texts=[],o.find("txt").each(function(a,d){var e={text:lineBeaksCorrector(angular.element(d).text()),index:a,x:d.hasAttribute("x")?Number(d.getAttribute("x")):null,y:d.hasAttribute("y")?Number(d.getAttribute("y")):null,width:d.hasAttribute("w")?Number(d.getAttribute("w")):null,size:d.hasAttribute("fontsize")?d.getAttribute("fontsize"):null,color:d.hasAttribute("fontcolor")?"#"+d.getAttribute("fontcolor"):null,align:d.hasAttribute("align")?d.getAttribute("align"):defaults.printOrder.text.align,txtFade:!!d.hasAttribute("txtFade")&&"X"==d.getAttribute("txtFade"),wait:!!d.hasAttribute("wait")&&"W"==d.getAttribute("wait"),hotid:d.hasAttribute("hotid")?d.getAttribute("hotid"):null,hot:d.hasAttribute("hot")?d.getAttribute("hot"):null,mOver:!!d.hasAttribute("mOver")&&d.getAttribute("mOver"),s:d.hasAttribute("s")?d.getAttribute("s"):null,bullet:!!d.hasAttribute("bull")&&"X"==d.getAttribute("bull"),noDelay:!!d.hasAttribute("noDelay")&&"X"==d.getAttribute("noDelay"),rpo:d.hasAttribute("rpo")?d.getAttribute("rpo").split(","):null,delay:d.hasAttribute("delay")?Number(d.getAttribute("delay")):null,showWithPrevious:!!d.hasAttribute("swp")&&"X"==d.getAttribute("swp"),cue:d.hasAttribute("cue")?Number(d.getAttribute("cue")):null,oneAnswer:!!d.hasAttribute("r")&&"X"==d.getAttribute("r"),important:!!d.hasAttribute("c")&&"X"==d.getAttribute("c"),points:d.hasAttribute("pt")?Number(d.getAttribute("pt")):null,rightText:d.hasAttribute("rghttext")?lineBeaksCorrector(d.getAttribute("rghttext")):null,wrongText:d.hasAttribute("wrngtext")?lineBeaksCorrector(d.getAttribute("wrngtext")):null,crct:d.hasAttribute("crct")?d.getAttribute("crct"):null,rghtX:d.hasAttribute("rghtx")?Number(d.getAttribute("rghtx")):null,rghtY:d.hasAttribute("rghty")?Number(d.getAttribute("rghty")):null,wrngX:d.hasAttribute("wrngx")?Number(d.getAttribute("wrngx")):null,wrngY:d.hasAttribute("wrngy")?Number(d.getAttribute("wrngy")):null,pictureAnswer:!!d.hasAttribute("picA")&&"P"==d.getAttribute("picA"),match:d.hasAttribute("match")?d.getAttribute("match"):null,matchPO:d.hasAttribute("selPO")?Number(d.getAttribute("selPO")):null,matchX:d.hasAttribute("ansx")?Number(d.getAttribute("ansx")):null,matchY:d.hasAttribute("ansy")?Number(d.getAttribute("ansy")):null,pictureMatch:!(!d.hasAttribute("match")||!d.hasAttribute("picM"))&&"P"==d.getAttribute("picM")};e.orgX=e.x,e.orgY=e.y,e.orgWidth=e.width,"A"===e.hot&&(e.text=""),""==e.text.replace(/^\s+|\s+$/g,"")&&(e.text=null),e.pictureMatch&&(e.match=c.PIC+e.match),"C"==e.crct&&(b.defaultCorrectFeedback.text=e.text,b.defaultCorrectFeedback.x=e.x,b.defaultCorrectFeedback.y=e.y),"I"==e.crct&&(b.defaultIncorrectFeedback.text=e.text,b.defaultIncorrectFeedback.x=e.x,b.defaultIncorrectFeedback.y=e.y),e.rtlDirection="AR"===i,"AR"===i&&(b.defaultCorrectFeedback.rtlFeedbackDirection=!0,b.defaultIncorrectFeedback.rtlFeedbackDirection=!0,e.match===!0&&(e.rtlDirection=!0)),b.texts.push(e)}),0===b.texts.length&&g("Page "+b.id+"(chapter: "+e+"):There must be at least one print order (txt) in page"),b.points=defineQuestionPoints(b.texts,f.toString()),b.pics=[],o.find("pic").each(function(a,e){var f={src:angular.element(e).text().indexOf(".")>-1?c.PIC+angular.element(e).text():null,isGif:angular.element(e).text().indexOf(".gif")>-1,clickedSrc:e.hasAttribute("visited")?c.PIC+e.getAttribute("visited"):null,index:a,x:e.hasAttribute("x")?e.getAttribute("x"):null,y:e.hasAttribute("y")?e.getAttribute("y"):null,width:e.hasAttribute("w")?e.getAttribute("w"):null,height:e.hasAttribute("h")?e.getAttribute("h"):null,noFade:!!e.hasAttribute("noFade")&&"X"===e.getAttribute("noFade"),noDelay:!!e.getAttribute("noDelay")&&"X"===e.getAttribute("noDelay"),preload:!!e.hasAttribute("preload")&&"X"===e.getAttribute("preload"),exactfit:!!e.hasAttribute("exactfit")&&"X"===e.getAttribute("exactfit"),hidePlay:!!e.hasAttribute("hideplay")&&"X"===e.getAttribute("hideplay"),hotid:e.hasAttribute("hotid")?e.getAttribute("hotid"):null,hot:e.hasAttribute("hot")?e.getAttribute("hot"):null};b.template===d.ADAPTIVE&&angular.element(e).text()&&(f.src=c.ADAPTIVE+angular.element(e).text()+".json"),e.hasAttribute("nv")&&(f.src=c.PIC+e.getAttribute("nv")),"doc"===b.template&&f.src&&(f.src=renameSwf(f.src,"pdf")),e.hasAttribute("altDoc")&&(f.src=c.PIC+e.getAttribute("altDoc")),f.src=noCacheQuery(f.src),f.clickedSrc=noCacheQuery(f.clickedSrc),"A"===b.texts[a].hot&&(f.src=null),b.pics.push(f)}),0===b.texts.length&&g("Page "+b.id+"(chapter: "+e+"):There must be at least one print order (pic) in page"),b.soundTexts=[],b.subtitlesPresent=!1,o.find("sndTxt").each(function(a,c){var d={text:""==angular.element(c).text().trim()?null:angular.element(c).text(),index:a,hideSubtitles:!!c.hasAttribute("h")&&"X"==c.getAttribute("h")};"A"===b.texts[a].hot&&(d.text=""),d.text&&(b.subtitlesPresent=!0),b.soundTexts.push(d)}),0===b.texts.length&&g("Page "+b.id+"(chapter: "+e+"):There must be at least one print order (soundText) in page"),b.sounds=[],o.find("snd").each(function(a,d){var e={src:angular.element(d).text().indexOf(".mp3")>-1?c.SOUND+angular.element(d).text():null,index:a,preload:!!d.hasAttribute("preload")&&"X"==d.getAttribute("preload"),waitForSound:!!d.hasAttribute("wfs")&&"T"==d.getAttribute("wfs")};"A"===b.texts[a].hot&&(e.src=null),e.src=noCacheQuery(e.src),b.sounds.push(e)}),0===b.texts.length&&g("Page "+b.id+"(chapter: "+e+"):There must be at least one print order (sound) in page"),b.numSteps=b.texts.length,b.texts.length===b.soundTexts.length&&b.texts.length===b.pics.length&&b.texts.length===b.sounds.length||h("Page "+b.id+"("+b.guid+"): Number of texts ("+b.texts.length+"), pictures ("+b.pics.length+"), sounds ("+b.sounds.length+") and subtitles ("+b.sounds.length+") must match"),b}}).then(function(b){a(b.data)})},j=function(){return"test page service"};return{test:j,getPage:i}}]),app.constant("SCORM_VALUES",{CORE:{LESSON_MODE:{BROWSE:"browse",REVIEW:"review",NORMAL:"normal"},LESSON_STATUS:{COMPLETED:"completed",INCOMPLETE:"incomplete",PASSED:"passed",FAILED:"failed"},CREDIT:{CREDIT:"credit"}}}),app.service("SCORMService",["$window","$rootScope","SCORM_VALUES","inactivityCounter",function(a,b,c,d){function e(){i.core=stringToObjectNames(doLMSGetValue("cmi.core._children"),","),i.core.score=stringToObjectNames(doLMSGetValue("cmi.core.score._children"),","),i.student_data=stringToObjectNames(doLMSGetValue("cmi.student_data._children"),",")}function f(a,b,c){var d={};if(a&&""!=a){var e=a.split(b);angular.forEach(e,function(a){var b=a.split(c),e=b[1];"true"==e&&(e=!0),"false"==e&&(e=!1),""==e&&(e=void 0),d[b[0].toLowerCase()]=e})}return d}function g(a,b,c){var d="";return angular.forEach(a,function(a,e){d+=e+c+a+b}),d=d.substring(0,d.length-1)}function h(){j.suspend_data.b=b.mainData.build,j.suspend_data.lang=b.session.level,doLMSSetValue("cmi.suspend_data",g(j.suspend_data,"|","="))}var i={core:{},student_data:{}},j={},k=function(){return typeof available==typeof Function},l=function(){return typeof LMSIsInitialized==typeof Function&&LMSIsInitialized()},m=function(){e(),j=jQuery.extend(!0,{},i),j.core.lesson_mode=doLMSGetValue("cmi.core.lesson_mode"),j.core.lesson_status=doLMSGetValue("cmi.core.lesson_status"),j.launch_data=f(doLMSGetValue("cmi.launch_data"),"&","="),j.suspend_data=f(doLMSGetValue("cmi.suspend_data"),"|","="),j.core.lesson_location=doLMSGetValue("cmi.core.lesson_location"),j.core.credit=doLMSGetValue("cmi.core.credit"),j.core.entry=doLMSGetValue("cmi.core.entry"),j.core.score.raw=doLMSGetValue("cmi.core.score.raw"),j.student_data.mastery_score=doLMSGetValue("cmi.student_data.mastery_score")},n=function(){return j.student_data?j.student_data.mastery_score:null},o=function(){j.suspend_data.b&&j.suspend_data.b!=b.mainData.build&&(j.suspend_data.p=null,j.suspend_data.at=null,j.suspend_data.lang=null)},p=function(){var a=null;if(j.suspend_data.p){var b=j.suspend_data.p.indexOf("0");a=b<=0?j.suspend_data.p.length-1:b-1}else j.suspend_data.p="";return a},q=function(a,b){if(j.suspend_data.p){if(j.suspend_data.p.length<b){var c=Array(b-j.suspend_data.p.length+1).join("0");j.suspend_data.p+=c}}else j.suspend_data.p=Array(b+1).join("0");a<b&&(j.suspend_data.p=setCharAt(j.suspend_data.p,a,"1")),h()},r=function(a){j.suspend_data.p=Array(a+1).join("0"),h()},s=function(){var a=null;return j.suspend_data.lang&&(a=j.suspend_data.lang.toUpperCase()),j.launch_data.level&&(a=j.launch_data.level.toUpperCase()),a},t=function(a){return void 0===j.launch_data.strict?a:j.launch_data.strict},u=function(a){return void 0===j.launch_data.attempts?a:parseInt(j.launch_data.attempts,10)},v=function(a){return void 0===j.launch_data.qqmode?a:j.launch_data.qqmode===!0?"on":j.launch_data.qqmode===!1?"off":j.launch_data.qqmode},w=function(){if(b.chapter.assessment){var a=j.suspend_data.at?Number(j.suspend_data.at):0;a++,j.suspend_data.at=a,h()}},x=function(){return parseInt(j.suspend_data.at?j.suspend_data.at:0)},y=function(){var a=!1,c=parseFloat(j.core.score.raw);return!D()||b.chapter.attemptsNum!==parseInt(j.suspend_data.at)&&1!==b.chapter.attemptsNum?(b.chapter.alreadyScored=!1,b.chapter.precentScore=0):(a=!0,b.chapter.alreadyScored=!0,b.chapter.precentScore=isNaN(c)?0:c),a},z=function(){B(!0)},A=function(){var a=0,c=0;angular.forEach(b.pagesOrder,function(b){b.possibleScore&&(a+=b.possibleScore,c+=b.score)}),c=Math.round(c);var d=Math.round(c/a*100);b.chapter.precentScore=d,b.chapter.alreadyScored=!0},B=function(a){b.chapter.assessment?(j.core.lesson_location=100,doLMSSetValue("cmi.core.lesson_location",j.core.lesson_location.toString()),(0===b.chapter.attemptsNum||b.chapter.attemptsNum>parseInt(j.suspend_data.at)||!D())&&(A(),C(b.chapter.precentScore),a||doLMSCommit()),b.inProgress=!1,a&&doQuit(d.activeTime())):D()?(b.inProgress=!1,a&&doQuit(d.activeTime())):(j.core.lesson_location=b.chapter.percent,doLMSSetValue("cmi.core.lesson_location",j.core.lesson_location.toString()),100==j.core.lesson_location?(j.core.lesson_status=c.CORE.LESSON_STATUS.COMPLETED,doLMSSetValue("cmi.core.lesson_status",j.core.lesson_status.toString()),b.chapter.setScore100&&C(100),b.inProgress=!1,a?doQuit(d.activeTime()):doLMSCommit()):(j.core.lesson_status=c.CORE.LESSON_STATUS.INCOMPLETE,doLMSSetValue("cmi.core.lesson_status",j.core.lesson_status),b.inProgress=!1,doBack(d.activeTime())))},C=function(a){if(j.core.lesson_status=c.CORE.LESSON_STATUS.COMPLETED,j.core.score.raw=a,doLMSSetValue("cmi.core.score.raw",j.core.score.raw.toString()),i.core.score.min&&(j.core.score.min=0,doLMSSetValue("cmi.core.score.min",j.core.score.min.toString())),i.core.score.max&&(j.core.score.max=100,doLMSSetValue("cmi.core.score.max",j.core.score.max.toString())),j.student_data.mastery_score>=0&&j.core.credit===c.CORE.CREDIT.CREDIT){var b=parseFloat(j.core.score.raw),d=parseFloat(j.student_data.mastery_score);isNaN(d)||isNaN(b)||(b>=d?j.core.lesson_status=c.CORE.LESSON_STATUS.PASSED:j.core.lesson_status=c.CORE.LESSON_STATUS.FAILED)}doLMSSetValue("cmi.core.lesson_status",j.core.lesson_status.toString())},D=function(){return j.core.lesson_mode==c.CORE.LESSON_MODE.BROWSE||j.core.lesson_mode==c.CORE.LESSON_MODE.REVIEW||j.core.lesson_status==c.CORE.LESSON_STATUS.COMPLETED||j.core.lesson_status==c.CORE.LESSON_STATUS.PASSED||j.core.lesson_status==c.CORE.LESSON_STATUS.FAILED},E=function(){return j.core.lesson_status==c.CORE.LESSON_STATUS.COMPLETED||j.core.lesson_status==c.CORE.LESSON_STATUS.PASSED||j.core.lesson_status==c.CORE.LESSON_STATUS.FAILED};return{isScorm:k,isLMS_Initialized:l,getCmiData:m,quitPlayer:z,saveReport:B,alreadyScored:y,getLang:s,isStrict:t,attemptsNum:u,isQQ:v,validateBookmark:o,getBookmark:p,saveBookmark:q,clearBookmark:r,getAssessmentTries:x,getMasteryScore:n,increaseAssessmentTries:w,chapterCompleted:E}}]),app.factory("sessionData",function(){return{soundEnabled:defaults.soundEnabled,subtitlesVisible:defaults.subtitlesVisible,fullScreen:defaults.fullScreen,level:defaults.level}}),app.service("browserInfo",["$window",function(a){var b=function(){var b=a.navigator.userAgent,c={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/internet explorer/i};for(var d in c)if(c[d].test(b))return d;return"unknown"};return{name:b}}]),app.service("pagePreloader",["$q","$rootScope","EVENTS",function(a,b,c){var d=[],e=function(){for(var a=0;a<d.length;a++){var b=d[a];b&&(b.src="",b.parent&&b.parent.removeChild(b),b=null)}d=[]},f=function(d){e();var f=[],h=0,i=[];return a(function(a,e){if(angular.element.isEmptyObject(d))a();else if(angular.forEach(d.sounds,function(a){a.src&&i.push(a.src)}),angular.forEach(d.pics,function(a){a.src&&i.push(a.src),a.clickedSrc&&i.push(a.clickedSrc)}),f=i.filter(function(a,b){return i.indexOf(a)==b}),0===f.length)a();else{b.$broadcast(c.PRELOADING,0);var j=function(){h++;var d=100*h/f.length|0;b.$broadcast(c.PRELOADING,d),h===f.length&&a()};angular.forEach(f,function(a){g(a).then(function(){j()},function(a){alert(a.toString()),j()})})}})},g=function(b){return a(function(a,c){if(b.toLowerCase().indexOf(".swf?")>-1||b.indexOf(".flv?")>-1||b.indexOf(".html?")>-1)a();else if(b.toLowerCase().indexOf(".pdf?")>-1)a();else if(b.toLowerCase().indexOf(".mp4?")>-1)a();else if(b.toLowerCase().indexOf(".mp3?")>-1){
var e=new Audio;e.addEventListener("canplaythrough",a(),!1),e.addEventListener("error",c("Problem with sound: "+b),!1),e.preload="auto",e.src=b,d.push(e)}else{var f=angular.element("<img>");f.on("load",function(b){a()}),f.on("error",function(a){c("Problem with image: "+b)}),f.attr("src",b)}})};return{preloadPage:f}}]),app.service("inactivityCounter",["$timeout",function(a){function b(){m=(new Date).getTime(),l=null}function c(){if(m){var a=(new Date).getTime();k+=a-m,m=null}}function d(c){(!c||l||m)&&(e(),l&&a.cancel(l),l=a(function(){b()},j))}function e(){l&&(a.cancel(l),l=null),c()}function f(){return k}function g(){var a=(new Date).getTime();return a-i}function h(){return g()-f()}var i=(new Date).getTime(),j=3e5,k=0,l=null,m=null;return{stopInactivityTimeout:e,resetInactivityTimeout:d,inactivityTime:f,totalTime:g,activeTime:h}}]);